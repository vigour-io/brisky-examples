(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){module.exports={default:require("core-js/library/fn/symbol"),__esModule:true}},{"core-js/library/fn/symbol":4}],2:[function(require,module,exports){module.exports={default:require("core-js/library/fn/symbol/iterator"),__esModule:true}},{"core-js/library/fn/symbol/iterator":5}],3:[function(require,module,exports){"use strict";exports.__esModule=true;var _iterator=require("../core-js/symbol/iterator");var _iterator2=_interopRequireDefault(_iterator);var _symbol=require("../core-js/symbol");var _symbol2=_interopRequireDefault(_symbol);var _typeof=typeof _symbol2.default==="function"&&typeof _iterator2.default==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof _symbol2.default==="function"&&obj.constructor===_symbol2.default?"symbol":typeof obj};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=typeof _symbol2.default==="function"&&_typeof(_iterator2.default)==="symbol"?function(obj){return typeof obj==="undefined"?"undefined":_typeof(obj)}:function(obj){return obj&&typeof _symbol2.default==="function"&&obj.constructor===_symbol2.default?"symbol":typeof obj==="undefined"?"undefined":_typeof(obj)}},{"../core-js/symbol":1,"../core-js/symbol/iterator":2}],4:[function(require,module,exports){require("../../modules/es6.symbol");require("../../modules/es6.object.to-string");require("../../modules/es7.symbol.async-iterator");require("../../modules/es7.symbol.observable");module.exports=require("../../modules/_core").Symbol},{"../../modules/_core":11,"../../modules/es6.object.to-string":63,"../../modules/es6.symbol":65,"../../modules/es7.symbol.async-iterator":66,"../../modules/es7.symbol.observable":67}],5:[function(require,module,exports){require("../../modules/es6.string.iterator");require("../../modules/web.dom.iterable");module.exports=require("../../modules/_wks-ext").f("iterator")},{"../../modules/_wks-ext":60,"../../modules/es6.string.iterator":64,"../../modules/web.dom.iterable":68}],6:[function(require,module,exports){module.exports=function(it){if(typeof it!="function")throw TypeError(it+" is not a function!");return it}},{}],7:[function(require,module,exports){module.exports=function(){}},{}],8:[function(require,module,exports){var isObject=require("./_is-object");module.exports=function(it){if(!isObject(it))throw TypeError(it+" is not an object!");return it}},{"./_is-object":27}],9:[function(require,module,exports){var toIObject=require("./_to-iobject"),toLength=require("./_to-length"),toIndex=require("./_to-index");module.exports=function(IS_INCLUDES){return function($this,el,fromIndex){var O=toIObject($this),length=toLength(O.length),index=toIndex(fromIndex,length),value;if(IS_INCLUDES&&el!=el)while(length>index){value=O[index++];if(value!=value)return true}else for(;length>index;index++)if(IS_INCLUDES||index in O){if(O[index]===el)return IS_INCLUDES||index||0}return!IS_INCLUDES&&-1}}},{"./_to-index":52,"./_to-iobject":54,"./_to-length":55}],10:[function(require,module,exports){var toString={}.toString;module.exports=function(it){return toString.call(it).slice(8,-1)}},{}],11:[function(require,module,exports){var core=module.exports={version:"2.4.0"};if(typeof __e=="number")__e=core},{}],12:[function(require,module,exports){var aFunction=require("./_a-function");module.exports=function(fn,that,length){aFunction(fn);if(that===undefined)return fn;switch(length){case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}}},{"./_a-function":6}],13:[function(require,module,exports){module.exports=function(it){if(it==undefined)throw TypeError("Can't call method on  "+it);return it}},{}],14:[function(require,module,exports){module.exports=!require("./_fails")(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},{"./_fails":19}],15:[function(require,module,exports){var isObject=require("./_is-object"),document=require("./_global").document,is=isObject(document)&&isObject(document.createElement);module.exports=function(it){return is?document.createElement(it):{}}},{"./_global":20,"./_is-object":27}],16:[function(require,module,exports){module.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],17:[function(require,module,exports){var getKeys=require("./_object-keys"),gOPS=require("./_object-gops"),pIE=require("./_object-pie");module.exports=function(it){var result=getKeys(it),getSymbols=gOPS.f;if(getSymbols){var symbols=getSymbols(it),isEnum=pIE.f,i=0,key;while(symbols.length>i)if(isEnum.call(it,key=symbols[i++]))result.push(key)}return result}},{"./_object-gops":41,"./_object-keys":44,"./_object-pie":45}],18:[function(require,module,exports){var global=require("./_global"),core=require("./_core"),ctx=require("./_ctx"),hide=require("./_hide"),PROTOTYPE="prototype";var $export=function(type,name,source){var IS_FORCED=type&$export.F,IS_GLOBAL=type&$export.G,IS_STATIC=type&$export.S,IS_PROTO=type&$export.P,IS_BIND=type&$export.B,IS_WRAP=type&$export.W,exports=IS_GLOBAL?core:core[name]||(core[name]={}),expProto=exports[PROTOTYPE],target=IS_GLOBAL?global:IS_STATIC?global[name]:(global[name]||{})[PROTOTYPE],key,own,out;if(IS_GLOBAL)source=name;for(key in source){own=!IS_FORCED&&target&&target[key]!==undefined;if(own&&key in exports)continue;out=own?target[key]:source[key];exports[key]=IS_GLOBAL&&typeof target[key]!="function"?source[key]:IS_BIND&&own?ctx(out,global):IS_WRAP&&target[key]==out?function(C){var F=function(a,b,c){if(this instanceof C){switch(arguments.length){case 0:return new C;case 1:return new C(a);case 2:return new C(a,b)}return new C(a,b,c)}return C.apply(this,arguments)};F[PROTOTYPE]=C[PROTOTYPE];return F}(out):IS_PROTO&&typeof out=="function"?ctx(Function.call,out):out;if(IS_PROTO){(exports.virtual||(exports.virtual={}))[key]=out;if(type&$export.R&&expProto&&!expProto[key])hide(expProto,key,out)}}};$export.F=1;$export.G=2;$export.S=4;$export.P=8;$export.B=16;$export.W=32;$export.U=64;$export.R=128;module.exports=$export},{"./_core":11,"./_ctx":12,"./_global":20,"./_hide":22}],19:[function(require,module,exports){module.exports=function(exec){try{return!!exec()}catch(e){return true}}},{}],20:[function(require,module,exports){var global=module.exports=typeof window!="undefined"&&window.Math==Math?window:typeof self!="undefined"&&self.Math==Math?self:Function("return this")();if(typeof __g=="number")__g=global},{}],21:[function(require,module,exports){var hasOwnProperty={}.hasOwnProperty;module.exports=function(it,key){return hasOwnProperty.call(it,key)}},{}],22:[function(require,module,exports){var dP=require("./_object-dp"),createDesc=require("./_property-desc");module.exports=require("./_descriptors")?function(object,key,value){return dP.f(object,key,createDesc(1,value))}:function(object,key,value){object[key]=value;return object}},{"./_descriptors":14,"./_object-dp":36,"./_property-desc":46}],23:[function(require,module,exports){module.exports=require("./_global").document&&document.documentElement},{"./_global":20}],24:[function(require,module,exports){module.exports=!require("./_descriptors")&&!require("./_fails")(function(){return Object.defineProperty(require("./_dom-create")("div"),"a",{get:function(){return 7}}).a!=7})},{"./_descriptors":14,"./_dom-create":15,"./_fails":19}],25:[function(require,module,exports){var cof=require("./_cof");module.exports=Object("z").propertyIsEnumerable(0)?Object:function(it){return cof(it)=="String"?it.split(""):Object(it)}},{"./_cof":10}],26:[function(require,module,exports){var cof=require("./_cof");module.exports=Array.isArray||function isArray(arg){return cof(arg)=="Array"}},{"./_cof":10}],27:[function(require,module,exports){module.exports=function(it){return typeof it==="object"?it!==null:typeof it==="function"}},{}],28:[function(require,module,exports){"use strict";var create=require("./_object-create"),descriptor=require("./_property-desc"),setToStringTag=require("./_set-to-string-tag"),IteratorPrototype={};require("./_hide")(IteratorPrototype,require("./_wks")("iterator"),function(){return this});module.exports=function(Constructor,NAME,next){Constructor.prototype=create(IteratorPrototype,{next:descriptor(1,next)});setToStringTag(Constructor,NAME+" Iterator")}},{"./_hide":22,"./_object-create":35,"./_property-desc":46,"./_set-to-string-tag":48,"./_wks":61}],29:[function(require,module,exports){"use strict";var LIBRARY=require("./_library"),$export=require("./_export"),redefine=require("./_redefine"),hide=require("./_hide"),has=require("./_has"),Iterators=require("./_iterators"),$iterCreate=require("./_iter-create"),setToStringTag=require("./_set-to-string-tag"),getPrototypeOf=require("./_object-gpo"),ITERATOR=require("./_wks")("iterator"),BUGGY=!([].keys&&"next"in[].keys()),FF_ITERATOR="@@iterator",KEYS="keys",VALUES="values";var returnThis=function(){return this};module.exports=function(Base,NAME,Constructor,next,DEFAULT,IS_SET,FORCED){$iterCreate(Constructor,NAME,next);var getMethod=function(kind){if(!BUGGY&&kind in proto)return proto[kind];switch(kind){case KEYS:return function keys(){return new Constructor(this,kind)};case VALUES:return function values(){return new Constructor(this,kind)}}return function entries(){return new Constructor(this,kind)}};var TAG=NAME+" Iterator",DEF_VALUES=DEFAULT==VALUES,VALUES_BUG=false,proto=Base.prototype,$native=proto[ITERATOR]||proto[FF_ITERATOR]||DEFAULT&&proto[DEFAULT],$default=$native||getMethod(DEFAULT),$entries=DEFAULT?!DEF_VALUES?$default:getMethod("entries"):undefined,$anyNative=NAME=="Array"?proto.entries||$native:$native,methods,key,IteratorPrototype;if($anyNative){IteratorPrototype=getPrototypeOf($anyNative.call(new Base));if(IteratorPrototype!==Object.prototype){setToStringTag(IteratorPrototype,TAG,true);if(!LIBRARY&&!has(IteratorPrototype,ITERATOR))hide(IteratorPrototype,ITERATOR,returnThis)}}if(DEF_VALUES&&$native&&$native.name!==VALUES){VALUES_BUG=true;$default=function values(){return $native.call(this)}}if((!LIBRARY||FORCED)&&(BUGGY||VALUES_BUG||!proto[ITERATOR])){hide(proto,ITERATOR,$default)}Iterators[NAME]=$default;Iterators[TAG]=returnThis;if(DEFAULT){methods={values:DEF_VALUES?$default:getMethod(VALUES),keys:IS_SET?$default:getMethod(KEYS),entries:$entries};if(FORCED)for(key in methods){if(!(key in proto))redefine(proto,key,methods[key])}else $export($export.P+$export.F*(BUGGY||VALUES_BUG),NAME,methods)}return methods}},{"./_export":18,"./_has":21,"./_hide":22,"./_iter-create":28,"./_iterators":31,"./_library":33,"./_object-gpo":42,"./_redefine":47,"./_set-to-string-tag":48,"./_wks":61}],30:[function(require,module,exports){module.exports=function(done,value){return{value:value,done:!!done}}},{}],31:[function(require,module,exports){module.exports={}},{}],32:[function(require,module,exports){var getKeys=require("./_object-keys"),toIObject=require("./_to-iobject");module.exports=function(object,el){var O=toIObject(object),keys=getKeys(O),length=keys.length,index=0,key;while(length>index)if(O[key=keys[index++]]===el)return key}},{"./_object-keys":44,"./_to-iobject":54}],33:[function(require,module,exports){module.exports=true},{}],34:[function(require,module,exports){var META=require("./_uid")("meta"),isObject=require("./_is-object"),has=require("./_has"),setDesc=require("./_object-dp").f,id=0;var isExtensible=Object.isExtensible||function(){return true};var FREEZE=!require("./_fails")(function(){return isExtensible(Object.preventExtensions({}))});var setMeta=function(it){setDesc(it,META,{value:{i:"O"+ ++id,w:{}}})};var fastKey=function(it,create){if(!isObject(it))return typeof it=="symbol"?it:(typeof it=="string"?"S":"P")+it;if(!has(it,META)){if(!isExtensible(it))return"F";if(!create)return"E";setMeta(it)}return it[META].i};var getWeak=function(it,create){if(!has(it,META)){if(!isExtensible(it))return true;if(!create)return false;setMeta(it)}return it[META].w};var onFreeze=function(it){if(FREEZE&&meta.NEED&&isExtensible(it)&&!has(it,META))setMeta(it);return it};var meta=module.exports={KEY:META,NEED:false,fastKey:fastKey,getWeak:getWeak,onFreeze:onFreeze}},{"./_fails":19,"./_has":21,"./_is-object":27,"./_object-dp":36,"./_uid":58}],35:[function(require,module,exports){var anObject=require("./_an-object"),dPs=require("./_object-dps"),enumBugKeys=require("./_enum-bug-keys"),IE_PROTO=require("./_shared-key")("IE_PROTO"),Empty=function(){},PROTOTYPE="prototype";var createDict=function(){var iframe=require("./_dom-create")("iframe"),i=enumBugKeys.length,lt="<",gt=">",iframeDocument;iframe.style.display="none";require("./_html").appendChild(iframe);iframe.src="javascript:";iframeDocument=iframe.contentWindow.document;iframeDocument.open();iframeDocument.write(lt+"script"+gt+"document.F=Object"+lt+"/script"+gt);iframeDocument.close();createDict=iframeDocument.F;while(i--)delete createDict[PROTOTYPE][enumBugKeys[i]];return createDict()};module.exports=Object.create||function create(O,Properties){var result;if(O!==null){Empty[PROTOTYPE]=anObject(O);result=new Empty;Empty[PROTOTYPE]=null;result[IE_PROTO]=O}else result=createDict();return Properties===undefined?result:dPs(result,Properties)}},{"./_an-object":8,"./_dom-create":15,"./_enum-bug-keys":16,"./_html":23,"./_object-dps":37,"./_shared-key":49}],36:[function(require,module,exports){var anObject=require("./_an-object"),IE8_DOM_DEFINE=require("./_ie8-dom-define"),toPrimitive=require("./_to-primitive"),dP=Object.defineProperty;exports.f=require("./_descriptors")?Object.defineProperty:function defineProperty(O,P,Attributes){anObject(O);P=toPrimitive(P,true);anObject(Attributes);if(IE8_DOM_DEFINE)try{return dP(O,P,Attributes)}catch(e){}if("get"in Attributes||"set"in Attributes)throw TypeError("Accessors not supported!");if("value"in Attributes)O[P]=Attributes.value;return O}},{"./_an-object":8,"./_descriptors":14,"./_ie8-dom-define":24,"./_to-primitive":57}],37:[function(require,module,exports){var dP=require("./_object-dp"),anObject=require("./_an-object"),getKeys=require("./_object-keys");module.exports=require("./_descriptors")?Object.defineProperties:function defineProperties(O,Properties){anObject(O);var keys=getKeys(Properties),length=keys.length,i=0,P;while(length>i)dP.f(O,P=keys[i++],Properties[P]);return O}},{"./_an-object":8,"./_descriptors":14,"./_object-dp":36,"./_object-keys":44}],38:[function(require,module,exports){var pIE=require("./_object-pie"),createDesc=require("./_property-desc"),toIObject=require("./_to-iobject"),toPrimitive=require("./_to-primitive"),has=require("./_has"),IE8_DOM_DEFINE=require("./_ie8-dom-define"),gOPD=Object.getOwnPropertyDescriptor;exports.f=require("./_descriptors")?gOPD:function getOwnPropertyDescriptor(O,P){O=toIObject(O);P=toPrimitive(P,true);if(IE8_DOM_DEFINE)try{return gOPD(O,P)}catch(e){}if(has(O,P))return createDesc(!pIE.f.call(O,P),O[P])}},{"./_descriptors":14,"./_has":21,"./_ie8-dom-define":24,"./_object-pie":45,"./_property-desc":46,"./_to-iobject":54,"./_to-primitive":57}],39:[function(require,module,exports){var toIObject=require("./_to-iobject"),gOPN=require("./_object-gopn").f,toString={}.toString;var windowNames=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];var getWindowNames=function(it){try{return gOPN(it)}catch(e){return windowNames.slice()}};module.exports.f=function getOwnPropertyNames(it){return windowNames&&toString.call(it)=="[object Window]"?getWindowNames(it):gOPN(toIObject(it))}},{"./_object-gopn":40,"./_to-iobject":54}],40:[function(require,module,exports){var $keys=require("./_object-keys-internal"),hiddenKeys=require("./_enum-bug-keys").concat("length","prototype");exports.f=Object.getOwnPropertyNames||function getOwnPropertyNames(O){return $keys(O,hiddenKeys)}},{"./_enum-bug-keys":16,"./_object-keys-internal":43}],41:[function(require,module,exports){exports.f=Object.getOwnPropertySymbols},{}],42:[function(require,module,exports){var has=require("./_has"),toObject=require("./_to-object"),IE_PROTO=require("./_shared-key")("IE_PROTO"),ObjectProto=Object.prototype;module.exports=Object.getPrototypeOf||function(O){O=toObject(O);if(has(O,IE_PROTO))return O[IE_PROTO];if(typeof O.constructor=="function"&&O instanceof O.constructor){return O.constructor.prototype}return O instanceof Object?ObjectProto:null}},{"./_has":21,"./_shared-key":49,"./_to-object":56}],43:[function(require,module,exports){var has=require("./_has"),toIObject=require("./_to-iobject"),arrayIndexOf=require("./_array-includes")(false),IE_PROTO=require("./_shared-key")("IE_PROTO");module.exports=function(object,names){var O=toIObject(object),i=0,result=[],key;for(key in O)if(key!=IE_PROTO)has(O,key)&&result.push(key);while(names.length>i)if(has(O,key=names[i++])){~arrayIndexOf(result,key)||result.push(key)}return result}},{"./_array-includes":9,"./_has":21,"./_shared-key":49,"./_to-iobject":54}],44:[function(require,module,exports){var $keys=require("./_object-keys-internal"),enumBugKeys=require("./_enum-bug-keys");module.exports=Object.keys||function keys(O){return $keys(O,enumBugKeys)}},{"./_enum-bug-keys":16,"./_object-keys-internal":43}],45:[function(require,module,exports){exports.f={}.propertyIsEnumerable},{}],46:[function(require,module,exports){module.exports=function(bitmap,value){return{enumerable:!(bitmap&1),configurable:!(bitmap&2),writable:!(bitmap&4),value:value}}},{}],47:[function(require,module,exports){module.exports=require("./_hide")},{"./_hide":22}],48:[function(require,module,exports){var def=require("./_object-dp").f,has=require("./_has"),TAG=require("./_wks")("toStringTag");module.exports=function(it,tag,stat){if(it&&!has(it=stat?it:it.prototype,TAG))def(it,TAG,{configurable:true,value:tag})}},{"./_has":21,"./_object-dp":36,"./_wks":61}],49:[function(require,module,exports){var shared=require("./_shared")("keys"),uid=require("./_uid");module.exports=function(key){return shared[key]||(shared[key]=uid(key))}},{"./_shared":50,"./_uid":58}],50:[function(require,module,exports){var global=require("./_global"),SHARED="__core-js_shared__",store=global[SHARED]||(global[SHARED]={});module.exports=function(key){return store[key]||(store[key]={})}},{"./_global":20}],51:[function(require,module,exports){var toInteger=require("./_to-integer"),defined=require("./_defined");module.exports=function(TO_STRING){return function(that,pos){var s=String(defined(that)),i=toInteger(pos),l=s.length,a,b;if(i<0||i>=l)return TO_STRING?"":undefined;a=s.charCodeAt(i);return a<55296||a>56319||i+1===l||(b=s.charCodeAt(i+1))<56320||b>57343?TO_STRING?s.charAt(i):a:TO_STRING?s.slice(i,i+2):(a-55296<<10)+(b-56320)+65536}}},{"./_defined":13,"./_to-integer":53}],52:[function(require,module,exports){var toInteger=require("./_to-integer"),max=Math.max,min=Math.min;module.exports=function(index,length){index=toInteger(index);return index<0?max(index+length,0):min(index,length)}},{"./_to-integer":53}],53:[function(require,module,exports){var ceil=Math.ceil,floor=Math.floor;module.exports=function(it){return isNaN(it=+it)?0:(it>0?floor:ceil)(it)}},{}],54:[function(require,module,exports){var IObject=require("./_iobject"),defined=require("./_defined");module.exports=function(it){return IObject(defined(it))}},{"./_defined":13,"./_iobject":25}],55:[function(require,module,exports){var toInteger=require("./_to-integer"),min=Math.min;module.exports=function(it){return it>0?min(toInteger(it),9007199254740991):0}},{"./_to-integer":53}],56:[function(require,module,exports){var defined=require("./_defined");module.exports=function(it){return Object(defined(it))}},{"./_defined":13}],57:[function(require,module,exports){var isObject=require("./_is-object");module.exports=function(it,S){if(!isObject(it))return it;var fn,val;if(S&&typeof(fn=it.toString)=="function"&&!isObject(val=fn.call(it)))return val;if(typeof(fn=it.valueOf)=="function"&&!isObject(val=fn.call(it)))return val;if(!S&&typeof(fn=it.toString)=="function"&&!isObject(val=fn.call(it)))return val;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":27}],58:[function(require,module,exports){var id=0,px=Math.random();module.exports=function(key){return"Symbol(".concat(key===undefined?"":key,")_",(++id+px).toString(36))}},{}],59:[function(require,module,exports){var global=require("./_global"),core=require("./_core"),LIBRARY=require("./_library"),wksExt=require("./_wks-ext"),defineProperty=require("./_object-dp").f;module.exports=function(name){var $Symbol=core.Symbol||(core.Symbol=LIBRARY?{}:global.Symbol||{});if(name.charAt(0)!="_"&&!(name in $Symbol))defineProperty($Symbol,name,{value:wksExt.f(name)})}},{"./_core":11,"./_global":20,"./_library":33,"./_object-dp":36,"./_wks-ext":60}],60:[function(require,module,exports){exports.f=require("./_wks")},{"./_wks":61}],61:[function(require,module,exports){var store=require("./_shared")("wks"),uid=require("./_uid"),Symbol=require("./_global").Symbol,USE_SYMBOL=typeof Symbol=="function";var $exports=module.exports=function(name){return store[name]||(store[name]=USE_SYMBOL&&Symbol[name]||(USE_SYMBOL?Symbol:uid)("Symbol."+name))};$exports.store=store},{"./_global":20,"./_shared":50,"./_uid":58}],62:[function(require,module,exports){"use strict";var addToUnscopables=require("./_add-to-unscopables"),step=require("./_iter-step"),Iterators=require("./_iterators"),toIObject=require("./_to-iobject");module.exports=require("./_iter-define")(Array,"Array",function(iterated,kind){this._t=toIObject(iterated);this._i=0;this._k=kind},function(){var O=this._t,kind=this._k,index=this._i++;if(!O||index>=O.length){this._t=undefined;return step(1)}if(kind=="keys")return step(0,index);if(kind=="values")return step(0,O[index]);return step(0,[index,O[index]])},"values");Iterators.Arguments=Iterators.Array;addToUnscopables("keys");addToUnscopables("values");addToUnscopables("entries")},{"./_add-to-unscopables":7,"./_iter-define":29,"./_iter-step":30,"./_iterators":31,"./_to-iobject":54}],63:[function(require,module,exports){},{}],64:[function(require,module,exports){"use strict";var $at=require("./_string-at")(true);require("./_iter-define")(String,"String",function(iterated){this._t=String(iterated);this._i=0},function(){var O=this._t,index=this._i,point;if(index>=O.length)return{value:undefined,done:true};point=$at(O,index);this._i+=point.length;return{value:point,done:false}})},{"./_iter-define":29,"./_string-at":51}],65:[function(require,module,exports){"use strict";var global=require("./_global"),has=require("./_has"),DESCRIPTORS=require("./_descriptors"),$export=require("./_export"),redefine=require("./_redefine"),META=require("./_meta").KEY,$fails=require("./_fails"),shared=require("./_shared"),setToStringTag=require("./_set-to-string-tag"),uid=require("./_uid"),wks=require("./_wks"),wksExt=require("./_wks-ext"),wksDefine=require("./_wks-define"),keyOf=require("./_keyof"),enumKeys=require("./_enum-keys"),isArray=require("./_is-array"),anObject=require("./_an-object"),toIObject=require("./_to-iobject"),toPrimitive=require("./_to-primitive"),createDesc=require("./_property-desc"),_create=require("./_object-create"),gOPNExt=require("./_object-gopn-ext"),$GOPD=require("./_object-gopd"),$DP=require("./_object-dp"),$keys=require("./_object-keys"),gOPD=$GOPD.f,dP=$DP.f,gOPN=gOPNExt.f,$Symbol=global.Symbol,$JSON=global.JSON,_stringify=$JSON&&$JSON.stringify,PROTOTYPE="prototype",HIDDEN=wks("_hidden"),TO_PRIMITIVE=wks("toPrimitive"),isEnum={}.propertyIsEnumerable,SymbolRegistry=shared("symbol-registry"),AllSymbols=shared("symbols"),OPSymbols=shared("op-symbols"),ObjectProto=Object[PROTOTYPE],USE_NATIVE=typeof $Symbol=="function",QObject=global.QObject;var setter=!QObject||!QObject[PROTOTYPE]||!QObject[PROTOTYPE].findChild;var setSymbolDesc=DESCRIPTORS&&$fails(function(){return _create(dP({},"a",{get:function(){return dP(this,"a",{value:7}).a}})).a!=7})?function(it,key,D){var protoDesc=gOPD(ObjectProto,key);if(protoDesc)delete ObjectProto[key];dP(it,key,D);if(protoDesc&&it!==ObjectProto)dP(ObjectProto,key,protoDesc)}:dP;var wrap=function(tag){var sym=AllSymbols[tag]=_create($Symbol[PROTOTYPE]);sym._k=tag;return sym};var isSymbol=USE_NATIVE&&typeof $Symbol.iterator=="symbol"?function(it){return typeof it=="symbol"}:function(it){return it instanceof $Symbol};var $defineProperty=function defineProperty(it,key,D){if(it===ObjectProto)$defineProperty(OPSymbols,key,D);anObject(it);key=toPrimitive(key,true);anObject(D);if(has(AllSymbols,key)){if(!D.enumerable){if(!has(it,HIDDEN))dP(it,HIDDEN,createDesc(1,{}));it[HIDDEN][key]=true}else{if(has(it,HIDDEN)&&it[HIDDEN][key])it[HIDDEN][key]=false;D=_create(D,{enumerable:createDesc(0,false)})}return setSymbolDesc(it,key,D)}return dP(it,key,D)};var $defineProperties=function defineProperties(it,P){anObject(it);var keys=enumKeys(P=toIObject(P)),i=0,l=keys.length,key;while(l>i)$defineProperty(it,key=keys[i++],P[key]);return it};var $create=function create(it,P){return P===undefined?_create(it):$defineProperties(_create(it),P)};var $propertyIsEnumerable=function propertyIsEnumerable(key){var E=isEnum.call(this,key=toPrimitive(key,true));if(this===ObjectProto&&has(AllSymbols,key)&&!has(OPSymbols,key))return false;return E||!has(this,key)||!has(AllSymbols,key)||has(this,HIDDEN)&&this[HIDDEN][key]?E:true};var $getOwnPropertyDescriptor=function getOwnPropertyDescriptor(it,key){it=toIObject(it);key=toPrimitive(key,true);if(it===ObjectProto&&has(AllSymbols,key)&&!has(OPSymbols,key))return;var D=gOPD(it,key);if(D&&has(AllSymbols,key)&&!(has(it,HIDDEN)&&it[HIDDEN][key]))D.enumerable=true;return D};var $getOwnPropertyNames=function getOwnPropertyNames(it){var names=gOPN(toIObject(it)),result=[],i=0,key;while(names.length>i){if(!has(AllSymbols,key=names[i++])&&key!=HIDDEN&&key!=META)result.push(key)}return result};var $getOwnPropertySymbols=function getOwnPropertySymbols(it){var IS_OP=it===ObjectProto,names=gOPN(IS_OP?OPSymbols:toIObject(it)),result=[],i=0,key;while(names.length>i){if(has(AllSymbols,key=names[i++])&&(IS_OP?has(ObjectProto,key):true))result.push(AllSymbols[key])}return result};if(!USE_NATIVE){$Symbol=function Symbol(){if(this instanceof $Symbol)throw TypeError("Symbol is not a constructor!");var tag=uid(arguments.length>0?arguments[0]:undefined);var $set=function(value){if(this===ObjectProto)$set.call(OPSymbols,value);if(has(this,HIDDEN)&&has(this[HIDDEN],tag))this[HIDDEN][tag]=false;setSymbolDesc(this,tag,createDesc(1,value))};if(DESCRIPTORS&&setter)setSymbolDesc(ObjectProto,tag,{configurable:true,set:$set});return wrap(tag)};redefine($Symbol[PROTOTYPE],"toString",function toString(){return this._k});$GOPD.f=$getOwnPropertyDescriptor;$DP.f=$defineProperty;require("./_object-gopn").f=gOPNExt.f=$getOwnPropertyNames;require("./_object-pie").f=$propertyIsEnumerable;require("./_object-gops").f=$getOwnPropertySymbols;if(DESCRIPTORS&&!require("./_library")){redefine(ObjectProto,"propertyIsEnumerable",$propertyIsEnumerable,true)}wksExt.f=function(name){return wrap(wks(name))}}$export($export.G+$export.W+$export.F*!USE_NATIVE,{Symbol:$Symbol});for(var symbols="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),i=0;symbols.length>i;)wks(symbols[i++]);for(var symbols=$keys(wks.store),i=0;symbols.length>i;)wksDefine(symbols[i++]);$export($export.S+$export.F*!USE_NATIVE,"Symbol",{for:function(key){return has(SymbolRegistry,key+="")?SymbolRegistry[key]:SymbolRegistry[key]=$Symbol(key)},keyFor:function keyFor(key){if(isSymbol(key))return keyOf(SymbolRegistry,key);throw TypeError(key+" is not a symbol!")},useSetter:function(){setter=true},useSimple:function(){setter=false}});$export($export.S+$export.F*!USE_NATIVE,"Object",{create:$create,defineProperty:$defineProperty,defineProperties:$defineProperties,getOwnPropertyDescriptor:$getOwnPropertyDescriptor,getOwnPropertyNames:$getOwnPropertyNames,getOwnPropertySymbols:$getOwnPropertySymbols});$JSON&&$export($export.S+$export.F*(!USE_NATIVE||$fails(function(){var S=$Symbol();return _stringify([S])!="[null]"||_stringify({a:S})!="{}"||_stringify(Object(S))!="{}"})),"JSON",{stringify:function stringify(it){if(it===undefined||isSymbol(it))return;var args=[it],i=1,replacer,$replacer;while(arguments.length>i)args.push(arguments[i++]);replacer=args[1];if(typeof replacer=="function")$replacer=replacer;if($replacer||!isArray(replacer))replacer=function(key,value){if($replacer)value=$replacer.call(this,key,value);if(!isSymbol(value))return value};args[1]=replacer;return _stringify.apply($JSON,args)}});$Symbol[PROTOTYPE][TO_PRIMITIVE]||require("./_hide")($Symbol[PROTOTYPE],TO_PRIMITIVE,$Symbol[PROTOTYPE].valueOf);setToStringTag($Symbol,"Symbol");setToStringTag(Math,"Math",true);setToStringTag(global.JSON,"JSON",true)},{"./_an-object":8,"./_descriptors":14,"./_enum-keys":17,"./_export":18,"./_fails":19,"./_global":20,"./_has":21,"./_hide":22,"./_is-array":26,"./_keyof":32,"./_library":33,"./_meta":34,"./_object-create":35,"./_object-dp":36,"./_object-gopd":38,"./_object-gopn":40,"./_object-gopn-ext":39,"./_object-gops":41,"./_object-keys":44,"./_object-pie":45,"./_property-desc":46,"./_redefine":47,"./_set-to-string-tag":48,"./_shared":50,"./_to-iobject":54,"./_to-primitive":57,"./_uid":58,"./_wks":61,"./_wks-define":59,"./_wks-ext":60}],66:[function(require,module,exports){require("./_wks-define")("asyncIterator")},{"./_wks-define":59}],67:[function(require,module,exports){require("./_wks-define")("observable")},{"./_wks-define":59}],68:[function(require,module,exports){require("./es6.array.iterator");var global=require("./_global"),hide=require("./_hide"),Iterators=require("./_iterators"),TO_STRING_TAG=require("./_wks")("toStringTag");for(var collections=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],i=0;i<5;i++){var NAME=collections[i],Collection=global[NAME],proto=Collection&&Collection.prototype;if(proto&&!proto[TO_STRING_TAG])hide(proto,TO_STRING_TAG,NAME);Iterators[NAME]=Iterators.Array}},{"./_global":20,"./_hide":22,"./_iterators":31,"./_wks":61,"./es6.array.iterator":62}],69:[function(require,module,exports){(function(process,global){!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Promise=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof _dereq_=="function"&&_dereq_;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof _dereq_=="function"&&_dereq_;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){var SomePromiseArray=Promise._SomePromiseArray;function any(promises){var ret=new SomePromiseArray(promises);var promise=ret.promise();ret.setHowMany(1);ret.setUnwrap();ret.init();return promise}Promise.any=function(promises){return any(promises)};Promise.prototype.any=function(){return any(this)}}},{}],2:[function(_dereq_,module,exports){"use strict";var firstLineError;try{throw new Error}catch(e){firstLineError=e}var schedule=_dereq_("./schedule");var Queue=_dereq_("./queue");
var util=_dereq_("./util");function Async(){this._customScheduler=false;this._isTickUsed=false;this._lateQueue=new Queue(16);this._normalQueue=new Queue(16);this._haveDrainedQueues=false;this._trampolineEnabled=true;var self=this;this.drainQueues=function(){self._drainQueues()};this._schedule=schedule}Async.prototype.setScheduler=function(fn){var prev=this._schedule;this._schedule=fn;this._customScheduler=true;return prev};Async.prototype.hasCustomScheduler=function(){return this._customScheduler};Async.prototype.enableTrampoline=function(){this._trampolineEnabled=true};Async.prototype.disableTrampolineIfNecessary=function(){if(util.hasDevTools){this._trampolineEnabled=false}};Async.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues};Async.prototype.fatalError=function(e,isNode){if(isNode){process.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n");process.exit(2)}else{this.throwLater(e)}};Async.prototype.throwLater=function(fn,arg){if(arguments.length===1){arg=fn;fn=function(){throw arg}}if(typeof setTimeout!=="undefined"){setTimeout(function(){fn(arg)},0)}else try{this._schedule(function(){fn(arg)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}};function AsyncInvokeLater(fn,receiver,arg){this._lateQueue.push(fn,receiver,arg);this._queueTick()}function AsyncInvoke(fn,receiver,arg){this._normalQueue.push(fn,receiver,arg);this._queueTick()}function AsyncSettlePromises(promise){this._normalQueue._pushOne(promise);this._queueTick()}if(!util.hasDevTools){Async.prototype.invokeLater=AsyncInvokeLater;Async.prototype.invoke=AsyncInvoke;Async.prototype.settlePromises=AsyncSettlePromises}else{Async.prototype.invokeLater=function(fn,receiver,arg){if(this._trampolineEnabled){AsyncInvokeLater.call(this,fn,receiver,arg)}else{this._schedule(function(){setTimeout(function(){fn.call(receiver,arg)},100)})}};Async.prototype.invoke=function(fn,receiver,arg){if(this._trampolineEnabled){AsyncInvoke.call(this,fn,receiver,arg)}else{this._schedule(function(){fn.call(receiver,arg)})}};Async.prototype.settlePromises=function(promise){if(this._trampolineEnabled){AsyncSettlePromises.call(this,promise)}else{this._schedule(function(){promise._settlePromises()})}}}Async.prototype.invokeFirst=function(fn,receiver,arg){this._normalQueue.unshift(fn,receiver,arg);this._queueTick()};Async.prototype._drainQueue=function(queue){while(queue.length()>0){var fn=queue.shift();if(typeof fn!=="function"){fn._settlePromises();continue}var receiver=queue.shift();var arg=queue.shift();fn.call(receiver,arg)}};Async.prototype._drainQueues=function(){this._drainQueue(this._normalQueue);this._reset();this._haveDrainedQueues=true;this._drainQueue(this._lateQueue)};Async.prototype._queueTick=function(){if(!this._isTickUsed){this._isTickUsed=true;this._schedule(this.drainQueues)}};Async.prototype._reset=function(){this._isTickUsed=false};module.exports=Async;module.exports.firstLineError=firstLineError},{"./queue":26,"./schedule":29,"./util":36}],3:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,debug){var calledBind=false;var rejectThis=function(_,e){this._reject(e)};var targetRejected=function(e,context){context.promiseRejectionQueued=true;context.bindingPromise._then(rejectThis,rejectThis,null,this,e)};var bindingResolved=function(thisArg,context){if((this._bitField&50397184)===0){this._resolveCallback(context.target)}};var bindingRejected=function(e,context){if(!context.promiseRejectionQueued)this._reject(e)};Promise.prototype.bind=function(thisArg){if(!calledBind){calledBind=true;Promise.prototype._propagateFrom=debug.propagateFromFunction();Promise.prototype._boundValue=debug.boundValueFunction()}var maybePromise=tryConvertToPromise(thisArg);var ret=new Promise(INTERNAL);ret._propagateFrom(this,1);var target=this._target();ret._setBoundTo(maybePromise);if(maybePromise instanceof Promise){var context={promiseRejectionQueued:false,promise:ret,target:target,bindingPromise:maybePromise};target._then(INTERNAL,targetRejected,undefined,ret,context);maybePromise._then(bindingResolved,bindingRejected,undefined,ret,context);ret._setOnCancel(maybePromise)}else{ret._resolveCallback(target)}return ret};Promise.prototype._setBoundTo=function(obj){if(obj!==undefined){this._bitField=this._bitField|2097152;this._boundTo=obj}else{this._bitField=this._bitField&~2097152}};Promise.prototype._isBound=function(){return(this._bitField&2097152)===2097152};Promise.bind=function(thisArg,value){return Promise.resolve(value).bind(thisArg)}}},{}],4:[function(_dereq_,module,exports){"use strict";var old;if(typeof Promise!=="undefined")old=Promise;function noConflict(){try{if(Promise===bluebird)Promise=old}catch(e){}return bluebird}var bluebird=_dereq_("./promise")();bluebird.noConflict=noConflict;module.exports=bluebird},{"./promise":22}],5:[function(_dereq_,module,exports){"use strict";var cr=Object.create;if(cr){var callerCache=cr(null);var getterCache=cr(null);callerCache[" size"]=getterCache[" size"]=0}module.exports=function(Promise){var util=_dereq_("./util");var canEvaluate=util.canEvaluate;var isIdentifier=util.isIdentifier;var getMethodCaller;var getGetter;if(!true){var makeMethodCaller=function(methodName){return new Function("ensureMethod","                                    \n        return function(obj) {                                               \n            'use strict'                                                     \n            var len = this.length;                                           \n            ensureMethod(obj, 'methodName');                                 \n            switch(len) {                                                    \n                case 1: return obj.methodName(this[0]);                      \n                case 2: return obj.methodName(this[0], this[1]);             \n                case 3: return obj.methodName(this[0], this[1], this[2]);    \n                case 0: return obj.methodName();                             \n                default:                                                     \n                    return obj.methodName.apply(obj, this);                  \n            }                                                                \n        };                                                                   \n        ".replace(/methodName/g,methodName))(ensureMethod)};var makeGetter=function(propertyName){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",propertyName))};var getCompiled=function(name,compiler,cache){var ret=cache[name];if(typeof ret!=="function"){if(!isIdentifier(name)){return null}ret=compiler(name);cache[name]=ret;cache[" size"]++;if(cache[" size"]>512){var keys=Object.keys(cache);for(var i=0;i<256;++i)delete cache[keys[i]];cache[" size"]=keys.length-256}}return ret};getMethodCaller=function(name){return getCompiled(name,makeMethodCaller,callerCache)};getGetter=function(name){return getCompiled(name,makeGetter,getterCache)}}function ensureMethod(obj,methodName){var fn;if(obj!=null)fn=obj[methodName];if(typeof fn!=="function"){var message="Object "+util.classString(obj)+" has no method '"+util.toString(methodName)+"'";throw new Promise.TypeError(message)}return fn}function caller(obj){var methodName=this.pop();var fn=ensureMethod(obj,methodName);return fn.apply(obj,this)}Promise.prototype.call=function(methodName){var args=[].slice.call(arguments,1);if(!true){if(canEvaluate){var maybeCaller=getMethodCaller(methodName);if(maybeCaller!==null){return this._then(maybeCaller,undefined,undefined,args,undefined)}}}args.push(methodName);return this._then(caller,undefined,undefined,args,undefined)};function namedGetter(obj){return obj[this]}function indexedGetter(obj){var index=+this;if(index<0)index=Math.max(0,index+obj.length);return obj[index]}Promise.prototype.get=function(propertyName){var isIndex=typeof propertyName==="number";var getter;if(!isIndex){if(canEvaluate){var maybeGetter=getGetter(propertyName);getter=maybeGetter!==null?maybeGetter:namedGetter}else{getter=namedGetter}}else{getter=indexedGetter}return this._then(getter,undefined,undefined,propertyName,undefined)}}},{"./util":36}],6:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,debug){var util=_dereq_("./util");var tryCatch=util.tryCatch;var errorObj=util.errorObj;var async=Promise._async;Promise.prototype["break"]=Promise.prototype.cancel=function(){if(!debug.cancellation())return this._warn("cancellation is disabled");var promise=this;var child=promise;while(promise._isCancellable()){if(!promise._cancelBy(child)){if(child._isFollowing()){child._followee().cancel()}else{child._cancelBranched()}break}var parent=promise._cancellationParent;if(parent==null||!parent._isCancellable()){if(promise._isFollowing()){promise._followee().cancel()}else{promise._cancelBranched()}break}else{if(promise._isFollowing())promise._followee().cancel();promise._setWillBeCancelled();child=promise;promise=parent}}};Promise.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--};Promise.prototype._enoughBranchesHaveCancelled=function(){return this._branchesRemainingToCancel===undefined||this._branchesRemainingToCancel<=0};Promise.prototype._cancelBy=function(canceller){if(canceller===this){this._branchesRemainingToCancel=0;this._invokeOnCancel();return true}else{this._branchHasCancelled();if(this._enoughBranchesHaveCancelled()){this._invokeOnCancel();return true}}return false};Promise.prototype._cancelBranched=function(){if(this._enoughBranchesHaveCancelled()){this._cancel()}};Promise.prototype._cancel=function(){if(!this._isCancellable())return;this._setCancelled();async.invoke(this._cancelPromises,this,undefined)};Promise.prototype._cancelPromises=function(){if(this._length()>0)this._settlePromises()};Promise.prototype._unsetOnCancel=function(){this._onCancelField=undefined};Promise.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()};Promise.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()};Promise.prototype._doInvokeOnCancel=function(onCancelCallback,internalOnly){if(util.isArray(onCancelCallback)){for(var i=0;i<onCancelCallback.length;++i){this._doInvokeOnCancel(onCancelCallback[i],internalOnly)}}else if(onCancelCallback!==undefined){if(typeof onCancelCallback==="function"){if(!internalOnly){var e=tryCatch(onCancelCallback).call(this._boundValue());if(e===errorObj){this._attachExtraTrace(e.e);async.throwLater(e.e)}}}else{onCancelCallback._resultCancelled(this)}}};Promise.prototype._invokeOnCancel=function(){var onCancelCallback=this._onCancel();this._unsetOnCancel();async.invoke(this._doInvokeOnCancel,this,onCancelCallback)};Promise.prototype._invokeInternalOnCancel=function(){if(this._isCancellable()){this._doInvokeOnCancel(this._onCancel(),true);this._unsetOnCancel()}};Promise.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(_dereq_,module,exports){"use strict";module.exports=function(NEXT_FILTER){var util=_dereq_("./util");var getKeys=_dereq_("./es5").keys;var tryCatch=util.tryCatch;var errorObj=util.errorObj;function catchFilter(instances,cb,promise){return function(e){var boundTo=promise._boundValue();predicateLoop:for(var i=0;i<instances.length;++i){var item=instances[i];if(item===Error||item!=null&&item.prototype instanceof Error){if(e instanceof item){return tryCatch(cb).call(boundTo,e)}}else if(typeof item==="function"){var matchesPredicate=tryCatch(item).call(boundTo,e);if(matchesPredicate===errorObj){return matchesPredicate}else if(matchesPredicate){return tryCatch(cb).call(boundTo,e)}}else if(util.isObject(e)){var keys=getKeys(item);for(var j=0;j<keys.length;++j){var key=keys[j];if(item[key]!=e[key]){continue predicateLoop}}return tryCatch(cb).call(boundTo,e)}}return NEXT_FILTER}}return catchFilter}},{"./es5":13,"./util":36}],8:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){var longStackTraces=false;var contextStack=[];Promise.prototype._promiseCreated=function(){};Promise.prototype._pushContext=function(){};Promise.prototype._popContext=function(){return null};Promise._peekContext=Promise.prototype._peekContext=function(){};function Context(){this._trace=new Context.CapturedTrace(peekContext())}Context.prototype._pushContext=function(){if(this._trace!==undefined){this._trace._promiseCreated=null;contextStack.push(this._trace)}};Context.prototype._popContext=function(){if(this._trace!==undefined){var trace=contextStack.pop();var ret=trace._promiseCreated;trace._promiseCreated=null;return ret}return null};function createContext(){if(longStackTraces)return new Context}function peekContext(){var lastIndex=contextStack.length-1;if(lastIndex>=0){return contextStack[lastIndex]}return undefined}Context.CapturedTrace=null;Context.create=createContext;Context.deactivateLongStackTraces=function(){};Context.activateLongStackTraces=function(){var Promise_pushContext=Promise.prototype._pushContext;var Promise_popContext=Promise.prototype._popContext;var Promise_PeekContext=Promise._peekContext;var Promise_peekContext=Promise.prototype._peekContext;var Promise_promiseCreated=Promise.prototype._promiseCreated;Context.deactivateLongStackTraces=function(){Promise.prototype._pushContext=Promise_pushContext;Promise.prototype._popContext=Promise_popContext;Promise._peekContext=Promise_PeekContext;Promise.prototype._peekContext=Promise_peekContext;Promise.prototype._promiseCreated=Promise_promiseCreated;longStackTraces=false};longStackTraces=true;Promise.prototype._pushContext=Context.prototype._pushContext;Promise.prototype._popContext=Context.prototype._popContext;Promise._peekContext=Promise.prototype._peekContext=peekContext;Promise.prototype._promiseCreated=function(){var ctx=this._peekContext();if(ctx&&ctx._promiseCreated==null)ctx._promiseCreated=this}};return Context}},{}],9:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,Context){var getDomain=Promise._getDomain;var async=Promise._async;var Warning=_dereq_("./errors").Warning;var util=_dereq_("./util");var canAttachTrace=util.canAttachTrace;var unhandledRejectionHandled;var possiblyUnhandledRejection;var bluebirdFramePattern=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/;var nodeFramePattern=/\((?:timers\.js):\d+:\d+\)/;var parseLinePattern=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/;var stackFramePattern=null;var formatStack=null;var indentStackFrames=false;var printWarning;var debugging=!!(util.env("BLUEBIRD_DEBUG")!=0&&(true||util.env("BLUEBIRD_DEBUG")||util.env("NODE_ENV")==="development"));var warnings=!!(util.env("BLUEBIRD_WARNINGS")!=0&&(debugging||util.env("BLUEBIRD_WARNINGS")));var longStackTraces=!!(util.env("BLUEBIRD_LONG_STACK_TRACES")!=0&&(debugging||util.env("BLUEBIRD_LONG_STACK_TRACES")));var wForgottenReturn=util.env("BLUEBIRD_W_FORGOTTEN_RETURN")!=0&&(warnings||!!util.env("BLUEBIRD_W_FORGOTTEN_RETURN"));Promise.prototype.suppressUnhandledRejections=function(){var target=this._target();target._bitField=target._bitField&~1048576|524288};Promise.prototype._ensurePossibleRejectionHandled=function(){if((this._bitField&524288)!==0)return;this._setRejectionIsUnhandled();async.invokeLater(this._notifyUnhandledRejection,this,undefined)};Promise.prototype._notifyUnhandledRejectionIsHandled=function(){fireRejectionEvent("rejectionHandled",unhandledRejectionHandled,undefined,this)};Promise.prototype._setReturnedNonUndefined=function(){this._bitField=this._bitField|268435456};Promise.prototype._returnedNonUndefined=function(){return(this._bitField&268435456)!==0};Promise.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var reason=this._settledValue();this._setUnhandledRejectionIsNotified();fireRejectionEvent("unhandledRejection",possiblyUnhandledRejection,reason,this)}};Promise.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=this._bitField|262144};Promise.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&~262144};Promise.prototype._isUnhandledRejectionNotified=function(){return(this._bitField&262144)>0};Promise.prototype._setRejectionIsUnhandled=function(){this._bitField=this._bitField|1048576};Promise.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&~1048576;if(this._isUnhandledRejectionNotified()){this._unsetUnhandledRejectionIsNotified();this._notifyUnhandledRejectionIsHandled()}};Promise.prototype._isRejectionUnhandled=function(){return(this._bitField&1048576)>0};Promise.prototype._warn=function(message,shouldUseOwnTrace,promise){return warn(message,shouldUseOwnTrace,promise||this)};Promise.onPossiblyUnhandledRejection=function(fn){var domain=getDomain();possiblyUnhandledRejection=typeof fn==="function"?domain===null?fn:util.domainBind(domain,fn):undefined};Promise.onUnhandledRejectionHandled=function(fn){var domain=getDomain();unhandledRejectionHandled=typeof fn==="function"?domain===null?fn:util.domainBind(domain,fn):undefined};var disableLongStackTraces=function(){};Promise.longStackTraces=function(){if(async.haveItemsQueued()&&!config.longStackTraces){throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n")}if(!config.longStackTraces&&longStackTracesIsSupported()){var Promise_captureStackTrace=Promise.prototype._captureStackTrace;var Promise_attachExtraTrace=Promise.prototype._attachExtraTrace;config.longStackTraces=true;disableLongStackTraces=function(){if(async.haveItemsQueued()&&!config.longStackTraces){throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n")}Promise.prototype._captureStackTrace=Promise_captureStackTrace;Promise.prototype._attachExtraTrace=Promise_attachExtraTrace;Context.deactivateLongStackTraces();async.enableTrampoline();config.longStackTraces=false};Promise.prototype._captureStackTrace=longStackTracesCaptureStackTrace;Promise.prototype._attachExtraTrace=longStackTracesAttachExtraTrace;Context.activateLongStackTraces();async.disableTrampolineIfNecessary()}};Promise.hasLongStackTraces=function(){return config.longStackTraces&&longStackTracesIsSupported()};var fireDomEvent=function(){try{if(typeof CustomEvent==="function"){var event=new CustomEvent("CustomEvent");util.global.dispatchEvent(event);return function(name,event){var domEvent=new CustomEvent(name.toLowerCase(),{detail:event,cancelable:true});return!util.global.dispatchEvent(domEvent)}}else if(typeof Event==="function"){var event=new Event("CustomEvent");util.global.dispatchEvent(event);return function(name,event){var domEvent=new Event(name.toLowerCase(),{cancelable:true});domEvent.detail=event;return!util.global.dispatchEvent(domEvent)}}else{var event=document.createEvent("CustomEvent");event.initCustomEvent("testingtheevent",false,true,{});util.global.dispatchEvent(event);return function(name,event){var domEvent=document.createEvent("CustomEvent");domEvent.initCustomEvent(name.toLowerCase(),false,true,event);return!util.global.dispatchEvent(domEvent)}}}catch(e){}return function(){return false}}();var fireGlobalEvent=function(){if(util.isNode){return function(){return process.emit.apply(process,arguments)}}else{if(!util.global){return function(){return false}}return function(name){var methodName="on"+name.toLowerCase();var method=util.global[methodName];if(!method)return false;method.apply(util.global,[].slice.call(arguments,1));return true}}}();function generatePromiseLifecycleEventObject(name,promise){return{promise:promise}}var eventToObjectGenerator={promiseCreated:generatePromiseLifecycleEventObject,promiseFulfilled:generatePromiseLifecycleEventObject,promiseRejected:generatePromiseLifecycleEventObject,promiseResolved:generatePromiseLifecycleEventObject,promiseCancelled:generatePromiseLifecycleEventObject,promiseChained:function(name,promise,child){return{promise:promise,child:child}},warning:function(name,warning){return{warning:warning}},unhandledRejection:function(name,reason,promise){return{reason:reason,promise:promise}},rejectionHandled:generatePromiseLifecycleEventObject};var activeFireEvent=function(name){var globalEventFired=false;try{globalEventFired=fireGlobalEvent.apply(null,arguments)}catch(e){async.throwLater(e);globalEventFired=true}var domEventFired=false;try{domEventFired=fireDomEvent(name,eventToObjectGenerator[name].apply(null,arguments))}catch(e){async.throwLater(e);domEventFired=true}return domEventFired||globalEventFired};Promise.config=function(opts){opts=Object(opts);if("longStackTraces"in opts){if(opts.longStackTraces){Promise.longStackTraces()}else if(!opts.longStackTraces&&Promise.hasLongStackTraces()){disableLongStackTraces()}}if("warnings"in opts){var warningsOption=opts.warnings;config.warnings=!!warningsOption;wForgottenReturn=config.warnings;if(util.isObject(warningsOption)){if("wForgottenReturn"in warningsOption){wForgottenReturn=!!warningsOption.wForgottenReturn}}}if("cancellation"in opts&&opts.cancellation&&!config.cancellation){if(async.haveItemsQueued()){throw new Error("cannot enable cancellation after promises are in use")}Promise.prototype._clearCancellationData=cancellationClearCancellationData;Promise.prototype._propagateFrom=cancellationPropagateFrom;Promise.prototype._onCancel=cancellationOnCancel;Promise.prototype._setOnCancel=cancellationSetOnCancel;Promise.prototype._attachCancellationCallback=cancellationAttachCancellationCallback;Promise.prototype._execute=cancellationExecute;propagateFromFunction=cancellationPropagateFrom;config.cancellation=true}if("monitoring"in opts){if(opts.monitoring&&!config.monitoring){config.monitoring=true;Promise.prototype._fireEvent=activeFireEvent}else if(!opts.monitoring&&config.monitoring){config.monitoring=false;Promise.prototype._fireEvent=defaultFireEvent}}};function defaultFireEvent(){return false}Promise.prototype._fireEvent=defaultFireEvent;Promise.prototype._execute=function(executor,resolve,reject){try{executor(resolve,reject)}catch(e){return e}};Promise.prototype._onCancel=function(){};Promise.prototype._setOnCancel=function(handler){};Promise.prototype._attachCancellationCallback=function(onCancel){};Promise.prototype._captureStackTrace=function(){};Promise.prototype._attachExtraTrace=function(){};Promise.prototype._clearCancellationData=function(){};Promise.prototype._propagateFrom=function(parent,flags){};function cancellationExecute(executor,resolve,reject){var promise=this;try{executor(resolve,reject,function(onCancel){if(typeof onCancel!=="function"){throw new TypeError("onCancel must be a function, got: "+util.toString(onCancel))}promise._attachCancellationCallback(onCancel)})}catch(e){return e}}function cancellationAttachCancellationCallback(onCancel){if(!this._isCancellable())return this;var previousOnCancel=this._onCancel();if(previousOnCancel!==undefined){if(util.isArray(previousOnCancel)){previousOnCancel.push(onCancel)}else{this._setOnCancel([previousOnCancel,onCancel])}}else{this._setOnCancel(onCancel)}}function cancellationOnCancel(){return this._onCancelField}function cancellationSetOnCancel(onCancel){this._onCancelField=onCancel}function cancellationClearCancellationData(){this._cancellationParent=undefined;this._onCancelField=undefined}function cancellationPropagateFrom(parent,flags){if((flags&1)!==0){this._cancellationParent=parent;var branchesRemainingToCancel=parent._branchesRemainingToCancel;if(branchesRemainingToCancel===undefined){branchesRemainingToCancel=0}parent._branchesRemainingToCancel=branchesRemainingToCancel+1}if((flags&2)!==0&&parent._isBound()){this._setBoundTo(parent._boundTo)}}function bindingPropagateFrom(parent,flags){if((flags&2)!==0&&parent._isBound()){this._setBoundTo(parent._boundTo)}}var propagateFromFunction=bindingPropagateFrom;function boundValueFunction(){var ret=this._boundTo;if(ret!==undefined){if(ret instanceof Promise){if(ret.isFulfilled()){return ret.value()}else{return undefined}}}return ret}function longStackTracesCaptureStackTrace(){this._trace=new CapturedTrace(this._peekContext())}function longStackTracesAttachExtraTrace(error,ignoreSelf){if(canAttachTrace(error)){var trace=this._trace;if(trace!==undefined){if(ignoreSelf)trace=trace._parent}if(trace!==undefined){trace.attachExtraTrace(error)}else if(!error.__stackCleaned__){var parsed=parseStackAndMessage(error);util.notEnumerableProp(error,"stack",parsed.message+"\n"+parsed.stack.join("\n"));util.notEnumerableProp(error,"__stackCleaned__",true)}}}function checkForgottenReturns(returnValue,promiseCreated,name,promise,parent){if(returnValue===undefined&&promiseCreated!==null&&wForgottenReturn){if(parent!==undefined&&parent._returnedNonUndefined())return;if((promise._bitField&65535)===0)return;if(name)name=name+" ";var handlerLine="";var creatorLine="";if(promiseCreated._trace){var traceLines=promiseCreated._trace.stack.split("\n");var stack=cleanStack(traceLines);for(var i=stack.length-1;i>=0;--i){var line=stack[i];if(!nodeFramePattern.test(line)){var lineMatches=line.match(parseLinePattern);if(lineMatches){handlerLine="at "+lineMatches[1]+":"+lineMatches[2]+":"+lineMatches[3]+" "}break}}if(stack.length>0){var firstUserLine=stack[0];for(var i=0;i<traceLines.length;++i){if(traceLines[i]===firstUserLine){if(i>0){creatorLine="\n"+traceLines[i-1]}break}}}}var msg="a promise was created in a "+name+"handler "+handlerLine+"but was not returned from it, "+"see http://goo.gl/rRqMUw"+creatorLine;promise._warn(msg,true,promiseCreated)}}function deprecated(name,replacement){var message=name+" is deprecated and will be removed in a future version.";if(replacement)message+=" Use "+replacement+" instead.";return warn(message)}function warn(message,shouldUseOwnTrace,promise){if(!config.warnings)return;var warning=new Warning(message);var ctx;if(shouldUseOwnTrace){promise._attachExtraTrace(warning)}else if(config.longStackTraces&&(ctx=Promise._peekContext())){ctx.attachExtraTrace(warning)}else{var parsed=parseStackAndMessage(warning);warning.stack=parsed.message+"\n"+parsed.stack.join("\n")}if(!activeFireEvent("warning",warning)){formatAndLogError(warning,"",true)}}function reconstructStack(message,stacks){for(var i=0;i<stacks.length-1;++i){stacks[i].push("From previous event:");stacks[i]=stacks[i].join("\n")}if(i<stacks.length){stacks[i]=stacks[i].join("\n")}return message+"\n"+stacks.join("\n")}function removeDuplicateOrEmptyJumps(stacks){for(var i=0;i<stacks.length;++i){if(stacks[i].length===0||i+1<stacks.length&&stacks[i][0]===stacks[i+1][0]){stacks.splice(i,1);i--}}}function removeCommonRoots(stacks){var current=stacks[0];for(var i=1;i<stacks.length;++i){var prev=stacks[i];var currentLastIndex=current.length-1;var currentLastLine=current[currentLastIndex];var commonRootMeetPoint=-1;for(var j=prev.length-1;j>=0;--j){if(prev[j]===currentLastLine){commonRootMeetPoint=j;break}}for(var j=commonRootMeetPoint;j>=0;--j){var line=prev[j];if(current[currentLastIndex]===line){current.pop();currentLastIndex--}else{break}}current=prev}}function cleanStack(stack){var ret=[];for(var i=0;i<stack.length;++i){var line=stack[i];var isTraceLine="    (No stack trace)"===line||stackFramePattern.test(line);var isInternalFrame=isTraceLine&&shouldIgnore(line);if(isTraceLine&&!isInternalFrame){if(indentStackFrames&&line.charAt(0)!==" "){line="    "+line}ret.push(line)}}return ret}function stackFramesAsArray(error){var stack=error.stack.replace(/\s+$/g,"").split("\n");for(var i=0;i<stack.length;++i){var line=stack[i];if("    (No stack trace)"===line||stackFramePattern.test(line)){break}}if(i>0){stack=stack.slice(i)}return stack}function parseStackAndMessage(error){var stack=error.stack;var message=error.toString();stack=typeof stack==="string"&&stack.length>0?stackFramesAsArray(error):["    (No stack trace)"];return{message:message,stack:cleanStack(stack)}}function formatAndLogError(error,title,isSoft){if(typeof console!=="undefined"){var message;if(util.isObject(error)){var stack=error.stack;message=title+formatStack(stack,error)}else{message=title+String(error)}if(typeof printWarning==="function"){printWarning(message,isSoft)}else if(typeof console.log==="function"||typeof console.log==="object"){console.log(message)}}}function fireRejectionEvent(name,localHandler,reason,promise){var localEventFired=false;try{if(typeof localHandler==="function"){localEventFired=true;if(name==="rejectionHandled"){localHandler(promise)}else{localHandler(reason,promise)}}}catch(e){async.throwLater(e)}if(name==="unhandledRejection"){if(!activeFireEvent(name,reason,promise)&&!localEventFired){formatAndLogError(reason,"Unhandled rejection ")}}else{activeFireEvent(name,promise)}}function formatNonError(obj){var str;if(typeof obj==="function"){str="[function "+(obj.name||"anonymous")+"]"}else{str=obj&&typeof obj.toString==="function"?obj.toString():util.toString(obj);var ruselessToString=/\[object [a-zA-Z0-9$_]+\]/;if(ruselessToString.test(str)){try{var newStr=JSON.stringify(obj);str=newStr}catch(e){}}if(str.length===0){str="(empty array)"}}return"(<"+snip(str)+">, no stack trace)"}function snip(str){var maxChars=41;if(str.length<maxChars){return str}return str.substr(0,maxChars-3)+"..."}function longStackTracesIsSupported(){return typeof captureStackTrace==="function"}var shouldIgnore=function(){return false};var parseLineInfoRegex=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function parseLineInfo(line){var matches=line.match(parseLineInfoRegex);if(matches){return{fileName:matches[1],line:parseInt(matches[2],10)}}}function setBounds(firstLineError,lastLineError){if(!longStackTracesIsSupported())return;var firstStackLines=firstLineError.stack.split("\n");var lastStackLines=lastLineError.stack.split("\n");var firstIndex=-1;var lastIndex=-1;var firstFileName;var lastFileName;for(var i=0;i<firstStackLines.length;++i){var result=parseLineInfo(firstStackLines[i]);if(result){firstFileName=result.fileName;firstIndex=result.line;break}}for(var i=0;i<lastStackLines.length;++i){var result=parseLineInfo(lastStackLines[i]);if(result){lastFileName=result.fileName;lastIndex=result.line;break}}if(firstIndex<0||lastIndex<0||!firstFileName||!lastFileName||firstFileName!==lastFileName||firstIndex>=lastIndex){return}shouldIgnore=function(line){if(bluebirdFramePattern.test(line))return true;var info=parseLineInfo(line);if(info){if(info.fileName===firstFileName&&(firstIndex<=info.line&&info.line<=lastIndex)){return true}}return false}}function CapturedTrace(parent){this._parent=parent;this._promisesCreated=0;var length=this._length=1+(parent===undefined?0:parent._length);captureStackTrace(this,CapturedTrace);if(length>32)this.uncycle()}util.inherits(CapturedTrace,Error);Context.CapturedTrace=CapturedTrace;CapturedTrace.prototype.uncycle=function(){var length=this._length;if(length<2)return;var nodes=[];var stackToIndex={};for(var i=0,node=this;node!==undefined;++i){nodes.push(node);node=node._parent}length=this._length=i;for(var i=length-1;i>=0;--i){var stack=nodes[i].stack;if(stackToIndex[stack]===undefined){stackToIndex[stack]=i}}for(var i=0;i<length;++i){var currentStack=nodes[i].stack;var index=stackToIndex[currentStack];if(index!==undefined&&index!==i){if(index>0){nodes[index-1]._parent=undefined;nodes[index-1]._length=1}nodes[i]._parent=undefined;nodes[i]._length=1;var cycleEdgeNode=i>0?nodes[i-1]:this;if(index<length-1){cycleEdgeNode._parent=nodes[index+1];cycleEdgeNode._parent.uncycle();cycleEdgeNode._length=cycleEdgeNode._parent._length+1}else{cycleEdgeNode._parent=undefined;cycleEdgeNode._length=1}var currentChildLength=cycleEdgeNode._length+1;for(var j=i-2;j>=0;--j){nodes[j]._length=currentChildLength;currentChildLength++}return}}};CapturedTrace.prototype.attachExtraTrace=function(error){if(error.__stackCleaned__)return;this.uncycle();
var parsed=parseStackAndMessage(error);var message=parsed.message;var stacks=[parsed.stack];var trace=this;while(trace!==undefined){stacks.push(cleanStack(trace.stack.split("\n")));trace=trace._parent}removeCommonRoots(stacks);removeDuplicateOrEmptyJumps(stacks);util.notEnumerableProp(error,"stack",reconstructStack(message,stacks));util.notEnumerableProp(error,"__stackCleaned__",true)};var captureStackTrace=function stackDetection(){var v8stackFramePattern=/^\s*at\s*/;var v8stackFormatter=function(stack,error){if(typeof stack==="string")return stack;if(error.name!==undefined&&error.message!==undefined){return error.toString()}return formatNonError(error)};if(typeof Error.stackTraceLimit==="number"&&typeof Error.captureStackTrace==="function"){Error.stackTraceLimit+=6;stackFramePattern=v8stackFramePattern;formatStack=v8stackFormatter;var captureStackTrace=Error.captureStackTrace;shouldIgnore=function(line){return bluebirdFramePattern.test(line)};return function(receiver,ignoreUntil){Error.stackTraceLimit+=6;captureStackTrace(receiver,ignoreUntil);Error.stackTraceLimit-=6}}var err=new Error;if(typeof err.stack==="string"&&err.stack.split("\n")[0].indexOf("stackDetection@")>=0){stackFramePattern=/@/;formatStack=v8stackFormatter;indentStackFrames=true;return function captureStackTrace(o){o.stack=(new Error).stack}}var hasStackAfterThrow;try{throw new Error}catch(e){hasStackAfterThrow="stack"in e}if(!("stack"in err)&&hasStackAfterThrow&&typeof Error.stackTraceLimit==="number"){stackFramePattern=v8stackFramePattern;formatStack=v8stackFormatter;return function captureStackTrace(o){Error.stackTraceLimit+=6;try{throw new Error}catch(e){o.stack=e.stack}Error.stackTraceLimit-=6}}formatStack=function(stack,error){if(typeof stack==="string")return stack;if((typeof error==="object"||typeof error==="function")&&error.name!==undefined&&error.message!==undefined){return error.toString()}return formatNonError(error)};return null}([]);if(typeof console!=="undefined"&&typeof console.warn!=="undefined"){printWarning=function(message){console.warn(message)};if(util.isNode&&process.stderr.isTTY){printWarning=function(message,isSoft){var color=isSoft?"[33m":"[31m";console.warn(color+message+"[0m\n")}}else if(!util.isNode&&typeof(new Error).stack==="string"){printWarning=function(message,isSoft){console.warn("%c"+message,isSoft?"color: darkorange":"color: red")}}}var config={warnings:warnings,longStackTraces:false,cancellation:false,monitoring:false};if(longStackTraces)Promise.longStackTraces();return{longStackTraces:function(){return config.longStackTraces},warnings:function(){return config.warnings},cancellation:function(){return config.cancellation},monitoring:function(){return config.monitoring},propagateFromFunction:function(){return propagateFromFunction},boundValueFunction:function(){return boundValueFunction},checkForgottenReturns:checkForgottenReturns,setBounds:setBounds,warn:warn,deprecated:deprecated,CapturedTrace:CapturedTrace,fireDomEvent:fireDomEvent,fireGlobalEvent:fireGlobalEvent}}},{"./errors":12,"./util":36}],10:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function returner(){return this.value}function thrower(){throw this.reason}Promise.prototype["return"]=Promise.prototype.thenReturn=function(value){if(value instanceof Promise)value.suppressUnhandledRejections();return this._then(returner,undefined,undefined,{value:value},undefined)};Promise.prototype["throw"]=Promise.prototype.thenThrow=function(reason){return this._then(thrower,undefined,undefined,{reason:reason},undefined)};Promise.prototype.catchThrow=function(reason){if(arguments.length<=1){return this._then(undefined,thrower,undefined,{reason:reason},undefined)}else{var _reason=arguments[1];var handler=function(){throw _reason};return this.caught(reason,handler)}};Promise.prototype.catchReturn=function(value){if(arguments.length<=1){if(value instanceof Promise)value.suppressUnhandledRejections();return this._then(undefined,returner,undefined,{value:value},undefined)}else{var _value=arguments[1];if(_value instanceof Promise)_value.suppressUnhandledRejections();var handler=function(){return _value};return this.caught(value,handler)}}}},{}],11:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var PromiseReduce=Promise.reduce;var PromiseAll=Promise.all;function promiseAllThis(){return PromiseAll(this)}function PromiseMapSeries(promises,fn){return PromiseReduce(promises,fn,INTERNAL,INTERNAL)}Promise.prototype.each=function(fn){return PromiseReduce(this,fn,INTERNAL,0)._then(promiseAllThis,undefined,undefined,this,undefined)};Promise.prototype.mapSeries=function(fn){return PromiseReduce(this,fn,INTERNAL,INTERNAL)};Promise.each=function(promises,fn){return PromiseReduce(promises,fn,INTERNAL,0)._then(promiseAllThis,undefined,undefined,promises,undefined)};Promise.mapSeries=PromiseMapSeries}},{}],12:[function(_dereq_,module,exports){"use strict";var es5=_dereq_("./es5");var Objectfreeze=es5.freeze;var util=_dereq_("./util");var inherits=util.inherits;var notEnumerableProp=util.notEnumerableProp;function subError(nameProperty,defaultMessage){function SubError(message){if(!(this instanceof SubError))return new SubError(message);notEnumerableProp(this,"message",typeof message==="string"?message:defaultMessage);notEnumerableProp(this,"name",nameProperty);if(Error.captureStackTrace){Error.captureStackTrace(this,this.constructor)}else{Error.call(this)}}inherits(SubError,Error);return SubError}var _TypeError,_RangeError;var Warning=subError("Warning","warning");var CancellationError=subError("CancellationError","cancellation error");var TimeoutError=subError("TimeoutError","timeout error");var AggregateError=subError("AggregateError","aggregate error");try{_TypeError=TypeError;_RangeError=RangeError}catch(e){_TypeError=subError("TypeError","type error");_RangeError=subError("RangeError","range error")}var methods=("join pop push shift unshift slice filter forEach some "+"every map indexOf lastIndexOf reduce reduceRight sort reverse").split(" ");for(var i=0;i<methods.length;++i){if(typeof Array.prototype[methods[i]]==="function"){AggregateError.prototype[methods[i]]=Array.prototype[methods[i]]}}es5.defineProperty(AggregateError.prototype,"length",{value:0,configurable:false,writable:true,enumerable:true});AggregateError.prototype["isOperational"]=true;var level=0;AggregateError.prototype.toString=function(){var indent=Array(level*4+1).join(" ");var ret="\n"+indent+"AggregateError of:"+"\n";level++;indent=Array(level*4+1).join(" ");for(var i=0;i<this.length;++i){var str=this[i]===this?"[Circular AggregateError]":this[i]+"";var lines=str.split("\n");for(var j=0;j<lines.length;++j){lines[j]=indent+lines[j]}str=lines.join("\n");ret+=str+"\n"}level--;return ret};function OperationalError(message){if(!(this instanceof OperationalError))return new OperationalError(message);notEnumerableProp(this,"name","OperationalError");notEnumerableProp(this,"message",message);this.cause=message;this["isOperational"]=true;if(message instanceof Error){notEnumerableProp(this,"message",message.message);notEnumerableProp(this,"stack",message.stack)}else if(Error.captureStackTrace){Error.captureStackTrace(this,this.constructor)}}inherits(OperationalError,Error);var errorTypes=Error["__BluebirdErrorTypes__"];if(!errorTypes){errorTypes=Objectfreeze({CancellationError:CancellationError,TimeoutError:TimeoutError,OperationalError:OperationalError,RejectionError:OperationalError,AggregateError:AggregateError});es5.defineProperty(Error,"__BluebirdErrorTypes__",{value:errorTypes,writable:false,enumerable:false,configurable:false})}module.exports={Error:Error,TypeError:_TypeError,RangeError:_RangeError,CancellationError:errorTypes.CancellationError,OperationalError:errorTypes.OperationalError,TimeoutError:errorTypes.TimeoutError,AggregateError:errorTypes.AggregateError,Warning:Warning}},{"./es5":13,"./util":36}],13:[function(_dereq_,module,exports){var isES5=function(){"use strict";return this===undefined}();if(isES5){module.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:isES5,propertyIsWritable:function(obj,prop){var descriptor=Object.getOwnPropertyDescriptor(obj,prop);return!!(!descriptor||descriptor.writable||descriptor.set)}}}else{var has={}.hasOwnProperty;var str={}.toString;var proto={}.constructor.prototype;var ObjectKeys=function(o){var ret=[];for(var key in o){if(has.call(o,key)){ret.push(key)}}return ret};var ObjectGetDescriptor=function(o,key){return{value:o[key]}};var ObjectDefineProperty=function(o,key,desc){o[key]=desc.value;return o};var ObjectFreeze=function(obj){return obj};var ObjectGetPrototypeOf=function(obj){try{return Object(obj).constructor.prototype}catch(e){return proto}};var ArrayIsArray=function(obj){try{return str.call(obj)==="[object Array]"}catch(e){return false}};module.exports={isArray:ArrayIsArray,keys:ObjectKeys,names:ObjectKeys,defineProperty:ObjectDefineProperty,getDescriptor:ObjectGetDescriptor,freeze:ObjectFreeze,getPrototypeOf:ObjectGetPrototypeOf,isES5:isES5,propertyIsWritable:function(){return true}}}},{}],14:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var PromiseMap=Promise.map;Promise.prototype.filter=function(fn,options){return PromiseMap(this,fn,options,INTERNAL)};Promise.filter=function(promises,fn,options){return PromiseMap(promises,fn,options,INTERNAL)}}},{}],15:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,tryConvertToPromise){var util=_dereq_("./util");var CancellationError=Promise.CancellationError;var errorObj=util.errorObj;function PassThroughHandlerContext(promise,type,handler){this.promise=promise;this.type=type;this.handler=handler;this.called=false;this.cancelPromise=null}PassThroughHandlerContext.prototype.isFinallyHandler=function(){return this.type===0};function FinallyHandlerCancelReaction(finallyHandler){this.finallyHandler=finallyHandler}FinallyHandlerCancelReaction.prototype._resultCancelled=function(){checkCancel(this.finallyHandler)};function checkCancel(ctx,reason){if(ctx.cancelPromise!=null){if(arguments.length>1){ctx.cancelPromise._reject(reason)}else{ctx.cancelPromise._cancel()}ctx.cancelPromise=null;return true}return false}function succeed(){return finallyHandler.call(this,this.promise._target()._settledValue())}function fail(reason){if(checkCancel(this,reason))return;errorObj.e=reason;return errorObj}function finallyHandler(reasonOrValue){var promise=this.promise;var handler=this.handler;if(!this.called){this.called=true;var ret=this.isFinallyHandler()?handler.call(promise._boundValue()):handler.call(promise._boundValue(),reasonOrValue);if(ret!==undefined){promise._setReturnedNonUndefined();var maybePromise=tryConvertToPromise(ret,promise);if(maybePromise instanceof Promise){if(this.cancelPromise!=null){if(maybePromise._isCancelled()){var reason=new CancellationError("late cancellation observer");promise._attachExtraTrace(reason);errorObj.e=reason;return errorObj}else if(maybePromise.isPending()){maybePromise._attachCancellationCallback(new FinallyHandlerCancelReaction(this))}}return maybePromise._then(succeed,fail,undefined,this,undefined)}}}if(promise.isRejected()){checkCancel(this);errorObj.e=reasonOrValue;return errorObj}else{checkCancel(this);return reasonOrValue}}Promise.prototype._passThrough=function(handler,type,success,fail){if(typeof handler!=="function")return this.then();return this._then(success,fail,undefined,new PassThroughHandlerContext(this,type,handler),undefined)};Promise.prototype.lastly=Promise.prototype["finally"]=function(handler){return this._passThrough(handler,0,finallyHandler,finallyHandler)};Promise.prototype.tap=function(handler){return this._passThrough(handler,1,finallyHandler)};return PassThroughHandlerContext}},{"./util":36}],16:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,apiRejection,INTERNAL,tryConvertToPromise,Proxyable,debug){var errors=_dereq_("./errors");var TypeError=errors.TypeError;var util=_dereq_("./util");var errorObj=util.errorObj;var tryCatch=util.tryCatch;var yieldHandlers=[];function promiseFromYieldHandler(value,yieldHandlers,traceParent){for(var i=0;i<yieldHandlers.length;++i){traceParent._pushContext();var result=tryCatch(yieldHandlers[i])(value);traceParent._popContext();if(result===errorObj){traceParent._pushContext();var ret=Promise.reject(errorObj.e);traceParent._popContext();return ret}var maybePromise=tryConvertToPromise(result,traceParent);if(maybePromise instanceof Promise)return maybePromise}return null}function PromiseSpawn(generatorFunction,receiver,yieldHandler,stack){if(debug.cancellation()){var internal=new Promise(INTERNAL);var _finallyPromise=this._finallyPromise=new Promise(INTERNAL);this._promise=internal.lastly(function(){return _finallyPromise});internal._captureStackTrace();internal._setOnCancel(this)}else{var promise=this._promise=new Promise(INTERNAL);promise._captureStackTrace()}this._stack=stack;this._generatorFunction=generatorFunction;this._receiver=receiver;this._generator=undefined;this._yieldHandlers=typeof yieldHandler==="function"?[yieldHandler].concat(yieldHandlers):yieldHandlers;this._yieldedPromise=null;this._cancellationPhase=false}util.inherits(PromiseSpawn,Proxyable);PromiseSpawn.prototype._isResolved=function(){return this._promise===null};PromiseSpawn.prototype._cleanup=function(){this._promise=this._generator=null;if(debug.cancellation()&&this._finallyPromise!==null){this._finallyPromise._fulfill();this._finallyPromise=null}};PromiseSpawn.prototype._promiseCancelled=function(){if(this._isResolved())return;var implementsReturn=typeof this._generator["return"]!=="undefined";var result;if(!implementsReturn){var reason=new Promise.CancellationError("generator .return() sentinel");Promise.coroutine.returnSentinel=reason;this._promise._attachExtraTrace(reason);this._promise._pushContext();result=tryCatch(this._generator["throw"]).call(this._generator,reason);this._promise._popContext()}else{this._promise._pushContext();result=tryCatch(this._generator["return"]).call(this._generator,undefined);this._promise._popContext()}this._cancellationPhase=true;this._yieldedPromise=null;this._continue(result)};PromiseSpawn.prototype._promiseFulfilled=function(value){this._yieldedPromise=null;this._promise._pushContext();var result=tryCatch(this._generator.next).call(this._generator,value);this._promise._popContext();this._continue(result)};PromiseSpawn.prototype._promiseRejected=function(reason){this._yieldedPromise=null;this._promise._attachExtraTrace(reason);this._promise._pushContext();var result=tryCatch(this._generator["throw"]).call(this._generator,reason);this._promise._popContext();this._continue(result)};PromiseSpawn.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof Promise){var promise=this._yieldedPromise;this._yieldedPromise=null;promise.cancel()}};PromiseSpawn.prototype.promise=function(){return this._promise};PromiseSpawn.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver);this._receiver=this._generatorFunction=undefined;this._promiseFulfilled(undefined)};PromiseSpawn.prototype._continue=function(result){var promise=this._promise;if(result===errorObj){this._cleanup();if(this._cancellationPhase){return promise.cancel()}else{return promise._rejectCallback(result.e,false)}}var value=result.value;if(result.done===true){this._cleanup();if(this._cancellationPhase){return promise.cancel()}else{return promise._resolveCallback(value)}}else{var maybePromise=tryConvertToPromise(value,this._promise);if(!(maybePromise instanceof Promise)){maybePromise=promiseFromYieldHandler(maybePromise,this._yieldHandlers,this._promise);if(maybePromise===null){this._promiseRejected(new TypeError("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",value)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));return}}maybePromise=maybePromise._target();var bitField=maybePromise._bitField;if((bitField&50397184)===0){this._yieldedPromise=maybePromise;maybePromise._proxy(this,null)}else if((bitField&33554432)!==0){Promise._async.invoke(this._promiseFulfilled,this,maybePromise._value())}else if((bitField&16777216)!==0){Promise._async.invoke(this._promiseRejected,this,maybePromise._reason())}else{this._promiseCancelled()}}};Promise.coroutine=function(generatorFunction,options){if(typeof generatorFunction!=="function"){throw new TypeError("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n")}var yieldHandler=Object(options).yieldHandler;var PromiseSpawn$=PromiseSpawn;var stack=(new Error).stack;return function(){var generator=generatorFunction.apply(this,arguments);var spawn=new PromiseSpawn$(undefined,undefined,yieldHandler,stack);var ret=spawn.promise();spawn._generator=generator;spawn._promiseFulfilled(undefined);return ret}};Promise.coroutine.addYieldHandler=function(fn){if(typeof fn!=="function"){throw new TypeError("expecting a function but got "+util.classString(fn))}yieldHandlers.push(fn)};Promise.spawn=function(generatorFunction){debug.deprecated("Promise.spawn()","Promise.coroutine()");if(typeof generatorFunction!=="function"){return apiRejection("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n")}var spawn=new PromiseSpawn(generatorFunction,this);var ret=spawn.promise();spawn._run(Promise.spawn);return ret}}},{"./errors":12,"./util":36}],17:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise,INTERNAL,async,getDomain){var util=_dereq_("./util");var canEvaluate=util.canEvaluate;var tryCatch=util.tryCatch;var errorObj=util.errorObj;var reject;if(!true){if(canEvaluate){var thenCallback=function(i){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,i))};var promiseSetter=function(i){return new Function("promise","holder","                           \n            'use strict';                                                    \n            holder.pIndex = promise;                                         \n            ".replace(/Index/g,i))};var generateHolderClass=function(total){var props=new Array(total);for(var i=0;i<props.length;++i){props[i]="this.p"+(i+1)}var assignment=props.join(" = ")+" = null;";var cancellationCode="var promise;\n"+props.map(function(prop){return"                                                         \n                promise = "+prop+";                                      \n                if (promise instanceof Promise) {                            \n                    promise.cancel();                                        \n                }                                                            \n            "}).join("\n");var passedArguments=props.join(", ");var name="Holder$"+total;var code="return function(tryCatch, errorObj, Promise, async) {    \n            'use strict';                                                    \n            function [TheName](fn) {                                         \n                [TheProperties]                                              \n                this.fn = fn;                                                \n                this.asyncNeeded = true;                                     \n                this.now = 0;                                                \n            }                                                                \n                                                                             \n            [TheName].prototype._callFunction = function(promise) {          \n                promise._pushContext();                                      \n                var ret = tryCatch(this.fn)([ThePassedArguments]);           \n                promise._popContext();                                       \n                if (ret === errorObj) {                                      \n                    promise._rejectCallback(ret.e, false);                   \n                } else {                                                     \n                    promise._resolveCallback(ret);                           \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype.checkFulfillment = function(promise) {       \n                var now = ++this.now;                                        \n                if (now === [TheTotal]) {                                    \n                    if (this.asyncNeeded) {                                  \n                        async.invoke(this._callFunction, this, promise);     \n                    } else {                                                 \n                        this._callFunction(promise);                         \n                    }                                                        \n                                                                             \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype._resultCancelled = function() {              \n                [CancellationCode]                                           \n            };                                                               \n                                                                             \n            return [TheName];                                                \n        }(tryCatch, errorObj, Promise, async);                               \n        ";code=code.replace(/\[TheName\]/g,name).replace(/\[TheTotal\]/g,total).replace(/\[ThePassedArguments\]/g,passedArguments).replace(/\[TheProperties\]/g,assignment).replace(/\[CancellationCode\]/g,cancellationCode);return new Function("tryCatch","errorObj","Promise","async",code)(tryCatch,errorObj,Promise,async)};var holderClasses=[];var thenCallbacks=[];var promiseSetters=[];for(var i=0;i<8;++i){holderClasses.push(generateHolderClass(i+1));thenCallbacks.push(thenCallback(i+1));promiseSetters.push(promiseSetter(i+1))}reject=function(reason){this._reject(reason)}}}Promise.join=function(){var last=arguments.length-1;var fn;if(last>0&&typeof arguments[last]==="function"){fn=arguments[last];if(!true){if(last<=8&&canEvaluate){var ret=new Promise(INTERNAL);ret._captureStackTrace();var HolderClass=holderClasses[last-1];var holder=new HolderClass(fn);var callbacks=thenCallbacks;for(var i=0;i<last;++i){var maybePromise=tryConvertToPromise(arguments[i],ret);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();var bitField=maybePromise._bitField;if((bitField&50397184)===0){maybePromise._then(callbacks[i],reject,undefined,ret,holder);promiseSetters[i](maybePromise,holder);holder.asyncNeeded=false}else if((bitField&33554432)!==0){callbacks[i].call(ret,maybePromise._value(),holder)}else if((bitField&16777216)!==0){ret._reject(maybePromise._reason())}else{ret._cancel()}}else{callbacks[i].call(ret,maybePromise,holder)}}if(!ret._isFateSealed()){if(holder.asyncNeeded){var domain=getDomain();if(domain!==null){holder.fn=util.domainBind(domain,holder.fn)}}ret._setAsyncGuaranteed();ret._setOnCancel(holder)}return ret}}}var args=[].slice.call(arguments);if(fn)args.pop();var ret=new PromiseArray(args).promise();return fn!==undefined?ret.spread(fn):ret}}},{"./util":36}],18:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL,debug){var getDomain=Promise._getDomain;var util=_dereq_("./util");var tryCatch=util.tryCatch;var errorObj=util.errorObj;var async=Promise._async;function MappingPromiseArray(promises,fn,limit,_filter){this.constructor$(promises);this._promise._captureStackTrace();var domain=getDomain();this._callback=domain===null?fn:util.domainBind(domain,fn);this._preservedValues=_filter===INTERNAL?new Array(this.length()):null;this._limit=limit;this._inFlight=0;this._queue=[];async.invoke(this._asyncInit,this,undefined)}util.inherits(MappingPromiseArray,PromiseArray);MappingPromiseArray.prototype._asyncInit=function(){this._init$(undefined,-2)};MappingPromiseArray.prototype._init=function(){};MappingPromiseArray.prototype._promiseFulfilled=function(value,index){var values=this._values;var length=this.length();var preservedValues=this._preservedValues;var limit=this._limit;if(index<0){index=index*-1-1;values[index]=value;if(limit>=1){this._inFlight--;this._drainQueue();if(this._isResolved())return true}}else{if(limit>=1&&this._inFlight>=limit){values[index]=value;this._queue.push(index);return false}if(preservedValues!==null)preservedValues[index]=value;var promise=this._promise;var callback=this._callback;var receiver=promise._boundValue();promise._pushContext();var ret=tryCatch(callback).call(receiver,value,index,length);var promiseCreated=promise._popContext();debug.checkForgottenReturns(ret,promiseCreated,preservedValues!==null?"Promise.filter":"Promise.map",promise);if(ret===errorObj){this._reject(ret.e);return true}var maybePromise=tryConvertToPromise(ret,this._promise);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();var bitField=maybePromise._bitField;if((bitField&50397184)===0){if(limit>=1)this._inFlight++;values[index]=maybePromise;maybePromise._proxy(this,(index+1)*-1);return false}else if((bitField&33554432)!==0){ret=maybePromise._value()}else if((bitField&16777216)!==0){this._reject(maybePromise._reason());return true}else{this._cancel();return true}}values[index]=ret}var totalResolved=++this._totalResolved;if(totalResolved>=length){if(preservedValues!==null){this._filter(values,preservedValues)}else{this._resolve(values)}return true}return false};MappingPromiseArray.prototype._drainQueue=function(){var queue=this._queue;var limit=this._limit;var values=this._values;while(queue.length>0&&this._inFlight<limit){if(this._isResolved())return;var index=queue.pop();this._promiseFulfilled(values[index],index)}};MappingPromiseArray.prototype._filter=function(booleans,values){var len=values.length;var ret=new Array(len);var j=0;for(var i=0;i<len;++i){if(booleans[i])ret[j++]=values[i]}ret.length=j;this._resolve(ret)};MappingPromiseArray.prototype.preservedValues=function(){return this._preservedValues};function map(promises,fn,options,_filter){if(typeof fn!=="function"){return apiRejection("expecting a function but got "+util.classString(fn))}var limit=0;if(options!==undefined){if(typeof options==="object"&&options!==null){if(typeof options.concurrency!=="number"){return Promise.reject(new TypeError("'concurrency' must be a number but it is "+util.classString(options.concurrency)))}limit=options.concurrency}else{return Promise.reject(new TypeError("options argument must be an object but it is "+util.classString(options)))}}limit=typeof limit==="number"&&isFinite(limit)&&limit>=1?limit:0;return new MappingPromiseArray(promises,fn,limit,_filter).promise()}Promise.prototype.map=function(fn,options){return map(this,fn,options,null)};Promise.map=function(promises,fn,options,_filter){return map(promises,fn,options,_filter)}}},{"./util":36}],19:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection,debug){var util=_dereq_("./util");var tryCatch=util.tryCatch;Promise.method=function(fn){if(typeof fn!=="function"){throw new Promise.TypeError("expecting a function but got "+util.classString(fn))}return function(){var ret=new Promise(INTERNAL);ret._captureStackTrace();ret._pushContext();var value=tryCatch(fn).apply(this,arguments);var promiseCreated=ret._popContext();debug.checkForgottenReturns(value,promiseCreated,"Promise.method",ret);ret._resolveFromSyncValue(value);return ret}};Promise.attempt=Promise["try"]=function(fn){if(typeof fn!=="function"){return apiRejection("expecting a function but got "+util.classString(fn))}var ret=new Promise(INTERNAL);ret._captureStackTrace();ret._pushContext();var value;if(arguments.length>1){debug.deprecated("calling Promise.try with more than 1 argument");var arg=arguments[1];var ctx=arguments[2];value=util.isArray(arg)?tryCatch(fn).apply(ctx,arg):tryCatch(fn).call(ctx,arg)}else{value=tryCatch(fn)()}var promiseCreated=ret._popContext();debug.checkForgottenReturns(value,promiseCreated,"Promise.try",ret);ret._resolveFromSyncValue(value);return ret};Promise.prototype._resolveFromSyncValue=function(value){if(value===util.errorObj){this._rejectCallback(value.e,false)}else{this._resolveCallback(value,true)}}}},{"./util":36}],20:[function(_dereq_,module,exports){"use strict";var util=_dereq_("./util");var maybeWrapAsError=util.maybeWrapAsError;var errors=_dereq_("./errors");var OperationalError=errors.OperationalError;var es5=_dereq_("./es5");function isUntypedError(obj){return obj instanceof Error&&es5.getPrototypeOf(obj)===Error.prototype}var rErrorKey=/^(?:name|message|stack|cause)$/;function wrapAsOperationalError(obj){var ret;if(isUntypedError(obj)){ret=new OperationalError(obj);ret.name=obj.name;ret.message=obj.message;ret.stack=obj.stack;var keys=es5.keys(obj);for(var i=0;i<keys.length;++i){var key=keys[i];if(!rErrorKey.test(key)){ret[key]=obj[key]}}return ret}util.markAsOriginatingFromRejection(obj);return obj}function nodebackForPromise(promise,multiArgs){return function(err,value){if(promise===null)return;if(err){var wrapped=wrapAsOperationalError(maybeWrapAsError(err));promise._attachExtraTrace(wrapped);promise._reject(wrapped)}else if(!multiArgs){promise._fulfill(value)}else{var args=[].slice.call(arguments,1);promise._fulfill(args)}promise=null}}module.exports=nodebackForPromise},{"./errors":12,"./es5":13,"./util":36}],21:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){var util=_dereq_("./util");var async=Promise._async;var tryCatch=util.tryCatch;var errorObj=util.errorObj;function spreadAdapter(val,nodeback){var promise=this;if(!util.isArray(val))return successAdapter.call(promise,val,nodeback);var ret=tryCatch(nodeback).apply(promise._boundValue(),[null].concat(val));if(ret===errorObj){async.throwLater(ret.e)}}function successAdapter(val,nodeback){var promise=this;var receiver=promise._boundValue();var ret=val===undefined?tryCatch(nodeback).call(receiver,null):tryCatch(nodeback).call(receiver,null,val);if(ret===errorObj){async.throwLater(ret.e)}}function errorAdapter(reason,nodeback){var promise=this;if(!reason){var newReason=new Error(reason+"");newReason.cause=reason;reason=newReason}var ret=tryCatch(nodeback).call(promise._boundValue(),reason);if(ret===errorObj){async.throwLater(ret.e)}}Promise.prototype.asCallback=Promise.prototype.nodeify=function(nodeback,options){if(typeof nodeback=="function"){var adapter=successAdapter;if(options!==undefined&&Object(options).spread){adapter=spreadAdapter}this._then(adapter,errorAdapter,undefined,this,nodeback)}return this}}},{"./util":36}],22:[function(_dereq_,module,exports){"use strict";module.exports=function(){var makeSelfResolutionError=function(){return new TypeError("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")};var reflectHandler=function(){return new Promise.PromiseInspection(this._target())};var apiRejection=function(msg){return Promise.reject(new TypeError(msg))};function Proxyable(){}var UNDEFINED_BINDING={};
var util=_dereq_("./util");var getDomain;if(util.isNode){getDomain=function(){var ret=process.domain;if(ret===undefined)ret=null;return ret}}else{getDomain=function(){return null}}util.notEnumerableProp(Promise,"_getDomain",getDomain);var es5=_dereq_("./es5");var Async=_dereq_("./async");var async=new Async;es5.defineProperty(Promise,"_async",{value:async});var errors=_dereq_("./errors");var TypeError=Promise.TypeError=errors.TypeError;Promise.RangeError=errors.RangeError;var CancellationError=Promise.CancellationError=errors.CancellationError;Promise.TimeoutError=errors.TimeoutError;Promise.OperationalError=errors.OperationalError;Promise.RejectionError=errors.OperationalError;Promise.AggregateError=errors.AggregateError;var INTERNAL=function(){};var APPLY={};var NEXT_FILTER={};var tryConvertToPromise=_dereq_("./thenables")(Promise,INTERNAL);var PromiseArray=_dereq_("./promise_array")(Promise,INTERNAL,tryConvertToPromise,apiRejection,Proxyable);var Context=_dereq_("./context")(Promise);var createContext=Context.create;var debug=_dereq_("./debuggability")(Promise,Context);var CapturedTrace=debug.CapturedTrace;var PassThroughHandlerContext=_dereq_("./finally")(Promise,tryConvertToPromise);var catchFilter=_dereq_("./catch_filter")(NEXT_FILTER);var nodebackForPromise=_dereq_("./nodeback");var errorObj=util.errorObj;var tryCatch=util.tryCatch;function check(self,executor){if(typeof executor!=="function"){throw new TypeError("expecting a function but got "+util.classString(executor))}if(self.constructor!==Promise){throw new TypeError("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n")}}function Promise(executor){this._bitField=0;this._fulfillmentHandler0=undefined;this._rejectionHandler0=undefined;this._promise0=undefined;this._receiver0=undefined;if(executor!==INTERNAL){check(this,executor);this._resolveFromExecutor(executor)}this._promiseCreated();this._fireEvent("promiseCreated",this)}Promise.prototype.toString=function(){return"[object Promise]"};Promise.prototype.caught=Promise.prototype["catch"]=function(fn){var len=arguments.length;if(len>1){var catchInstances=new Array(len-1),j=0,i;for(i=0;i<len-1;++i){var item=arguments[i];if(util.isObject(item)){catchInstances[j++]=item}else{return apiRejection("expecting an object but got "+"A catch statement predicate "+util.classString(item))}}catchInstances.length=j;fn=arguments[i];return this.then(undefined,catchFilter(catchInstances,fn,this))}return this.then(undefined,fn)};Promise.prototype.reflect=function(){return this._then(reflectHandler,reflectHandler,undefined,this,undefined)};Promise.prototype.then=function(didFulfill,didReject){if(debug.warnings()&&arguments.length>0&&typeof didFulfill!=="function"&&typeof didReject!=="function"){var msg=".then() only accepts functions but was passed: "+util.classString(didFulfill);if(arguments.length>1){msg+=", "+util.classString(didReject)}this._warn(msg)}return this._then(didFulfill,didReject,undefined,undefined,undefined)};Promise.prototype.done=function(didFulfill,didReject){var promise=this._then(didFulfill,didReject,undefined,undefined,undefined);promise._setIsFinal()};Promise.prototype.spread=function(fn){if(typeof fn!=="function"){return apiRejection("expecting a function but got "+util.classString(fn))}return this.all()._then(fn,undefined,undefined,APPLY,undefined)};Promise.prototype.toJSON=function(){var ret={isFulfilled:false,isRejected:false,fulfillmentValue:undefined,rejectionReason:undefined};if(this.isFulfilled()){ret.fulfillmentValue=this.value();ret.isFulfilled=true}else if(this.isRejected()){ret.rejectionReason=this.reason();ret.isRejected=true}return ret};Promise.prototype.all=function(){if(arguments.length>0){this._warn(".all() was passed arguments but it does not take any")}return new PromiseArray(this).promise()};Promise.prototype.error=function(fn){return this.caught(util.originatesFromRejection,fn)};Promise.getNewLibraryCopy=module.exports;Promise.is=function(val){return val instanceof Promise};Promise.fromNode=Promise.fromCallback=function(fn){var ret=new Promise(INTERNAL);ret._captureStackTrace();var multiArgs=arguments.length>1?!!Object(arguments[1]).multiArgs:false;var result=tryCatch(fn)(nodebackForPromise(ret,multiArgs));if(result===errorObj){ret._rejectCallback(result.e,true)}if(!ret._isFateSealed())ret._setAsyncGuaranteed();return ret};Promise.all=function(promises){return new PromiseArray(promises).promise()};Promise.cast=function(obj){var ret=tryConvertToPromise(obj);if(!(ret instanceof Promise)){ret=new Promise(INTERNAL);ret._captureStackTrace();ret._setFulfilled();ret._rejectionHandler0=obj}return ret};Promise.resolve=Promise.fulfilled=Promise.cast;Promise.reject=Promise.rejected=function(reason){var ret=new Promise(INTERNAL);ret._captureStackTrace();ret._rejectCallback(reason,true);return ret};Promise.setScheduler=function(fn){if(typeof fn!=="function"){throw new TypeError("expecting a function but got "+util.classString(fn))}return async.setScheduler(fn)};Promise.prototype._then=function(didFulfill,didReject,_,receiver,internalData){var haveInternalData=internalData!==undefined;var promise=haveInternalData?internalData:new Promise(INTERNAL);var target=this._target();var bitField=target._bitField;if(!haveInternalData){promise._propagateFrom(this,3);promise._captureStackTrace();if(receiver===undefined&&(this._bitField&2097152)!==0){if(!((bitField&50397184)===0)){receiver=this._boundValue()}else{receiver=target===this?undefined:this._boundTo}}this._fireEvent("promiseChained",this,promise)}var domain=getDomain();if(!((bitField&50397184)===0)){var handler,value,settler=target._settlePromiseCtx;if((bitField&33554432)!==0){value=target._rejectionHandler0;handler=didFulfill}else if((bitField&16777216)!==0){value=target._fulfillmentHandler0;handler=didReject;target._unsetRejectionIsUnhandled()}else{settler=target._settlePromiseLateCancellationObserver;value=new CancellationError("late cancellation observer");target._attachExtraTrace(value);handler=didReject}async.invoke(settler,target,{handler:domain===null?handler:typeof handler==="function"&&util.domainBind(domain,handler),promise:promise,receiver:receiver,value:value})}else{target._addCallbacks(didFulfill,didReject,promise,receiver,domain)}return promise};Promise.prototype._length=function(){return this._bitField&65535};Promise.prototype._isFateSealed=function(){return(this._bitField&117506048)!==0};Promise.prototype._isFollowing=function(){return(this._bitField&67108864)===67108864};Promise.prototype._setLength=function(len){this._bitField=this._bitField&-65536|len&65535};Promise.prototype._setFulfilled=function(){this._bitField=this._bitField|33554432;this._fireEvent("promiseFulfilled",this)};Promise.prototype._setRejected=function(){this._bitField=this._bitField|16777216;this._fireEvent("promiseRejected",this)};Promise.prototype._setFollowing=function(){this._bitField=this._bitField|67108864;this._fireEvent("promiseResolved",this)};Promise.prototype._setIsFinal=function(){this._bitField=this._bitField|4194304};Promise.prototype._isFinal=function(){return(this._bitField&4194304)>0};Promise.prototype._unsetCancelled=function(){this._bitField=this._bitField&~65536};Promise.prototype._setCancelled=function(){this._bitField=this._bitField|65536;this._fireEvent("promiseCancelled",this)};Promise.prototype._setWillBeCancelled=function(){this._bitField=this._bitField|8388608};Promise.prototype._setAsyncGuaranteed=function(){if(async.hasCustomScheduler())return;this._bitField=this._bitField|134217728};Promise.prototype._receiverAt=function(index){var ret=index===0?this._receiver0:this[index*4-4+3];if(ret===UNDEFINED_BINDING){return undefined}else if(ret===undefined&&this._isBound()){return this._boundValue()}return ret};Promise.prototype._promiseAt=function(index){return this[index*4-4+2]};Promise.prototype._fulfillmentHandlerAt=function(index){return this[index*4-4+0]};Promise.prototype._rejectionHandlerAt=function(index){return this[index*4-4+1]};Promise.prototype._boundValue=function(){};Promise.prototype._migrateCallback0=function(follower){var bitField=follower._bitField;var fulfill=follower._fulfillmentHandler0;var reject=follower._rejectionHandler0;var promise=follower._promise0;var receiver=follower._receiverAt(0);if(receiver===undefined)receiver=UNDEFINED_BINDING;this._addCallbacks(fulfill,reject,promise,receiver,null)};Promise.prototype._migrateCallbackAt=function(follower,index){var fulfill=follower._fulfillmentHandlerAt(index);var reject=follower._rejectionHandlerAt(index);var promise=follower._promiseAt(index);var receiver=follower._receiverAt(index);if(receiver===undefined)receiver=UNDEFINED_BINDING;this._addCallbacks(fulfill,reject,promise,receiver,null)};Promise.prototype._addCallbacks=function(fulfill,reject,promise,receiver,domain){var index=this._length();if(index>=65535-4){index=0;this._setLength(0)}if(index===0){this._promise0=promise;this._receiver0=receiver;if(typeof fulfill==="function"){this._fulfillmentHandler0=domain===null?fulfill:util.domainBind(domain,fulfill)}if(typeof reject==="function"){this._rejectionHandler0=domain===null?reject:util.domainBind(domain,reject)}}else{var base=index*4-4;this[base+2]=promise;this[base+3]=receiver;if(typeof fulfill==="function"){this[base+0]=domain===null?fulfill:util.domainBind(domain,fulfill)}if(typeof reject==="function"){this[base+1]=domain===null?reject:util.domainBind(domain,reject)}}this._setLength(index+1);return index};Promise.prototype._proxy=function(proxyable,arg){this._addCallbacks(undefined,undefined,arg,proxyable,null)};Promise.prototype._resolveCallback=function(value,shouldBind){if((this._bitField&117506048)!==0)return;if(value===this)return this._rejectCallback(makeSelfResolutionError(),false);var maybePromise=tryConvertToPromise(value,this);if(!(maybePromise instanceof Promise))return this._fulfill(value);if(shouldBind)this._propagateFrom(maybePromise,2);var promise=maybePromise._target();if(promise===this){this._reject(makeSelfResolutionError());return}var bitField=promise._bitField;if((bitField&50397184)===0){var len=this._length();if(len>0)promise._migrateCallback0(this);for(var i=1;i<len;++i){promise._migrateCallbackAt(this,i)}this._setFollowing();this._setLength(0);this._setFollowee(promise)}else if((bitField&33554432)!==0){this._fulfill(promise._value())}else if((bitField&16777216)!==0){this._reject(promise._reason())}else{var reason=new CancellationError("late cancellation observer");promise._attachExtraTrace(reason);this._reject(reason)}};Promise.prototype._rejectCallback=function(reason,synchronous,ignoreNonErrorWarnings){var trace=util.ensureErrorObject(reason);var hasStack=trace===reason;if(!hasStack&&!ignoreNonErrorWarnings&&debug.warnings()){var message="a promise was rejected with a non-error: "+util.classString(reason);this._warn(message,true)}this._attachExtraTrace(trace,synchronous?hasStack:false);this._reject(reason)};Promise.prototype._resolveFromExecutor=function(executor){var promise=this;this._captureStackTrace();this._pushContext();var synchronous=true;var r=this._execute(executor,function(value){promise._resolveCallback(value)},function(reason){promise._rejectCallback(reason,synchronous)});synchronous=false;this._popContext();if(r!==undefined){promise._rejectCallback(r,true)}};Promise.prototype._settlePromiseFromHandler=function(handler,receiver,value,promise){var bitField=promise._bitField;if((bitField&65536)!==0)return;promise._pushContext();var x;if(receiver===APPLY){if(!value||typeof value.length!=="number"){x=errorObj;x.e=new TypeError("cannot .spread() a non-array: "+util.classString(value))}else{x=tryCatch(handler).apply(this._boundValue(),value)}}else{x=tryCatch(handler).call(receiver,value)}var promiseCreated=promise._popContext();bitField=promise._bitField;if((bitField&65536)!==0)return;if(x===NEXT_FILTER){promise._reject(value)}else if(x===errorObj){promise._rejectCallback(x.e,false)}else{debug.checkForgottenReturns(x,promiseCreated,"",promise,this);promise._resolveCallback(x)}};Promise.prototype._target=function(){var ret=this;while(ret._isFollowing())ret=ret._followee();return ret};Promise.prototype._followee=function(){return this._rejectionHandler0};Promise.prototype._setFollowee=function(promise){this._rejectionHandler0=promise};Promise.prototype._settlePromise=function(promise,handler,receiver,value){var isPromise=promise instanceof Promise;var bitField=this._bitField;var asyncGuaranteed=(bitField&134217728)!==0;if((bitField&65536)!==0){if(isPromise)promise._invokeInternalOnCancel();if(receiver instanceof PassThroughHandlerContext&&receiver.isFinallyHandler()){receiver.cancelPromise=promise;if(tryCatch(handler).call(receiver,value)===errorObj){promise._reject(errorObj.e)}}else if(handler===reflectHandler){promise._fulfill(reflectHandler.call(receiver))}else if(receiver instanceof Proxyable){receiver._promiseCancelled(promise)}else if(isPromise||promise instanceof PromiseArray){promise._cancel()}else{receiver.cancel()}}else if(typeof handler==="function"){if(!isPromise){handler.call(receiver,value,promise)}else{if(asyncGuaranteed)promise._setAsyncGuaranteed();this._settlePromiseFromHandler(handler,receiver,value,promise)}}else if(receiver instanceof Proxyable){if(!receiver._isResolved()){if((bitField&33554432)!==0){receiver._promiseFulfilled(value,promise)}else{receiver._promiseRejected(value,promise)}}}else if(isPromise){if(asyncGuaranteed)promise._setAsyncGuaranteed();if((bitField&33554432)!==0){promise._fulfill(value)}else{promise._reject(value)}}};Promise.prototype._settlePromiseLateCancellationObserver=function(ctx){var handler=ctx.handler;var promise=ctx.promise;var receiver=ctx.receiver;var value=ctx.value;if(typeof handler==="function"){if(!(promise instanceof Promise)){handler.call(receiver,value,promise)}else{this._settlePromiseFromHandler(handler,receiver,value,promise)}}else if(promise instanceof Promise){promise._reject(value)}};Promise.prototype._settlePromiseCtx=function(ctx){this._settlePromise(ctx.promise,ctx.handler,ctx.receiver,ctx.value)};Promise.prototype._settlePromise0=function(handler,value,bitField){var promise=this._promise0;var receiver=this._receiverAt(0);this._promise0=undefined;this._receiver0=undefined;this._settlePromise(promise,handler,receiver,value)};Promise.prototype._clearCallbackDataAtIndex=function(index){var base=index*4-4;this[base+2]=this[base+3]=this[base+0]=this[base+1]=undefined};Promise.prototype._fulfill=function(value){var bitField=this._bitField;if((bitField&117506048)>>>16)return;if(value===this){var err=makeSelfResolutionError();this._attachExtraTrace(err);return this._reject(err)}this._setFulfilled();this._rejectionHandler0=value;if((bitField&65535)>0){if((bitField&134217728)!==0){this._settlePromises()}else{async.settlePromises(this)}}};Promise.prototype._reject=function(reason){var bitField=this._bitField;if((bitField&117506048)>>>16)return;this._setRejected();this._fulfillmentHandler0=reason;if(this._isFinal()){return async.fatalError(reason,util.isNode)}if((bitField&65535)>0){async.settlePromises(this)}else{this._ensurePossibleRejectionHandled()}};Promise.prototype._fulfillPromises=function(len,value){for(var i=1;i<len;i++){var handler=this._fulfillmentHandlerAt(i);var promise=this._promiseAt(i);var receiver=this._receiverAt(i);this._clearCallbackDataAtIndex(i);this._settlePromise(promise,handler,receiver,value)}};Promise.prototype._rejectPromises=function(len,reason){for(var i=1;i<len;i++){var handler=this._rejectionHandlerAt(i);var promise=this._promiseAt(i);var receiver=this._receiverAt(i);this._clearCallbackDataAtIndex(i);this._settlePromise(promise,handler,receiver,reason)}};Promise.prototype._settlePromises=function(){var bitField=this._bitField;var len=bitField&65535;if(len>0){if((bitField&16842752)!==0){var reason=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,reason,bitField);this._rejectPromises(len,reason)}else{var value=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,value,bitField);this._fulfillPromises(len,value)}this._setLength(0)}this._clearCancellationData()};Promise.prototype._settledValue=function(){var bitField=this._bitField;if((bitField&33554432)!==0){return this._rejectionHandler0}else if((bitField&16777216)!==0){return this._fulfillmentHandler0}};function deferResolve(v){this.promise._resolveCallback(v)}function deferReject(v){this.promise._rejectCallback(v,false)}Promise.defer=Promise.pending=function(){debug.deprecated("Promise.defer","new Promise");var promise=new Promise(INTERNAL);return{promise:promise,resolve:deferResolve,reject:deferReject}};util.notEnumerableProp(Promise,"_makeSelfResolutionError",makeSelfResolutionError);_dereq_("./method")(Promise,INTERNAL,tryConvertToPromise,apiRejection,debug);_dereq_("./bind")(Promise,INTERNAL,tryConvertToPromise,debug);_dereq_("./cancel")(Promise,PromiseArray,apiRejection,debug);_dereq_("./direct_resolve")(Promise);_dereq_("./synchronous_inspection")(Promise);_dereq_("./join")(Promise,PromiseArray,tryConvertToPromise,INTERNAL,async,getDomain);Promise.Promise=Promise;Promise.version="3.4.6";_dereq_("./map.js")(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL,debug);_dereq_("./call_get.js")(Promise);_dereq_("./using.js")(Promise,apiRejection,tryConvertToPromise,createContext,INTERNAL,debug);_dereq_("./timers.js")(Promise,INTERNAL,debug);_dereq_("./generators.js")(Promise,apiRejection,INTERNAL,tryConvertToPromise,Proxyable,debug);_dereq_("./nodeify.js")(Promise);_dereq_("./promisify.js")(Promise,INTERNAL);_dereq_("./props.js")(Promise,PromiseArray,tryConvertToPromise,apiRejection);_dereq_("./race.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection);_dereq_("./reduce.js")(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL,debug);_dereq_("./settle.js")(Promise,PromiseArray,debug);_dereq_("./some.js")(Promise,PromiseArray,apiRejection);_dereq_("./filter.js")(Promise,INTERNAL);_dereq_("./each.js")(Promise,INTERNAL);_dereq_("./any.js")(Promise);util.toFastProperties(Promise);util.toFastProperties(Promise.prototype);function fillTypes(value){var p=new Promise(INTERNAL);p._fulfillmentHandler0=value;p._rejectionHandler0=value;p._promise0=value;p._receiver0=value}fillTypes({a:1});fillTypes({b:2});fillTypes({c:3});fillTypes(1);fillTypes(function(){});fillTypes(undefined);fillTypes(false);fillTypes(new Promise(INTERNAL));debug.setBounds(Async.firstLineError,util.lastLineError);return Promise}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection,Proxyable){var util=_dereq_("./util");var isArray=util.isArray;function toResolutionValue(val){switch(val){case-2:return[];case-3:return{}}}function PromiseArray(values){var promise=this._promise=new Promise(INTERNAL);if(values instanceof Promise){promise._propagateFrom(values,3)}promise._setOnCancel(this);this._values=values;this._length=0;this._totalResolved=0;this._init(undefined,-2)}util.inherits(PromiseArray,Proxyable);PromiseArray.prototype.length=function(){return this._length};PromiseArray.prototype.promise=function(){return this._promise};PromiseArray.prototype._init=function init(_,resolveValueIfEmpty){var values=tryConvertToPromise(this._values,this._promise);if(values instanceof Promise){values=values._target();var bitField=values._bitField;this._values=values;if((bitField&50397184)===0){this._promise._setAsyncGuaranteed();return values._then(init,this._reject,undefined,this,resolveValueIfEmpty)}else if((bitField&33554432)!==0){values=values._value()}else if((bitField&16777216)!==0){return this._reject(values._reason())}else{return this._cancel()}}values=util.asArray(values);if(values===null){var err=apiRejection("expecting an array or an iterable object but got "+util.classString(values)).reason();this._promise._rejectCallback(err,false);return}if(values.length===0){if(resolveValueIfEmpty===-5){this._resolveEmptyArray()}else{this._resolve(toResolutionValue(resolveValueIfEmpty))}return}this._iterate(values)};PromiseArray.prototype._iterate=function(values){var len=this.getActualLength(values.length);this._length=len;this._values=this.shouldCopyValues()?new Array(len):this._values;var result=this._promise;var isResolved=false;var bitField=null;for(var i=0;i<len;++i){var maybePromise=tryConvertToPromise(values[i],result);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();bitField=maybePromise._bitField}else{bitField=null}if(isResolved){if(bitField!==null){maybePromise.suppressUnhandledRejections()}}else if(bitField!==null){if((bitField&50397184)===0){maybePromise._proxy(this,i);this._values[i]=maybePromise}else if((bitField&33554432)!==0){isResolved=this._promiseFulfilled(maybePromise._value(),i)}else if((bitField&16777216)!==0){isResolved=this._promiseRejected(maybePromise._reason(),i)}else{isResolved=this._promiseCancelled(i)}}else{isResolved=this._promiseFulfilled(maybePromise,i)}}if(!isResolved)result._setAsyncGuaranteed()};PromiseArray.prototype._isResolved=function(){return this._values===null};PromiseArray.prototype._resolve=function(value){this._values=null;this._promise._fulfill(value)};PromiseArray.prototype._cancel=function(){if(this._isResolved()||!this._promise._isCancellable())return;this._values=null;this._promise._cancel()};PromiseArray.prototype._reject=function(reason){this._values=null;this._promise._rejectCallback(reason,false)};PromiseArray.prototype._promiseFulfilled=function(value,index){this._values[index]=value;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){this._resolve(this._values);return true}return false};PromiseArray.prototype._promiseCancelled=function(){this._cancel();return true};PromiseArray.prototype._promiseRejected=function(reason){this._totalResolved++;this._reject(reason);return true};PromiseArray.prototype._resultCancelled=function(){if(this._isResolved())return;var values=this._values;this._cancel();if(values instanceof Promise){values.cancel()}else{for(var i=0;i<values.length;++i){if(values[i]instanceof Promise){values[i].cancel()}}}};PromiseArray.prototype.shouldCopyValues=function(){return true};PromiseArray.prototype.getActualLength=function(len){return len};return PromiseArray}},{"./util":36}],24:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var THIS={};var util=_dereq_("./util");var nodebackForPromise=_dereq_("./nodeback");var withAppended=util.withAppended;var maybeWrapAsError=util.maybeWrapAsError;var canEvaluate=util.canEvaluate;var TypeError=_dereq_("./errors").TypeError;var defaultSuffix="Async";var defaultPromisified={__isPromisified__:true};var noCopyProps=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"];var noCopyPropsPattern=new RegExp("^(?:"+noCopyProps.join("|")+")$");var defaultFilter=function(name){return util.isIdentifier(name)&&name.charAt(0)!=="_"&&name!=="constructor"};function propsFilter(key){return!noCopyPropsPattern.test(key)}function isPromisified(fn){try{return fn.__isPromisified__===true}catch(e){return false}}function hasPromisified(obj,key,suffix){var val=util.getDataPropertyOrDefault(obj,key+suffix,defaultPromisified);return val?isPromisified(val):false}function checkValid(ret,suffix,suffixRegexp){for(var i=0;i<ret.length;i+=2){var key=ret[i];if(suffixRegexp.test(key)){var keyWithoutAsyncSuffix=key.replace(suffixRegexp,"");for(var j=0;j<ret.length;j+=2){if(ret[j]===keyWithoutAsyncSuffix){throw new TypeError("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",suffix))}}}}}function promisifiableMethods(obj,suffix,suffixRegexp,filter){var keys=util.inheritedDataKeys(obj);var ret=[];for(var i=0;i<keys.length;++i){var key=keys[i];var value=obj[key];var passesDefaultFilter=filter===defaultFilter?true:defaultFilter(key,value,obj);if(typeof value==="function"&&!isPromisified(value)&&!hasPromisified(obj,key,suffix)&&filter(key,value,obj,passesDefaultFilter)){ret.push(key,value)}}checkValid(ret,suffix,suffixRegexp);return ret}var escapeIdentRegex=function(str){return str.replace(/([$])/,"\\$")};var makeNodePromisifiedEval;if(!true){var switchCaseArgumentOrder=function(likelyArgumentCount){var ret=[likelyArgumentCount];var min=Math.max(0,likelyArgumentCount-1-3);for(var i=likelyArgumentCount-1;i>=min;--i){ret.push(i)}for(var i=likelyArgumentCount+1;i<=3;++i){ret.push(i)}return ret};var argumentSequence=function(argumentCount){return util.filledRange(argumentCount,"_arg","")};var parameterDeclaration=function(parameterCount){return util.filledRange(Math.max(parameterCount,3),"_arg","")};var parameterCount=function(fn){if(typeof fn.length==="number"){return Math.max(Math.min(fn.length,1023+1),0)}return 0};makeNodePromisifiedEval=function(callback,receiver,originalName,fn,_,multiArgs){var newParameterCount=Math.max(0,parameterCount(fn)-1);var argumentOrder=switchCaseArgumentOrder(newParameterCount);var shouldProxyThis=typeof callback==="string"||receiver===THIS;function generateCallForArgumentCount(count){var args=argumentSequence(count).join(", ");var comma=count>0?", ":"";var ret;if(shouldProxyThis){ret="ret = callback.call(this, {{args}}, nodeback); break;\n"}else{ret=receiver===undefined?"ret = callback({{args}}, nodeback); break;\n":"ret = callback.call(receiver, {{args}}, nodeback); break;\n"}return ret.replace("{{args}}",args).replace(", ",comma)}function generateArgumentSwitchCase(){var ret="";for(var i=0;i<argumentOrder.length;++i){ret+="case "+argumentOrder[i]+":"+generateCallForArgumentCount(argumentOrder[i])}ret+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = nodeback;                                              \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",shouldProxyThis?"ret = callback.apply(this, args);\n":"ret = callback.apply(receiver, args);\n");return ret}var getFunctionCode=typeof callback==="string"?"this != null ? this['"+callback+"'] : fn":"fn";var body="'use strict';                                                \n        var ret = function (Parameters) {                                    \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._captureStackTrace();                                    \n            var nodeback = nodebackForPromise(promise, "+multiArgs+");   \n            var ret;                                                         \n            var callback = tryCatch([GetFunctionCode]);                      \n            switch(len) {                                                    \n                [CodeForSwitchCase]                                          \n            }                                                                \n            if (ret === errorObj) {                                          \n                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\n            }                                                                \n            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \n            return promise;                                                  \n        };                                                                   \n        notEnumerableProp(ret, '__isPromisified__', true);                   \n        return ret;                                                          \n    ".replace("[CodeForSwitchCase]",generateArgumentSwitchCase()).replace("[GetFunctionCode]",getFunctionCode);body=body.replace("Parameters",parameterDeclaration(newParameterCount));return new Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","notEnumerableProp","INTERNAL",body)(Promise,fn,receiver,withAppended,maybeWrapAsError,nodebackForPromise,util.tryCatch,util.errorObj,util.notEnumerableProp,INTERNAL)}}function makeNodePromisifiedClosure(callback,receiver,_,fn,__,multiArgs){var defaultThis=function(){return this}();var method=callback;if(typeof method==="string"){callback=fn}function promisified(){var _receiver=receiver;if(receiver===THIS)_receiver=this;var promise=new Promise(INTERNAL);promise._captureStackTrace();var cb=typeof method==="string"&&this!==defaultThis?this[method]:callback;var fn=nodebackForPromise(promise,multiArgs);try{cb.apply(_receiver,withAppended(arguments,fn))}catch(e){promise._rejectCallback(maybeWrapAsError(e),true,true)}if(!promise._isFateSealed())promise._setAsyncGuaranteed();return promise}util.notEnumerableProp(promisified,"__isPromisified__",true);return promisified}var makeNodePromisified=canEvaluate?makeNodePromisifiedEval:makeNodePromisifiedClosure;function promisifyAll(obj,suffix,filter,promisifier,multiArgs){var suffixRegexp=new RegExp(escapeIdentRegex(suffix)+"$");var methods=promisifiableMethods(obj,suffix,suffixRegexp,filter);for(var i=0,len=methods.length;i<len;i+=2){var key=methods[i];var fn=methods[i+1];var promisifiedKey=key+suffix;if(promisifier===makeNodePromisified){obj[promisifiedKey]=makeNodePromisified(key,THIS,key,fn,suffix,multiArgs)}else{var promisified=promisifier(fn,function(){return makeNodePromisified(key,THIS,key,fn,suffix,multiArgs)});util.notEnumerableProp(promisified,"__isPromisified__",true);obj[promisifiedKey]=promisified}}util.toFastProperties(obj);return obj}function promisify(callback,receiver,multiArgs){return makeNodePromisified(callback,receiver,undefined,callback,null,multiArgs)}Promise.promisify=function(fn,options){if(typeof fn!=="function"){throw new TypeError("expecting a function but got "+util.classString(fn))}if(isPromisified(fn)){return fn}options=Object(options);var receiver=options.context===undefined?THIS:options.context;var multiArgs=!!options.multiArgs;var ret=promisify(fn,receiver,multiArgs);util.copyDescriptors(fn,ret,propsFilter);return ret};Promise.promisifyAll=function(target,options){if(typeof target!=="function"&&typeof target!=="object"){throw new TypeError("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n")}options=Object(options);var multiArgs=!!options.multiArgs;var suffix=options.suffix;if(typeof suffix!=="string")suffix=defaultSuffix;var filter=options.filter;if(typeof filter!=="function")filter=defaultFilter;var promisifier=options.promisifier;if(typeof promisifier!=="function")promisifier=makeNodePromisified;if(!util.isIdentifier(suffix)){throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n")}var keys=util.inheritedDataKeys(target);for(var i=0;i<keys.length;++i){var value=target[keys[i]];if(keys[i]!=="constructor"&&util.isClass(value)){promisifyAll(value.prototype,suffix,filter,promisifier,multiArgs);promisifyAll(value,suffix,filter,promisifier,multiArgs);
}}return promisifyAll(target,suffix,filter,promisifier,multiArgs)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise,apiRejection){var util=_dereq_("./util");var isObject=util.isObject;var es5=_dereq_("./es5");var Es6Map;if(typeof Map==="function")Es6Map=Map;var mapToEntries=function(){var index=0;var size=0;function extractEntry(value,key){this[index]=value;this[index+size]=key;index++}return function mapToEntries(map){size=map.size;index=0;var ret=new Array(map.size*2);map.forEach(extractEntry,ret);return ret}}();var entriesToMap=function(entries){var ret=new Es6Map;var length=entries.length/2|0;for(var i=0;i<length;++i){var key=entries[length+i];var value=entries[i];ret.set(key,value)}return ret};function PropertiesPromiseArray(obj){var isMap=false;var entries;if(Es6Map!==undefined&&obj instanceof Es6Map){entries=mapToEntries(obj);isMap=true}else{var keys=es5.keys(obj);var len=keys.length;entries=new Array(len*2);for(var i=0;i<len;++i){var key=keys[i];entries[i]=obj[key];entries[i+len]=key}}this.constructor$(entries);this._isMap=isMap;this._init$(undefined,-3)}util.inherits(PropertiesPromiseArray,PromiseArray);PropertiesPromiseArray.prototype._init=function(){};PropertiesPromiseArray.prototype._promiseFulfilled=function(value,index){this._values[index]=value;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){var val;if(this._isMap){val=entriesToMap(this._values)}else{val={};var keyOffset=this.length();for(var i=0,len=this.length();i<len;++i){val[this._values[i+keyOffset]]=this._values[i]}}this._resolve(val);return true}return false};PropertiesPromiseArray.prototype.shouldCopyValues=function(){return false};PropertiesPromiseArray.prototype.getActualLength=function(len){return len>>1};function props(promises){var ret;var castValue=tryConvertToPromise(promises);if(!isObject(castValue)){return apiRejection("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}else if(castValue instanceof Promise){ret=castValue._then(Promise.props,undefined,undefined,undefined,undefined)}else{ret=new PropertiesPromiseArray(castValue).promise()}if(castValue instanceof Promise){ret._propagateFrom(castValue,2)}return ret}Promise.prototype.props=function(){return props(this)};Promise.props=function(promises){return props(promises)}}},{"./es5":13,"./util":36}],26:[function(_dereq_,module,exports){"use strict";function arrayMove(src,srcIndex,dst,dstIndex,len){for(var j=0;j<len;++j){dst[j+dstIndex]=src[j+srcIndex];src[j+srcIndex]=void 0}}function Queue(capacity){this._capacity=capacity;this._length=0;this._front=0}Queue.prototype._willBeOverCapacity=function(size){return this._capacity<size};Queue.prototype._pushOne=function(arg){var length=this.length();this._checkCapacity(length+1);var i=this._front+length&this._capacity-1;this[i]=arg;this._length=length+1};Queue.prototype._unshiftOne=function(value){var capacity=this._capacity;this._checkCapacity(this.length()+1);var front=this._front;var i=(front-1&capacity-1^capacity)-capacity;this[i]=value;this._front=i;this._length=this.length()+1};Queue.prototype.unshift=function(fn,receiver,arg){this._unshiftOne(arg);this._unshiftOne(receiver);this._unshiftOne(fn)};Queue.prototype.push=function(fn,receiver,arg){var length=this.length()+3;if(this._willBeOverCapacity(length)){this._pushOne(fn);this._pushOne(receiver);this._pushOne(arg);return}var j=this._front+length-3;this._checkCapacity(length);var wrapMask=this._capacity-1;this[j+0&wrapMask]=fn;this[j+1&wrapMask]=receiver;this[j+2&wrapMask]=arg;this._length=length};Queue.prototype.shift=function(){var front=this._front,ret=this[front];this[front]=undefined;this._front=front+1&this._capacity-1;this._length--;return ret};Queue.prototype.length=function(){return this._length};Queue.prototype._checkCapacity=function(size){if(this._capacity<size){this._resizeTo(this._capacity<<1)}};Queue.prototype._resizeTo=function(capacity){var oldCapacity=this._capacity;this._capacity=capacity;var front=this._front;var length=this._length;var moveItemsCount=front+length&oldCapacity-1;arrayMove(this,0,this,oldCapacity,moveItemsCount)};module.exports=Queue},{}],27:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){var util=_dereq_("./util");var raceLater=function(promise){return promise.then(function(array){return race(array,promise)})};function race(promises,parent){var maybePromise=tryConvertToPromise(promises);if(maybePromise instanceof Promise){return raceLater(maybePromise)}else{promises=util.asArray(promises);if(promises===null)return apiRejection("expecting an array or an iterable object but got "+util.classString(promises))}var ret=new Promise(INTERNAL);if(parent!==undefined){ret._propagateFrom(parent,3)}var fulfill=ret._fulfill;var reject=ret._reject;for(var i=0,len=promises.length;i<len;++i){var val=promises[i];if(val===undefined&&!(i in promises)){continue}Promise.cast(val)._then(fulfill,reject,undefined,ret,null)}return ret}Promise.race=function(promises){return race(promises,undefined)};Promise.prototype.race=function(){return race(this,undefined)}}},{"./util":36}],28:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL,debug){var getDomain=Promise._getDomain;var util=_dereq_("./util");var tryCatch=util.tryCatch;function ReductionPromiseArray(promises,fn,initialValue,_each){this.constructor$(promises);var domain=getDomain();this._fn=domain===null?fn:util.domainBind(domain,fn);if(initialValue!==undefined){initialValue=Promise.resolve(initialValue);initialValue._attachCancellationCallback(this)}this._initialValue=initialValue;this._currentCancellable=null;if(_each===INTERNAL){this._eachValues=Array(this._length)}else if(_each===0){this._eachValues=null}else{this._eachValues=undefined}this._promise._captureStackTrace();this._init$(undefined,-5)}util.inherits(ReductionPromiseArray,PromiseArray);ReductionPromiseArray.prototype._gotAccum=function(accum){if(this._eachValues!==undefined&&this._eachValues!==null&&accum!==INTERNAL){this._eachValues.push(accum)}};ReductionPromiseArray.prototype._eachComplete=function(value){if(this._eachValues!==null){this._eachValues.push(value)}return this._eachValues};ReductionPromiseArray.prototype._init=function(){};ReductionPromiseArray.prototype._resolveEmptyArray=function(){this._resolve(this._eachValues!==undefined?this._eachValues:this._initialValue)};ReductionPromiseArray.prototype.shouldCopyValues=function(){return false};ReductionPromiseArray.prototype._resolve=function(value){this._promise._resolveCallback(value);this._values=null};ReductionPromiseArray.prototype._resultCancelled=function(sender){if(sender===this._initialValue)return this._cancel();if(this._isResolved())return;this._resultCancelled$();if(this._currentCancellable instanceof Promise){this._currentCancellable.cancel()}if(this._initialValue instanceof Promise){this._initialValue.cancel()}};ReductionPromiseArray.prototype._iterate=function(values){this._values=values;var value;var i;var length=values.length;if(this._initialValue!==undefined){value=this._initialValue;i=0}else{value=Promise.resolve(values[0]);i=1}this._currentCancellable=value;if(!value.isRejected()){for(;i<length;++i){var ctx={accum:null,value:values[i],index:i,length:length,array:this};value=value._then(gotAccum,undefined,undefined,ctx,undefined)}}if(this._eachValues!==undefined){value=value._then(this._eachComplete,undefined,undefined,this,undefined)}value._then(completed,completed,undefined,value,this)};Promise.prototype.reduce=function(fn,initialValue){return reduce(this,fn,initialValue,null)};Promise.reduce=function(promises,fn,initialValue,_each){return reduce(promises,fn,initialValue,_each)};function completed(valueOrReason,array){if(this.isFulfilled()){array._resolve(valueOrReason)}else{array._reject(valueOrReason)}}function reduce(promises,fn,initialValue,_each){if(typeof fn!=="function"){return apiRejection("expecting a function but got "+util.classString(fn))}var array=new ReductionPromiseArray(promises,fn,initialValue,_each);return array.promise()}function gotAccum(accum){this.accum=accum;this.array._gotAccum(accum);var value=tryConvertToPromise(this.value,this.array._promise);if(value instanceof Promise){this.array._currentCancellable=value;return value._then(gotValue,undefined,undefined,this,undefined)}else{return gotValue.call(this,value)}}function gotValue(value){var array=this.array;var promise=array._promise;var fn=tryCatch(array._fn);promise._pushContext();var ret;if(array._eachValues!==undefined){ret=fn.call(promise._boundValue(),value,this.index,this.length)}else{ret=fn.call(promise._boundValue(),this.accum,value,this.index,this.length)}if(ret instanceof Promise){array._currentCancellable=ret}var promiseCreated=promise._popContext();debug.checkForgottenReturns(ret,promiseCreated,array._eachValues!==undefined?"Promise.each":"Promise.reduce",promise);return ret}}},{"./util":36}],29:[function(_dereq_,module,exports){"use strict";var util=_dereq_("./util");var schedule;var noAsyncScheduler=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")};var NativePromise=util.getNativePromise();if(util.isNode&&typeof MutationObserver==="undefined"){var GlobalSetImmediate=global.setImmediate;var ProcessNextTick=process.nextTick;schedule=util.isRecentNode?function(fn){GlobalSetImmediate.call(global,fn)}:function(fn){ProcessNextTick.call(process,fn)}}else if(typeof NativePromise==="function"&&typeof NativePromise.resolve==="function"){var nativePromise=NativePromise.resolve();schedule=function(fn){nativePromise.then(fn)}}else if(typeof MutationObserver!=="undefined"&&!(typeof window!=="undefined"&&window.navigator&&(window.navigator.standalone||window.cordova))){schedule=function(){var div=document.createElement("div");var opts={attributes:true};var toggleScheduled=false;var div2=document.createElement("div");var o2=new MutationObserver(function(){div.classList.toggle("foo");toggleScheduled=false});o2.observe(div2,opts);var scheduleToggle=function(){if(toggleScheduled)return;toggleScheduled=true;div2.classList.toggle("foo")};return function schedule(fn){var o=new MutationObserver(function(){o.disconnect();fn()});o.observe(div,opts);scheduleToggle()}}()}else if(typeof setImmediate!=="undefined"){schedule=function(fn){setImmediate(fn)}}else if(typeof setTimeout!=="undefined"){schedule=function(fn){setTimeout(fn,0)}}else{schedule=noAsyncScheduler}module.exports=schedule},{"./util":36}],30:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,debug){var PromiseInspection=Promise.PromiseInspection;var util=_dereq_("./util");function SettledPromiseArray(values){this.constructor$(values)}util.inherits(SettledPromiseArray,PromiseArray);SettledPromiseArray.prototype._promiseResolved=function(index,inspection){this._values[index]=inspection;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){this._resolve(this._values);return true}return false};SettledPromiseArray.prototype._promiseFulfilled=function(value,index){var ret=new PromiseInspection;ret._bitField=33554432;ret._settledValueField=value;return this._promiseResolved(index,ret)};SettledPromiseArray.prototype._promiseRejected=function(reason,index){var ret=new PromiseInspection;ret._bitField=16777216;ret._settledValueField=reason;return this._promiseResolved(index,ret)};Promise.settle=function(promises){debug.deprecated(".settle()",".reflect()");return new SettledPromiseArray(promises).promise()};Promise.prototype.settle=function(){return Promise.settle(this)}}},{"./util":36}],31:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection){var util=_dereq_("./util");var RangeError=_dereq_("./errors").RangeError;var AggregateError=_dereq_("./errors").AggregateError;var isArray=util.isArray;var CANCELLATION={};function SomePromiseArray(values){this.constructor$(values);this._howMany=0;this._unwrap=false;this._initialized=false}util.inherits(SomePromiseArray,PromiseArray);SomePromiseArray.prototype._init=function(){if(!this._initialized){return}if(this._howMany===0){this._resolve([]);return}this._init$(undefined,-5);var isArrayResolved=isArray(this._values);if(!this._isResolved()&&isArrayResolved&&this._howMany>this._canPossiblyFulfill()){this._reject(this._getRangeError(this.length()))}};SomePromiseArray.prototype.init=function(){this._initialized=true;this._init()};SomePromiseArray.prototype.setUnwrap=function(){this._unwrap=true};SomePromiseArray.prototype.howMany=function(){return this._howMany};SomePromiseArray.prototype.setHowMany=function(count){this._howMany=count};SomePromiseArray.prototype._promiseFulfilled=function(value){this._addFulfilled(value);if(this._fulfilled()===this.howMany()){this._values.length=this.howMany();if(this.howMany()===1&&this._unwrap){this._resolve(this._values[0])}else{this._resolve(this._values)}return true}return false};SomePromiseArray.prototype._promiseRejected=function(reason){this._addRejected(reason);return this._checkOutcome()};SomePromiseArray.prototype._promiseCancelled=function(){if(this._values instanceof Promise||this._values==null){return this._cancel()}this._addRejected(CANCELLATION);return this._checkOutcome()};SomePromiseArray.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){var e=new AggregateError;for(var i=this.length();i<this._values.length;++i){if(this._values[i]!==CANCELLATION){e.push(this._values[i])}}if(e.length>0){this._reject(e)}else{this._cancel()}return true}return false};SomePromiseArray.prototype._fulfilled=function(){return this._totalResolved};SomePromiseArray.prototype._rejected=function(){return this._values.length-this.length()};SomePromiseArray.prototype._addRejected=function(reason){this._values.push(reason)};SomePromiseArray.prototype._addFulfilled=function(value){this._values[this._totalResolved++]=value};SomePromiseArray.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()};SomePromiseArray.prototype._getRangeError=function(count){var message="Input array must contain at least "+this._howMany+" items but contains only "+count+" items";return new RangeError(message)};SomePromiseArray.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))};function some(promises,howMany){if((howMany|0)!==howMany||howMany<0){return apiRejection("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n")}var ret=new SomePromiseArray(promises);var promise=ret.promise();ret.setHowMany(howMany);ret.init();return promise}Promise.some=function(promises,howMany){return some(promises,howMany)};Promise.prototype.some=function(howMany){return some(this,howMany)};Promise._SomePromiseArray=SomePromiseArray}},{"./errors":12,"./util":36}],32:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function PromiseInspection(promise){if(promise!==undefined){promise=promise._target();this._bitField=promise._bitField;this._settledValueField=promise._isFateSealed()?promise._settledValue():undefined}else{this._bitField=0;this._settledValueField=undefined}}PromiseInspection.prototype._settledValue=function(){return this._settledValueField};var value=PromiseInspection.prototype.value=function(){if(!this.isFulfilled()){throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n")}return this._settledValue()};var reason=PromiseInspection.prototype.error=PromiseInspection.prototype.reason=function(){if(!this.isRejected()){throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n")}return this._settledValue()};var isFulfilled=PromiseInspection.prototype.isFulfilled=function(){return(this._bitField&33554432)!==0};var isRejected=PromiseInspection.prototype.isRejected=function(){return(this._bitField&16777216)!==0};var isPending=PromiseInspection.prototype.isPending=function(){return(this._bitField&50397184)===0};var isResolved=PromiseInspection.prototype.isResolved=function(){return(this._bitField&50331648)!==0};PromiseInspection.prototype.isCancelled=function(){return(this._bitField&8454144)!==0};Promise.prototype.__isCancelled=function(){return(this._bitField&65536)===65536};Promise.prototype._isCancelled=function(){return this._target().__isCancelled()};Promise.prototype.isCancelled=function(){return(this._target()._bitField&8454144)!==0};Promise.prototype.isPending=function(){return isPending.call(this._target())};Promise.prototype.isRejected=function(){return isRejected.call(this._target())};Promise.prototype.isFulfilled=function(){return isFulfilled.call(this._target())};Promise.prototype.isResolved=function(){return isResolved.call(this._target())};Promise.prototype.value=function(){return value.call(this._target())};Promise.prototype.reason=function(){var target=this._target();target._unsetRejectionIsUnhandled();return reason.call(target)};Promise.prototype._value=function(){return this._settledValue()};Promise.prototype._reason=function(){this._unsetRejectionIsUnhandled();return this._settledValue()};Promise.PromiseInspection=PromiseInspection}},{}],33:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var util=_dereq_("./util");var errorObj=util.errorObj;var isObject=util.isObject;function tryConvertToPromise(obj,context){if(isObject(obj)){if(obj instanceof Promise)return obj;var then=getThen(obj);if(then===errorObj){if(context)context._pushContext();var ret=Promise.reject(then.e);if(context)context._popContext();return ret}else if(typeof then==="function"){if(isAnyBluebirdPromise(obj)){var ret=new Promise(INTERNAL);obj._then(ret._fulfill,ret._reject,undefined,ret,null);return ret}return doThenable(obj,then,context)}}return obj}function doGetThen(obj){return obj.then}function getThen(obj){try{return doGetThen(obj)}catch(e){errorObj.e=e;return errorObj}}var hasProp={}.hasOwnProperty;function isAnyBluebirdPromise(obj){try{return hasProp.call(obj,"_promise0")}catch(e){return false}}function doThenable(x,then,context){var promise=new Promise(INTERNAL);var ret=promise;if(context)context._pushContext();promise._captureStackTrace();if(context)context._popContext();var synchronous=true;var result=util.tryCatch(then).call(x,resolve,reject);synchronous=false;if(promise&&result===errorObj){promise._rejectCallback(result.e,true,true);promise=null}function resolve(value){if(!promise)return;promise._resolveCallback(value);promise=null}function reject(reason){if(!promise)return;promise._rejectCallback(reason,synchronous,true);promise=null}return ret}return tryConvertToPromise}},{"./util":36}],34:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,debug){var util=_dereq_("./util");var TimeoutError=Promise.TimeoutError;function HandleWrapper(handle){this.handle=handle}HandleWrapper.prototype._resultCancelled=function(){clearTimeout(this.handle)};var afterValue=function(value){return delay(+this).thenReturn(value)};var delay=Promise.delay=function(ms,value){var ret;var handle;if(value!==undefined){ret=Promise.resolve(value)._then(afterValue,null,null,ms,undefined);if(debug.cancellation()&&value instanceof Promise){ret._setOnCancel(value)}}else{ret=new Promise(INTERNAL);handle=setTimeout(function(){ret._fulfill()},+ms);if(debug.cancellation()){ret._setOnCancel(new HandleWrapper(handle))}ret._captureStackTrace()}ret._setAsyncGuaranteed();return ret};Promise.prototype.delay=function(ms){return delay(ms,this)};var afterTimeout=function(promise,message,parent){var err;if(typeof message!=="string"){if(message instanceof Error){err=message}else{err=new TimeoutError("operation timed out")}}else{err=new TimeoutError(message)}util.markAsOriginatingFromRejection(err);promise._attachExtraTrace(err);promise._reject(err);if(parent!=null){parent.cancel()}};function successClear(value){clearTimeout(this.handle);return value}function failureClear(reason){clearTimeout(this.handle);throw reason}Promise.prototype.timeout=function(ms,message){ms=+ms;var ret,parent;var handleWrapper=new HandleWrapper(setTimeout(function timeoutTimeout(){if(ret.isPending()){afterTimeout(ret,message,parent)}},ms));if(debug.cancellation()){parent=this.then();ret=parent._then(successClear,failureClear,undefined,handleWrapper,undefined);ret._setOnCancel(handleWrapper)}else{ret=this._then(successClear,failureClear,undefined,handleWrapper,undefined)}return ret}}},{"./util":36}],35:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,apiRejection,tryConvertToPromise,createContext,INTERNAL,debug){var util=_dereq_("./util");var TypeError=_dereq_("./errors").TypeError;var inherits=_dereq_("./util").inherits;var errorObj=util.errorObj;var tryCatch=util.tryCatch;var NULL={};function thrower(e){setTimeout(function(){throw e},0)}function castPreservingDisposable(thenable){var maybePromise=tryConvertToPromise(thenable);if(maybePromise!==thenable&&typeof thenable._isDisposable==="function"&&typeof thenable._getDisposer==="function"&&thenable._isDisposable()){maybePromise._setDisposable(thenable._getDisposer())}return maybePromise}function dispose(resources,inspection){var i=0;var len=resources.length;var ret=new Promise(INTERNAL);function iterator(){if(i>=len)return ret._fulfill();var maybePromise=castPreservingDisposable(resources[i++]);if(maybePromise instanceof Promise&&maybePromise._isDisposable()){try{maybePromise=tryConvertToPromise(maybePromise._getDisposer().tryDispose(inspection),resources.promise)}catch(e){return thrower(e)}if(maybePromise instanceof Promise){return maybePromise._then(iterator,thrower,null,null,null)}}iterator()}iterator();return ret}function Disposer(data,promise,context){this._data=data;this._promise=promise;this._context=context}Disposer.prototype.data=function(){return this._data};Disposer.prototype.promise=function(){return this._promise};Disposer.prototype.resource=function(){if(this.promise().isFulfilled()){return this.promise().value()}return NULL};Disposer.prototype.tryDispose=function(inspection){var resource=this.resource();var context=this._context;if(context!==undefined)context._pushContext();var ret=resource!==NULL?this.doDispose(resource,inspection):null;if(context!==undefined)context._popContext();this._promise._unsetDisposable();this._data=null;return ret};Disposer.isDisposer=function(d){return d!=null&&typeof d.resource==="function"&&typeof d.tryDispose==="function"};function FunctionDisposer(fn,promise,context){this.constructor$(fn,promise,context)}inherits(FunctionDisposer,Disposer);FunctionDisposer.prototype.doDispose=function(resource,inspection){var fn=this.data();return fn.call(resource,resource,inspection)};function maybeUnwrapDisposer(value){if(Disposer.isDisposer(value)){this.resources[this.index]._setDisposable(value);return value.promise()}return value}function ResourceList(length){this.length=length;this.promise=null;this[length-1]=null}ResourceList.prototype._resultCancelled=function(){var len=this.length;for(var i=0;i<len;++i){var item=this[i];if(item instanceof Promise){item.cancel()}}};Promise.using=function(){var len=arguments.length;if(len<2)return apiRejection("you must pass at least 2 arguments to Promise.using");var fn=arguments[len-1];if(typeof fn!=="function"){return apiRejection("expecting a function but got "+util.classString(fn))}var input;var spreadArgs=true;if(len===2&&Array.isArray(arguments[0])){input=arguments[0];len=input.length;spreadArgs=false}else{input=arguments;len--}var resources=new ResourceList(len);for(var i=0;i<len;++i){var resource=input[i];if(Disposer.isDisposer(resource)){var disposer=resource;resource=resource.promise();resource._setDisposable(disposer)}else{var maybePromise=tryConvertToPromise(resource);if(maybePromise instanceof Promise){resource=maybePromise._then(maybeUnwrapDisposer,null,null,{resources:resources,index:i},undefined)}}resources[i]=resource}var reflectedResources=new Array(resources.length);for(var i=0;i<reflectedResources.length;++i){reflectedResources[i]=Promise.resolve(resources[i]).reflect()}var resultPromise=Promise.all(reflectedResources).then(function(inspections){for(var i=0;i<inspections.length;++i){var inspection=inspections[i];if(inspection.isRejected()){errorObj.e=inspection.error();return errorObj}else if(!inspection.isFulfilled()){resultPromise.cancel();return}inspections[i]=inspection.value()}promise._pushContext();fn=tryCatch(fn);var ret=spreadArgs?fn.apply(undefined,inspections):fn(inspections);var promiseCreated=promise._popContext();debug.checkForgottenReturns(ret,promiseCreated,"Promise.using",promise);return ret});var promise=resultPromise.lastly(function(){var inspection=new Promise.PromiseInspection(resultPromise);return dispose(resources,inspection)});resources.promise=promise;promise._setOnCancel(resources);return promise};Promise.prototype._setDisposable=function(disposer){this._bitField=this._bitField|131072;this._disposer=disposer};Promise.prototype._isDisposable=function(){return(this._bitField&131072)>0};Promise.prototype._getDisposer=function(){return this._disposer};Promise.prototype._unsetDisposable=function(){this._bitField=this._bitField&~131072;this._disposer=undefined};Promise.prototype.disposer=function(fn){if(typeof fn==="function"){return new FunctionDisposer(fn,this,createContext())}throw new TypeError}}},{"./errors":12,"./util":36}],36:[function(_dereq_,module,exports){"use strict";var es5=_dereq_("./es5");var canEvaluate=typeof navigator=="undefined";var errorObj={e:{}};var tryCatchTarget;var globalObject=typeof self!=="undefined"?self:typeof window!=="undefined"?window:typeof global!=="undefined"?global:this!==undefined?this:null;function tryCatcher(){try{var target=tryCatchTarget;tryCatchTarget=null;return target.apply(this,arguments)}catch(e){errorObj.e=e;return errorObj}}function tryCatch(fn){tryCatchTarget=fn;return tryCatcher}var inherits=function(Child,Parent){var hasProp={}.hasOwnProperty;function T(){this.constructor=Child;this.constructor$=Parent;for(var propertyName in Parent.prototype){if(hasProp.call(Parent.prototype,propertyName)&&propertyName.charAt(propertyName.length-1)!=="$"){this[propertyName+"$"]=Parent.prototype[propertyName]}}}T.prototype=Parent.prototype;Child.prototype=new T;return Child.prototype};function isPrimitive(val){return val==null||val===true||val===false||typeof val==="string"||typeof val==="number"}function isObject(value){return typeof value==="function"||typeof value==="object"&&value!==null}function maybeWrapAsError(maybeError){if(!isPrimitive(maybeError))return maybeError;return new Error(safeToString(maybeError))}function withAppended(target,appendee){var len=target.length;var ret=new Array(len+1);var i;for(i=0;i<len;++i){ret[i]=target[i]}ret[i]=appendee;return ret}function getDataPropertyOrDefault(obj,key,defaultValue){if(es5.isES5){var desc=Object.getOwnPropertyDescriptor(obj,key);if(desc!=null){return desc.get==null&&desc.set==null?desc.value:defaultValue}}else{return{}.hasOwnProperty.call(obj,key)?obj[key]:undefined}}function notEnumerableProp(obj,name,value){if(isPrimitive(obj))return obj;var descriptor={value:value,configurable:true,enumerable:false,writable:true};es5.defineProperty(obj,name,descriptor);return obj}function thrower(r){throw r}var inheritedDataKeys=function(){var excludedPrototypes=[Array.prototype,Object.prototype,Function.prototype];var isExcludedProto=function(val){for(var i=0;i<excludedPrototypes.length;++i){if(excludedPrototypes[i]===val){return true}}return false};if(es5.isES5){var getKeys=Object.getOwnPropertyNames;return function(obj){var ret=[];var visitedKeys=Object.create(null);while(obj!=null&&!isExcludedProto(obj)){var keys;try{keys=getKeys(obj)}catch(e){return ret}for(var i=0;i<keys.length;++i){var key=keys[i];if(visitedKeys[key])continue;visitedKeys[key]=true;var desc=Object.getOwnPropertyDescriptor(obj,key);if(desc!=null&&desc.get==null&&desc.set==null){ret.push(key)}}obj=es5.getPrototypeOf(obj)}return ret}}else{var hasProp={}.hasOwnProperty;return function(obj){if(isExcludedProto(obj))return[];var ret=[];enumeration:for(var key in obj){if(hasProp.call(obj,key)){ret.push(key)}else{for(var i=0;i<excludedPrototypes.length;++i){if(hasProp.call(excludedPrototypes[i],key)){continue enumeration}}ret.push(key)}}return ret}}}();var thisAssignmentPattern=/this\s*\.\s*\S+\s*=/;function isClass(fn){try{if(typeof fn==="function"){var keys=es5.names(fn.prototype);var hasMethods=es5.isES5&&keys.length>1;var hasMethodsOtherThanConstructor=keys.length>0&&!(keys.length===1&&keys[0]==="constructor");var hasThisAssignmentAndStaticMethods=thisAssignmentPattern.test(fn+"")&&es5.names(fn).length>0;if(hasMethods||hasMethodsOtherThanConstructor||hasThisAssignmentAndStaticMethods){return true}}return false}catch(e){return false}}function toFastProperties(obj){function FakeConstructor(){}FakeConstructor.prototype=obj;var l=8;while(l--)new FakeConstructor;return obj;eval(obj)}var rident=/^[a-z$_][a-z$_0-9]*$/i;function isIdentifier(str){return rident.test(str)}function filledRange(count,prefix,suffix){var ret=new Array(count);for(var i=0;i<count;++i){ret[i]=prefix+i+suffix}return ret}function safeToString(obj){try{return obj+""}catch(e){return"[no string representation]"}}function isError(obj){return obj!==null&&typeof obj==="object"&&typeof obj.message==="string"&&typeof obj.name==="string"}function markAsOriginatingFromRejection(e){try{notEnumerableProp(e,"isOperational",true)}catch(ignore){}}function originatesFromRejection(e){if(e==null)return false;return e instanceof Error["__BluebirdErrorTypes__"].OperationalError||e["isOperational"]===true}function canAttachTrace(obj){return isError(obj)&&es5.propertyIsWritable(obj,"stack")}var ensureErrorObject=function(){if(!("stack"in new Error)){return function(value){if(canAttachTrace(value))return value;try{throw new Error(safeToString(value))}catch(err){return err}}}else{return function(value){if(canAttachTrace(value))return value;return new Error(safeToString(value))}}}();function classString(obj){return{}.toString.call(obj)}function copyDescriptors(from,to,filter){var keys=es5.names(from);for(var i=0;i<keys.length;++i){var key=keys[i];if(filter(key)){try{es5.defineProperty(to,key,es5.getDescriptor(from,key))}catch(ignore){}}}}var asArray=function(v){if(es5.isArray(v)){return v}return null};if(typeof Symbol!=="undefined"&&Symbol.iterator){var ArrayFrom=typeof Array.from==="function"?function(v){return Array.from(v)}:function(v){var ret=[];var it=v[Symbol.iterator]();var itResult;while(!(itResult=it.next()).done){ret.push(itResult.value)}return ret};asArray=function(v){if(es5.isArray(v)){return v}else if(v!=null&&typeof v[Symbol.iterator]==="function"){return ArrayFrom(v)}return null}}var isNode=typeof process!=="undefined"&&classString(process).toLowerCase()==="[object process]";function env(key,def){return isNode?process.env[key]:def}function getNativePromise(){if(typeof Promise==="function"){try{var promise=new Promise(function(){});if({}.toString.call(promise)==="[object Promise]"){return Promise}}catch(e){}}}function domainBind(self,cb){return self.bind(cb)}var ret={isClass:isClass,isIdentifier:isIdentifier,inheritedDataKeys:inheritedDataKeys,getDataPropertyOrDefault:getDataPropertyOrDefault,thrower:thrower,isArray:es5.isArray,asArray:asArray,notEnumerableProp:notEnumerableProp,isPrimitive:isPrimitive,isObject:isObject,isError:isError,canEvaluate:canEvaluate,errorObj:errorObj,tryCatch:tryCatch,inherits:inherits,withAppended:withAppended,maybeWrapAsError:maybeWrapAsError,toFastProperties:toFastProperties,filledRange:filledRange,toString:safeToString,canAttachTrace:canAttachTrace,ensureErrorObject:ensureErrorObject,originatesFromRejection:originatesFromRejection,markAsOriginatingFromRejection:markAsOriginatingFromRejection,classString:classString,copyDescriptors:copyDescriptors,
hasDevTools:typeof chrome!=="undefined"&&chrome&&typeof chrome.loadTimes==="function",isNode:isNode,env:env,global:globalObject,getNativePromise:getNativePromise,domainBind:domainBind};ret.isRecentNode=ret.isNode&&function(){var version=process.versions.node.split(".").map(Number);return version[0]===0&&version[1]>10||version[0]>0}();if(ret.isNode)ret.toFastProperties(process);try{throw new Error}catch(e){ret.lastLineError=e}module.exports=ret},{"./es5":13}]},{},[4])(4)});if(typeof window!=="undefined"&&window!==null){window.P=window.Promise}else if(typeof self!=="undefined"&&self!==null){self.P=self.Promise}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:70}],70:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],71:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};module.exports=function caseParser(obj,cases,filter){if(isObj(obj)&&isObj(cases)){return parse(obj,cases,filter||function(){return true})}else{return obj}};function parse(obj,cases,filter){var not;var result={};if(isObj(obj)&&obj.constructor===Array){result=[]}for(var i in obj){if(filter(obj[i],i,obj)){if(cases[i]!==void 0){if(cases[i]){if(obj[i]===null){return null}result=isObj(obj[i])?merge(result,parse(obj[i],cases,filter),filter):merge(result,obj[i],filter)}}else if(i[0]==="!"&&cases[not=i.slice(1)]!==void 0){if(!cases[not]){result=isObj(obj[i])?merge(result,parse(obj[i],cases,filter),filter):merge(result,obj[i],filter)}}else if(isObj(obj[i])){result[i]=parse(obj[i],cases,filter)}else{result[i]=obj[i]}}}if(result.val){for(var _i in result){if(_i!=="val"){return result}}return result.val}else{return result}}function merge(a,b,filter){if(!isObj(a)){if(!isObj(b)){return b}else{a={val:a}}}else if(!isObj(b)){b={val:b}}for(var i in b){if(filter(b[i],i,b)){if(a[i]===void 0){if(b[i]===null){delete a[i]}else{a[i]=b[i]}}else{var value=merge(a[i],b[i],filter);if(value===null){delete a[i]}else{a[i]=value}}}}return a}function isObj(obj){return(typeof obj==="undefined"?"undefined":_typeof(obj))==="object"&&obj!==null}},{}],72:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ClocksyServer=exports.ClocksyClient=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _timm=require("timm");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var DEFAULT_PERIOD=1e4;var DEFAULT_ALPHA=.2;var ClocksyServer=function(){function ClocksyServer(){_classCallCheck(this,ClocksyServer)}_createClass(ClocksyServer,[{key:"processRequest",value:function processRequest(req){return(0,_timm.set)(req,"tServer",(new Date).getTime())}}]);return ClocksyServer}();var ClocksyClient=function(){function ClocksyClient(){var _this=this;var _ref=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var _ref$alpha=_ref.alpha;var alpha=_ref$alpha===undefined?DEFAULT_ALPHA:_ref$alpha;var _ref$updatePeriod=_ref.updatePeriod;var updatePeriod=_ref$updatePeriod===undefined?DEFAULT_PERIOD:_ref$updatePeriod;var sendRequest=_ref.sendRequest;_classCallCheck(this,ClocksyClient);this.tDelta=null;this.rtt=null;this.timer=null;this.alpha=alpha;this.updatePeriod=updatePeriod;this.sendRequest=sendRequest||function(){};this.fHiddenTab=false;try{this.fHiddenTab=document.hidden;document.addEventListener("visibilitychange",function(){_this.fHiddenTab=document.hidden})}catch(err){}}_createClass(ClocksyClient,[{key:"createRequest",value:function createRequest(){return{tTx:(new Date).getTime()}}},{key:"processResponse",value:function processResponse(rsp){var tRx=(new Date).getTime();var tTx=rsp.tTx;var tServer=rsp.tServer;var rtt=tRx-tTx;var tDelta=tServer-rtt/2-tTx;this.tDelta=this.calcNewDelta(tDelta);this.rtt=rtt;return this.tDelta}},{key:"calcNewDelta",value:function calcNewDelta(tDelta){var tDelta0=this.tDelta;var alpha=this.alpha;return tDelta0!=null?alpha*tDelta+(1-alpha)*tDelta0:tDelta}},{key:"getDelta",value:function getDelta(){return this.tDelta}},{key:"getRtt",value:function getRtt(){return this.rtt}},{key:"start",value:function start(){if(this.timer!=null)this.stop();this.sendAutoRequest(true);this.timer=setInterval(this.sendAutoRequest.bind(this),this.updatePeriod)}},{key:"stop",value:function stop(){if(this.timer==null)return;clearInterval(this.timer);this.timer=null}},{key:"sendAutoRequest",value:function sendAutoRequest(fForce){if(this.fHiddenTab&&!fForce)return;var req=this.createRequest();this.sendRequest(req)}}]);return ClocksyClient}();exports.ClocksyClient=ClocksyClient;exports.ClocksyServer=ClocksyServer},{timm:73}],73:[function(require,module,exports){(function(process){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};exports.clone=clone;exports.addLast=addLast;exports.addFirst=addFirst;exports.insert=insert;exports.removeAt=removeAt;exports.replaceAt=replaceAt;exports.getIn=getIn;exports.set=set;exports.setIn=setIn;exports.updateIn=updateIn;exports.merge=merge;exports.mergeIn=mergeIn;exports.omit=omit;exports.addDefaults=addDefaults;var INVALID_ARGS="INVALID_ARGS";function throwStr(msg){throw new Error(msg)}function clone(obj){if(Array.isArray(obj)){return[].concat(obj)}var keys=Object.keys(obj);var out={};for(var i=0;i<keys.length;i++){var key=keys[i];out[key]=obj[key]}return out}function doMerge(fAddDefaults){for(var _len=arguments.length,rest=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){rest[_key-1]=arguments[_key]}var out=rest[0];!(out!=null)&&throwStr(process.env.NODE_ENV!=="production"?"At least one object should be provided to merge()":INVALID_ARGS);var fChanged=false;for(var idx=1;idx<rest.length;idx++){var obj=rest[idx];if(obj==null){continue}var keys=Object.keys(obj);if(!keys.length){continue}for(var j=0;j<=keys.length;j++){var key=keys[j];if(fAddDefaults&&out[key]!==undefined){continue}var nextVal=obj[key];if(nextVal===undefined||nextVal===out[key]){continue}if(!fChanged){fChanged=true;out=clone(out)}out[key]=nextVal}}return out}function isObject(o){var type=typeof o==="undefined"?"undefined":_typeof(o);return o!=null&&(type==="object"||type==="function")}function addLast(array,val){if(Array.isArray(val)){return array.concat(val)}return array.concat([val])}function addFirst(array,val){if(Array.isArray(val)){return val.concat(array)}return[val].concat(array)}function insert(array,idx,val){return array.slice(0,idx).concat(Array.isArray(val)?val:[val]).concat(array.slice(idx))}function removeAt(array,idx){return array.slice(0,idx).concat(array.slice(idx+1))}function replaceAt(array,idx,newItem){if(array[idx]===newItem){return array}return array.slice(0,idx).concat([newItem]).concat(array.slice(idx+1))}function getIn(obj,path){!Array.isArray(path)&&throwStr(process.env.NODE_ENV!=="production"?"A path array should be provided when calling getIn()":INVALID_ARGS);if(obj==null){return undefined}var ptr=obj;for(var i=0;i<path.length;i++){var key=path[i];ptr=ptr!=null?ptr[key]:undefined;if(ptr===undefined){return ptr}}return ptr}function set(obj,key,val){var finalObj=obj==null?{}:obj;if(finalObj[key]===val){return finalObj}var obj2=clone(finalObj);obj2[key]=val;return obj2}function doSetIn(obj,path,val,idx){var newValue=void 0;var key=path[idx];if(idx===path.length-1){newValue=val}else{var nestedObj=isObject(obj)?obj[key]:{};newValue=doSetIn(nestedObj,path,val,idx+1)}return set(obj,key,newValue)}function setIn(obj,path,val){if(!path.length){return val}return doSetIn(obj,path,val,0)}function updateIn(obj,path,fnUpdate){var prevVal=getIn(obj,path);var nextVal=fnUpdate(prevVal);return setIn(obj,path,nextVal)}function merge(a,b,c,d,e,f){var out=void 0;for(var _len2=arguments.length,rest=Array(_len2>6?_len2-6:0),_key2=6;_key2<_len2;_key2++){rest[_key2-6]=arguments[_key2]}if(rest.length){out=doMerge.call.apply(doMerge,[null,false,a,b,c,d,e,f].concat(rest))}else{out=doMerge(false,a,b,c,d,e,f)}return out}function mergeIn(a,path,b,c,d,e,f){var prevVal=getIn(a,path);if(prevVal==null){prevVal={}}var nextVal=void 0;for(var _len3=arguments.length,rest=Array(_len3>7?_len3-7:0),_key3=7;_key3<_len3;_key3++){rest[_key3-7]=arguments[_key3]}if(rest.length){nextVal=doMerge.call.apply(doMerge,[null,false,prevVal,b,c,d,e,f].concat(rest))}else{nextVal=doMerge(false,prevVal,b,c,d,e,f)}return setIn(a,path,nextVal)}function omit(obj,attrs){var omitList=Array.isArray(attrs)?attrs:[attrs];var fDoSomething=false;for(var i=0;i<omitList.length;i++){if(obj.hasOwnProperty(omitList[i])){fDoSomething=true;break}}if(!fDoSomething)return obj;var out={};var keys=Object.keys(obj);for(var _i=0;_i<keys.length;_i++){var key=keys[_i];if(omitList.indexOf(key)>=0)continue;out[key]=obj[key]}return out}function addDefaults(a,b,c,d,e,f){var out=void 0;for(var _len4=arguments.length,rest=Array(_len4>6?_len4-6:0),_key4=6;_key4<_len4;_key4++){rest[_key4-6]=arguments[_key4]}if(rest.length){out=doMerge.call.apply(doMerge,[null,true,a,b,c,d,e,f].concat(rest))}else{out=doMerge(true,a,b,c,d,e,f)}return out}var timm={addLast:addLast,addFirst:addFirst,insert:insert,removeAt:removeAt,replaceAt:replaceAt,getIn:getIn,set:set,setIn:setIn,updateIn:updateIn,merge:merge,mergeIn:mergeIn,addDefaults:addDefaults};exports.default=timm}).call(this,require("_process"))},{_process:70}],74:[function(require,module,exports){module.exports=function(obj){return obj!=null&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)};function isBuffer(obj){return!!obj.constructor&&typeof obj.constructor.isBuffer==="function"&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return typeof obj.readFloatLE==="function"&&typeof obj.slice==="function"&&isBuffer(obj.slice(0,0))}},{}],75:[function(require,module,exports){"use strict";var isStream=module.exports=function(stream){return stream!==null&&typeof stream==="object"&&typeof stream.pipe==="function"};isStream.writable=function(stream){return isStream(stream)&&stream.writable!==false&&typeof stream._write==="function"&&typeof stream._writableState==="object"};isStream.readable=function(stream){return isStream(stream)&&stream.readable!==false&&typeof stream._read==="function"&&typeof stream._readableState==="object"};isStream.duplex=function(stream){return isStream.writable(stream)&&isStream.readable(stream)};isStream.transform=function(stream){return isStream.duplex(stream)&&typeof stream._transform==="function"&&typeof stream._transformState==="object"}},{}],76:[function(require,module,exports){(function(global){var FUNC_ERROR_TEXT="Expected a function";var HASH_UNDEFINED="__lodash_hash_undefined__";var INFINITY=1/0;var funcTag="[object Function]",genTag="[object GeneratorFunction]",symbolTag="[object Symbol]";var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;var reEscapeChar=/\\(\\)?/g;var reIsHostCtor=/^\[object .+?Constructor\]$/;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();function getValue(object,key){return object==null?undefined:object[key]}function isHostObject(value){var result=false;if(value!=null&&typeof value.toString!="function"){try{result=!!(value+"")}catch(e){}}return result}var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;var coreJsData=root["__core-js_shared__"];var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Symbol=root.Symbol,splice=arrayProto.splice;var Map=getNative(root,"Map"),nativeCreate=getNative(Object,"create");var symbolProto=Symbol?Symbol.prototype:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function Hash(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}}function hashDelete(key){return this.has(key)&&delete this.__data__[key]}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){data.push([key,value])}else{data[index][1]=value}return this}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(key){return getMapData(this,key)["delete"](key)}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){getMapData(this,key).set(key,value);return this}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}function baseGet(object,path){path=isKey(path,object)?[path]:castPath(path);var index=0,length=path.length;while(object!=null&&index<length){object=object[toKey(path[index++])]}return index&&index==length?object:undefined}function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function baseToString(value){if(typeof value=="string"){return value}if(isSymbol(value)){return symbolToString?symbolToString.call(value):""}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function castPath(value){return isArray(value)?value:stringToPath(value)}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}function isKey(value,object){if(isArray(value)){return false}var type=typeof value;if(type=="number"||type=="symbol"||type=="boolean"||value==null||isSymbol(value)){return true}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object)}function isKeyable(value){var type=typeof value;return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}var stringToPath=memoize(function(string){string=toString(string);var result=[];if(reLeadingDot.test(string)){result.push("")}string.replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result});function toKey(value){if(typeof value=="string"||isSymbol(value)){return value}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function memoize(func,resolver){if(typeof func!="function"||resolver&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result);return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}memoize.Cache=MapCache;function eq(value,other){return value===other||value!==value&&other!==other}var isArray=Array.isArray;function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&objectToString.call(value)==symbolTag}function toString(value){return value==null?"":baseToString(value)}function get(object,path,defaultValue){var result=object==null?undefined:baseGet(object,path);return result===undefined?defaultValue:result}module.exports=get}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],77:[function(require,module,exports){(function(global){var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();var nativeIsFinite=root.isFinite;function isFinite(value){return typeof value=="number"&&nativeIsFinite(value)}module.exports=isFinite}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],78:[function(require,module,exports){(function(global){var LARGE_ARRAY_SIZE=200;var HASH_UNDEFINED="__lodash_hash_undefined__";var MAX_SAFE_INTEGER=9007199254740991;var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",promiseTag="[object Promise]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",weakMapTag="[object WeakMap]";var arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;var reFlags=/\w*$/;var reIsHostCtor=/^\[object .+?Constructor\]$/;var reIsUint=/^(?:0|[1-9]\d*)$/;var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=false;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports;var freeModule=freeExports&&typeof module=="object"&&module&&!module.nodeType&&module;var moduleExports=freeModule&&freeModule.exports===freeExports;var freeProcess=moduleExports&&freeGlobal.process;var nodeUtil=function(){try{return freeProcess&&freeProcess.binding("util")}catch(e){}}();var nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;function addMapEntry(map,pair){map.set(pair[0],pair[1]);return map}function addSetEntry(set,value){set.add(value);return set}function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}function arrayEach(array,iteratee){var index=-1,length=array?array.length:0;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index]}return array}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array?array.length:0;if(initAccum&&length){accumulator=array[++index]}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array)}return accumulator}function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index)}return result}function baseUnary(func){return function(value){return func(value)}}function getValue(object,key){return object==null?undefined:object[key]}function isHostObject(value){var result=false;if(value!=null&&typeof value.toString!="function"){try{result=!!(value+"")}catch(e){}}return result}function mapToArray(map){var index=-1,result=Array(map.size);map.forEach(function(value,key){result[++index]=[key,value]});return result}function overArg(func,transform){return function(arg){return func(transform(arg))}}function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value});return result}var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;var coreJsData=root["__core-js_shared__"];var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objectCtorString=funcToString.call(Object);var objectToString=objectProto.toString;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Buffer=moduleExports?root.Buffer:undefined,Symbol=root.Symbol,Uint8Array=root.Uint8Array,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice;var nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:undefined,nativeKeys=overArg(Object.keys,Object),nativeMax=Math.max;var DataView=getNative(root,"DataView"),Map=getNative(root,"Map"),Promise=getNative(root,"Promise"),Set=getNative(root,"Set"),WeakMap=getNative(root,"WeakMap"),nativeCreate=getNative(Object,"create");var dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap);var symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined;function Hash(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}}function hashDelete(key){return this.has(key)&&delete this.__data__[key]}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){data.push([key,value])}else{data[index][1]=value}return this}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(key){return getMapData(this,key)["delete"](key)}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){getMapData(this,key).set(key,value);return this}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;function Stack(entries){this.__data__=new ListCache(entries)}function stackClear(){this.__data__=new ListCache}function stackDelete(key){return this.__data__["delete"](key)}function stackGet(key){return this.__data__.get(key)}function stackHas(key){return this.__data__.has(key)}function stackSet(key,value){var cache=this.__data__;if(cache instanceof ListCache){var pairs=cache.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1){pairs.push([key,value]);return this}cache=this.__data__=new MapCache(pairs)}cache.set(key,value);return this}Stack.prototype.clear=stackClear;Stack.prototype["delete"]=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;function arrayLikeKeys(value,inherited){var result=isArray(value)||isArguments(value)?baseTimes(value.length,String):[];var length=result.length,skipIndexes=!!length;
for(var key in value){if((inherited||hasOwnProperty.call(value,key))&&!(skipIndexes&&(key=="length"||isIndex(key,length)))){result.push(key)}}return result}function assignMergeValue(object,key,value){if(value!==undefined&&!eq(object[key],value)||typeof key=="number"&&value===undefined&&!(key in object)){object[key]=value}}function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){object[key]=value}}function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}function baseAssign(object,source){return object&&copyObject(source,keys(source),object)}function baseClone(value,isDeep,isFull,customizer,key,object,stack){var result;if(customizer){result=object?customizer(value,key,object,stack):customizer(value)}if(result!==undefined){return result}if(!isObject(value)){return value}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return copyArray(value,result)}}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value)){return cloneBuffer(value,isDeep)}if(tag==objectTag||tag==argsTag||isFunc&&!object){if(isHostObject(value)){return object?value:{}}result=initCloneObject(isFunc?{}:value);if(!isDeep){return copySymbols(value,baseAssign(result,value))}}else{if(!cloneableTags[tag]){return object?value:{}}result=initCloneByTag(value,tag,baseClone,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked){return stacked}stack.set(value,result);if(!isArr){var props=isFull?getAllKeys(value):keys(value)}arrayEach(props||value,function(subValue,key){if(props){key=subValue;subValue=value[key]}assignValue(result,key,baseClone(subValue,isDeep,isFull,customizer,key,value,stack))});return result}function baseCreate(proto){return isObject(proto)?objectCreate(proto):{}}function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object))}function baseGetTag(value){return objectToString.call(value)}function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objectToString.call(value)]}function baseKeys(object){if(!isPrototype(object)){return nativeKeys(object)}var result=[];for(var key in Object(object)){if(hasOwnProperty.call(object,key)&&key!="constructor"){result.push(key)}}return result}function baseKeysIn(object){if(!isObject(object)){return nativeKeysIn(object)}var isProto=isPrototype(object),result=[];for(var key in object){if(!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}function baseMerge(object,source,srcIndex,customizer,stack){if(object===source){return}if(!(isArray(source)||isTypedArray(source))){var props=baseKeysIn(source)}arrayEach(props||source,function(srcValue,key){if(props){key=srcValue;srcValue=source[key]}if(isObject(srcValue)){stack||(stack=new Stack);baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack)}else{var newValue=customizer?customizer(object[key],srcValue,key+"",object,source,stack):undefined;if(newValue===undefined){newValue=srcValue}assignMergeValue(object,key,newValue)}})}function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=object[key],srcValue=source[key],stacked=stack.get(srcValue);if(stacked){assignMergeValue(object,key,stacked);return}var newValue=customizer?customizer(objValue,srcValue,key+"",object,source,stack):undefined;var isCommon=newValue===undefined;if(isCommon){newValue=srcValue;if(isArray(srcValue)||isTypedArray(srcValue)){if(isArray(objValue)){newValue=objValue}else if(isArrayLikeObject(objValue)){newValue=copyArray(objValue)}else{isCommon=false;newValue=baseClone(srcValue,true)}}else if(isPlainObject(srcValue)||isArguments(srcValue)){if(isArguments(objValue)){newValue=toPlainObject(objValue)}else if(!isObject(objValue)||srcIndex&&isFunction(objValue)){isCommon=false;newValue=baseClone(srcValue,true)}else{newValue=objValue}}else{isCommon=false}}if(isCommon){stack.set(srcValue,newValue);mergeFunc(newValue,srcValue,srcIndex,customizer,stack);stack["delete"](srcValue)}assignMergeValue(object,key,newValue)}function baseRest(func,start){start=nativeMax(start===undefined?func.length-1:start,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length){array[index]=args[start+index]}index=-1;var otherArgs=Array(start+1);while(++index<start){otherArgs[index]=args[index]}otherArgs[start]=array;return apply(func,this,otherArgs)}}function cloneBuffer(buffer,isDeep){if(isDeep){return buffer.slice()}var result=new buffer.constructor(buffer.length);buffer.copy(result);return result}function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);new Uint8Array(result).set(new Uint8Array(arrayBuffer));return result}function cloneDataView(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)}function cloneMap(map,isDeep,cloneFunc){var array=isDeep?cloneFunc(mapToArray(map),true):mapToArray(map);return arrayReduce(array,addMapEntry,new map.constructor)}function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));result.lastIndex=regexp.lastIndex;return result}function cloneSet(set,isDeep,cloneFunc){var array=isDeep?cloneFunc(setToArray(set),true):setToArray(set);return arrayReduce(array,addSetEntry,new set.constructor)}function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{}}function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)}function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index]}return array}function copyObject(source,props,object,customizer){object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];var newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;assignValue(object,key,newValue===undefined?source[key]:newValue)}return object}function copySymbols(source,object){return copyObject(source,getSymbols(source),object)}function createAssigner(assigner){return baseRest(function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;customizer=assigner.length>3&&typeof customizer=="function"?(length--,customizer):undefined;if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1}object=Object(object);while(++index<length){var source=sources[index];if(source){assigner(object,source,index,customizer)}}return object})}function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols)}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}var getSymbols=nativeGetSymbols?overArg(nativeGetSymbols,Object):stubArray;var getTag=baseGetTag;if(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&getTag(Promise.resolve())!=promiseTag||Set&&getTag(new Set)!=setTag||WeakMap&&getTag(new WeakMap)!=weakMapTag){getTag=function(value){var result=objectToString.call(value),Ctor=result==objectTag?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):undefined;if(ctorString){switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}}return result}}function initCloneArray(array){var length=array.length,result=array.constructor(length);if(length&&typeof array[0]=="string"&&hasOwnProperty.call(array,"index")){result.index=array.index;result.input=array.input}return result}function initCloneObject(object){return typeof object.constructor=="function"&&!isPrototype(object)?baseCreate(getPrototype(object)):{}}function initCloneByTag(object,tag,cloneFunc,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case dataViewTag:return cloneDataView(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return cloneMap(object,isDeep,cloneFunc);case numberTag:case stringTag:return new Ctor(object);case regexpTag:return cloneRegExp(object);case setTag:return cloneSet(object,isDeep,cloneFunc);case symbolTag:return cloneSymbol(object)}}function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(typeof value=="number"||reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index;if(type=="number"?isArrayLike(object)&&isIndex(index,object.length):type=="string"&&index in object){return eq(object[index],value)}return false}function isKeyable(value){var type=typeof value;return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=="function"&&Ctor.prototype||objectProto;return value===proto}function nativeKeysIn(object){var result=[];if(object!=null){for(var key in Object(object)){result.push(key)}}return result}function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function eq(value,other){return value===other||value!==value&&other!==other}function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)}var isArray=Array.isArray;function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}var isBuffer=nativeIsBuffer||stubFalse;function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}function isPlainObject(value){if(!isObjectLike(value)||objectToString.call(value)!=objectTag||isHostObject(value)){return false}var proto=getPrototype(value);if(proto===null){return true}var Ctor=hasOwnProperty.call(proto,"constructor")&&proto.constructor;return typeof Ctor=="function"&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}var isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;function toPlainObject(value){return copyObject(value,keysIn(value))}function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}function keysIn(object){return isArrayLike(object)?arrayLikeKeys(object,true):baseKeysIn(object)}var merge=createAssigner(function(object,source,srcIndex){baseMerge(object,source,srcIndex)});function stubArray(){return[]}function stubFalse(){return false}module.exports=merge}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],79:[function(require,module,exports){(function(global){var FUNC_ERROR_TEXT="Expected a function";var HASH_UNDEFINED="__lodash_hash_undefined__";var INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991;var funcTag="[object Function]",genTag="[object GeneratorFunction]",symbolTag="[object Symbol]";var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;var reEscapeChar=/\\(\\)?/g;var reIsHostCtor=/^\[object .+?Constructor\]$/;var reIsUint=/^(?:0|[1-9]\d*)$/;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();function getValue(object,key){return object==null?undefined:object[key]}function isHostObject(value){var result=false;if(value!=null&&typeof value.toString!="function"){try{result=!!(value+"")}catch(e){}}return result}var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;var coreJsData=root["__core-js_shared__"];var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Symbol=root.Symbol,splice=arrayProto.splice;var Map=getNative(root,"Map"),nativeCreate=getNative(Object,"create");var symbolProto=Symbol?Symbol.prototype:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function Hash(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}}function hashDelete(key){return this.has(key)&&delete this.__data__[key]}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){data.push([key,value])}else{data[index][1]=value}return this}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(key){return getMapData(this,key)["delete"](key)}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){getMapData(this,key).set(key,value);return this}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){object[key]=value}}function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function baseSet(object,path,value,customizer){if(!isObject(object)){return object}path=isKey(path,object)?[path]:castPath(path);var index=-1,length=path.length,lastIndex=length-1,nested=object;while(nested!=null&&++index<length){var key=toKey(path[index]),newValue=value;if(index!=lastIndex){var objValue=nested[key];newValue=customizer?customizer(objValue,key,nested):undefined;if(newValue===undefined){newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{}}}assignValue(nested,key,newValue);nested=nested[key]}return object}function baseToString(value){if(typeof value=="string"){return value}if(isSymbol(value)){return symbolToString?symbolToString.call(value):""}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function castPath(value){return isArray(value)?value:stringToPath(value)}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(typeof value=="number"||reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}function isKey(value,object){if(isArray(value)){return false}var type=typeof value;if(type=="number"||type=="symbol"||type=="boolean"||value==null||isSymbol(value)){return true}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object)}function isKeyable(value){var type=typeof value;return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}var stringToPath=memoize(function(string){string=toString(string);var result=[];if(reLeadingDot.test(string)){result.push("")}string.replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result});function toKey(value){if(typeof value=="string"||isSymbol(value)){return value}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function memoize(func,resolver){if(typeof func!="function"||resolver&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result);return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}memoize.Cache=MapCache;function eq(value,other){return value===other||value!==value&&other!==other}var isArray=Array.isArray;function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&objectToString.call(value)==symbolTag}function toString(value){return value==null?"":baseToString(value)}function set(object,path,value){return object==null?object:baseSet(object,path,value)}module.exports=set}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],80:[function(require,module,exports){var _last=0;var _count=1;var adjusted=0;var _adjusted=0;module.exports=function timestamp(){var time=Date.now();if(_last===time){do{adjusted=time+_count++/(_count+999)}while(adjusted===_adjusted);_adjusted=adjusted}else{_count=1;adjusted=time}_adjusted=adjusted;_last=time;return adjusted}},{}],81:[function(require,module,exports){"use strict";module.exports=function(key,seed){var remainder,bytes,h1,h1b,c1,c2,k1,i;seed=1;remainder=key.length&3;bytes=key.length-remainder;h1=seed;c1=3432918353;c2=461845907;i=0;while(i<bytes){k1=key.charCodeAt(i)&255|(key.charCodeAt(++i)&255)<<8|(key.charCodeAt(++i)&255)<<16|(key.charCodeAt(++i)&255)<<24;++i;k1=(k1&65535)*c1+(((k1>>>16)*c1&65535)<<16)&4294967295;k1=k1<<15|k1>>>17;k1=(k1&65535)*c2+(((k1>>>16)*c2&65535)<<16)&4294967295;h1^=k1;h1=h1<<13|h1>>>19;h1b=(h1&65535)*5+(((h1>>>16)*5&65535)<<16)&4294967295;h1=(h1b&65535)+27492+(((h1b>>>16)+58964&65535)<<16)}k1=0;switch(remainder){case 3:k1^=(key.charCodeAt(i+2)&255)<<16;case 2:k1^=(key.charCodeAt(i+1)&255)<<8;case 1:k1^=key.charCodeAt(i)&255;k1=(k1&65535)*c1+(((k1>>>16)*c1&65535)<<16)&4294967295;k1=k1<<15|k1>>>17;k1=(k1&65535)*c2+(((k1>>>16)*c2&65535)<<16)&4294967295;h1^=k1}h1^=key.length;h1^=h1>>>16;h1=(h1&65535)*2246822507+(((h1>>>16)*2246822507&65535)<<16)&4294967295;h1^=h1>>>13;h1=(h1&65535)*3266489909+(((h1>>>16)*3266489909&65535)<<16)&4294967295;h1^=h1>>>16;return(h1>>>0).toString(36)}},{}],82:[function(require,module,exports){var _global=function(){return this}();var nativeWebSocket=_global.WebSocket||_global.MozWebSocket;var websocket_version=require("./version");function W3CWebSocket(uri,protocols){var native_instance;if(protocols){native_instance=new nativeWebSocket(uri,protocols)}else{native_instance=new nativeWebSocket(uri)}return native_instance}module.exports={w3cwebsocket:nativeWebSocket?W3CWebSocket:null,version:websocket_version}},{"./version":83}],83:[function(require,module,exports){module.exports=require("../package.json").version},{"../package.json":84}],84:[function(require,module,exports){module.exports={_args:[[{raw:"websocket",scope:null,escapedName:"websocket",name:"websocket",rawSpec:"",spec:"latest",type:"tag"},""]],_from:"websocket@latest",_id:"websocket@1.0.23",_inCache:true,_installable:true,_location:"/websocket",_nodeVersion:"0.10.45",_npmOperationalInternal:{host:"packages-16-east.internal.npmjs.com",tmp:"tmp/websocket-1.0.23.tgz_1463625793005_0.4532310354989022"},_npmUser:{name:"theturtle32",email:"brian@worlize.com"},_npmVersion:"2.15.1",_phantomChildren:{},_requested:{raw:"websocket",scope:null,escapedName:"websocket",name:"websocket",rawSpec:"",spec:"latest",type:"tag"},_requiredBy:["#USER"],_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.23.tgz",_shasum:"20de8ec4a7126b09465578cd5dbb29a9c296aac6",_shrinkwrap:null,_spec:"websocket",_where:"",author:{name:"Brian McKelvey",email:"brian@worlize.com",url:"https://www.worlize.com/"},browser:"lib/browser.js",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},config:{verbose:false},contributors:[{name:"Iaki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],dependencies:{debug:"^2.2.0",nan:"^2.3.3","typedarray-to-buffer":"^3.1.2",yaeti:"^0.0.4"},description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",devDependencies:{"buffer-equal":"^0.0.1",faucet:"^0.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-jshint":"^1.11.2","jshint-stylish":"^1.0.2",tape:"^4.0.1"},directories:{lib:"./lib"},dist:{shasum:"20de8ec4a7126b09465578cd5dbb29a9c296aac6",tarball:"https://registry.npmjs.org/websocket/-/websocket-1.0.23.tgz"},engines:{node:">=0.8.0"},gitHead:"ba2fa7e9676c456bcfb12ad160655319af66faed",homepage:"https://github.com/theturtle32/WebSocket-Node",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],license:"Apache-2.0",main:"index",maintainers:[{name:"theturtle32",email:"brian@worlize.com"}],name:"websocket",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},scripts:{gulp:"gulp",install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit"},version:"1.0.23"}},{}],85:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};exports.compute=function(val,previous,start,stamp,attach){if(val===void 0){val=this.val}if(val!==void 0){var type=typeof val==="undefined"?"undefined":_typeof(val);if(type==="function"){val=val.call(this,previous,start,stamp,attach)}else if(type==="object"&&val&&val.isBase){val=val.compute(void 0,void 0,start,stamp)}}else{val=previous!==void 0?previous:this}return val};exports.origin=function(){var reference=this;var val=reference.val;while(val&&(typeof val==="undefined"?"undefined":_typeof(val))==="object"&&val.isBase){reference=val;val=reference.val}return reference}},{}],86:[function(require,module,exports){"use strict";var Base=require("./");exports.setParent=function(val,stamp,parent,key){if(parent){this._parent=parent}else if(this._parent){this._parent=null}if(key!==void 0){this.key=key}return this};exports.child=Base;exports.generateConstructor=function(){return function derivedBase(val,stamp,parent,key){Base.call(this,val,stamp,parent,key)}};exports.getConstructor=function(){if(!this._Constructor){var keys=this._keys;if(keys){for(var i=0,len=keys.length;i<len;i++){this.createContextGetter(keys[i])}}var Constructor=this._Constructor=this.generateConstructor();Constructor.prototype=this}return this._Constructor};exports.Constructor={set:function set(val){this._Constructor=val},get:function get(){return this.getConstructor()}}},{"./":92}],87:[function(require,module,exports){"use strict";module.exports=function(key){var _this=this;var value=this.contextCandidate(this[key]);if(value){(function(){var privateKey="_"+key;var keys=value._keys;if(keys){for(var i=0,len=keys.length;i<len;i++){value.createContextGetter(keys[i])}}if(!(privateKey in _this)){_this[privateKey]=value;Object.defineProperty(_this,key,{get:function get(){var value=this[privateKey];if(value){if(!this.hasOwnProperty(privateKey)){value.__c=this;value._cLevel=1}else if(this.__c){value._cLevel=this._cLevel+1;value.__c=this.__c}else{value.clearContext()}}return value},set:function set(val){this[privateKey]=val},configurable:true})}})()}}},{}],88:[function(require,module,exports){"use strict";"user strict";exports.createContextGetter=require("./getter");exports.resolveContext=require("./resolve")},{"./getter":87,"./resolve":90}],89:[function(require,module,exports){"use strict";exports.cParent=function(){var level=this._cLevel;var parent;if(level){var context=this.__c;if(level===1){return context}parent=this._parent;if(parent&&!parent.__c!==context){parent.__c=context;parent._cLevel=level-1}}else{parent=this._parent;if(parent&&parent.__c){parent.clearContext()}}return parent};exports.parent={get:function get(){return this.cParent()}}},{}],90:[function(require,module,exports){"use strict";module.exports=function(val,stamp,context,target,path){var i=this._cLevel;var level=i;if(!context){context=this.__c}if(!target){target=this}var iterator=target;if(!path){path=createPath(path,iterator,i)}if(context.__c){var cpath=createPath(false,context,context._cLevel);context=context.resolveContext(val,stamp,context.__c,target,cpath.concat(path));return context}var len=path.length;var end=len-1;for(i=0;i<len;i++){if(context){var segment=path[i];var key=segment;var prop=context[key];var set=void 0;if(i===end){set=val}else{set={}}context=context.setKeyInternal(key,set,false,true,prop)||context[key]}}this.clearContextUp(level);return context};function createPath(path,iterator,i){path=path||[];while(i){var key=iterator.key;path.unshift(key);iterator=iterator._parent;i--}return path}},{}],91:[function(require,module,exports){"use strict";exports.clearContext=function(){if(this.__c){this._cLevel=null;this.__c=null}return this};exports.clearContextUp=function(level){var parent=this;var i=0;while(parent&&i<level){i++;parent.clearContext();parent=parent._parent}return this};exports.contextCandidate=function(target){if(!target.noContext&&target._parent===this){return target}};exports.storeContext=function(){var context=this.__c;if(context){var arr=[];var level=this._cLevel;while(context){arr.push(context,level);level=context._cLevel;context=context.__c}return arr}};exports.applyContext=function(store){if(store){var l=store.length;var ret=void 0;for(var i=0,target=this;i<l;i=i+2){var context=store[i];var level=store[i+1];var path=[target];var newTarget=setContext(target,context,level,path);var base=handleChange(target,context,path,level);if(ret===void 0&&base!==void 0){ret=base}if(newTarget){target=newTarget}}return ret}};function handleChange(target,context,path,level){var newContext,newLevel;var travelTaget=context;if(context.val===null){return null}for(var i=0,len=path.length;i<len;i++){var segment=path[i];var field=travelTaget[segment.key];if(!field||field.val===null){removeContext(target,level);return null}else if(field!==segment){segment.__c=null;segment._cLevel=null;newContext=field;newLevel=len-(i+1)}travelTaget=field;if(i===len-1){target=travelTaget}}if(newContext){if(!newLevel){removeContext(target,level)}else{setContext(target,newContext,newLevel)}return target}}function setContext(target,context,level,path){if(level){target._cLevel=level;target.__c=context;if(level>1){var p=target._parent;for(var i=1;p&&i<level;i++){if(path){path.unshift(p)}p.__c=context;p._cLevel=target._cLevel-i;p=p._parent}}return context}}function removeContext(target,level){if(level){target._cLevel=null;target.__c=null;if(level>1){var p=target._parent;for(var i=1;p&&i<level;i++){p.__c=null;p._cLevel=null;p=p._parent}}}}},{}],92:[function(require,module,exports){"use strict";var define=require("vigour-util/define");var Base=module.exports=function(val,stamp,parent,key){this._Constructor=null;this._ownKeys=null;if(this.instances===false){this.instances=null}else{this.instances=null;this.addToInstances(stamp)}this.setParent(val,stamp,parent,key);if(val!==void 0){this.set(val,stamp,true,true)}};var base=Base.prototype;define.call(base,{define:define,isBase:true},require("./constructor"),require("./set"),require("./set/value"),require("./set/property"),require("./set/property/move"),require("./set/property/add"),require("./set/property/internal"),require("./remove"),require("./context"),require("./context/util"),require("./context/parent"),require("./inject"),require("./compute"),require("./set/property/definition"));base.inject(require("./instances"),require("./method/each"),require("./method/toString"),require("./method/get"),require("./method/lookUp"),require("./method/serialize"),require("./method/path"),require("./method/root"),require("./uid"),require("./types"),require("./keys"));base.types={base:base}},{"./compute":85,"./constructor":86,"./context":88,"./context/parent":89,"./context/util":91,"./inject":94,"./instances":95,"./keys":98,"./method/each":108,"./method/get":109,"./method/lookUp":110,"./method/path":111,"./method/root":112,"./method/serialize":113,"./method/toString":115,"./remove":117,"./set":118,
"./set/property":132,"./set/property/add":119,"./set/property/definition":124,"./set/property/internal":133,"./set/property/move":134,"./set/value":135,"./types":136,"./uid":137,"vigour-util/define":283}],93:[function(require,module,exports){"use strict";function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var Base=require("../");var descriptors=require("vigour-util/descriptors");module.exports=function(target,val,stamp,excludes){target.getConstructor();var properties=val.properties;var keyMap=properties.keyMap;var myProperties=target.properties;var definitions=descriptors(val);var mydefs=descriptors(target);var newProps;var resolveKeyMap;for(var i in properties){if(properties[i]!==myProperties[i]&&i!=="keyMap"){if(!newProps){newProps={}}newProps[i]={val:properties[i].base||properties[i]}}}if(newProps){if(keyMap){resolveKeyMap={};for(var _i in keyMap){if(newProps[_i]){resolveKeyMap[keyMap[_i]]=_i;if(newProps[_i].val.isBase){newProps[_i]={val:newProps[_i],key:keyMap[_i]}}else{newProps[_i]={key:keyMap[_i],val:true}}}}}target.set({properties:{define:newProps}},false)}for(var _i2 in val){var j=_i2;if(resolveKeyMap&&resolveKeyMap[_i2]){j=resolveKeyMap[_i2]}if(definitions[_i2]){delete definitions[_i2]}if((_i2[0]!=="_"||properties[_i2])&&target[_i2]!==val[_i2]&&(!excludes||excludes.indexOf(_i2)===-1)){if(target[_i2]){if(target[_i2]instanceof Base){target[_i2].inject(val[_i2],stamp)}else{target[_i2]=val[_i2]}}else{var set=val[_i2];if(set instanceof Base){set=new set.Constructor({noReference:true},stamp,target);target.set(_defineProperty({},j,set),stamp)}else{if(myProperties[j]||properties[j]){target.set(_defineProperty({},j,set),stamp)}}}}}for(var _i3 in definitions){if(_i3!=="_injected"){if(!compareDescriptors(definitions[_i3],mydefs[_i3])){Object.defineProperty(target,_i3,definitions[_i3])}}}};function compareDescriptors(a,b){if(a&&!b){return false}for(var i in a){if(a[i]!==b[i]){return false}}return true}},{"../":92,"vigour-util/descriptors":284}],94:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var isObj=require("vigour-util/is/obj");var define=Object.defineProperty;var injectBase=require("./base");exports.inject=function(){var length=arguments.length;var stamptarget=arguments[length-1];var stamp;var type=!stamptarget||(typeof stamptarget==="undefined"?"undefined":_typeof(stamptarget));if(type!=="function"&&type!=="object"){stamp=arguments[length-1];length=length-1}for(var i=0;i<length;i++){inject.call(this,arguments[i],stamp)}return this};function inject(val,stamp){var isFn;isFn=typeof val==="function";if(isFn&&val.prototype&&val.prototype.isBase){val=val.prototype;isFn=null}var injected=val._injected;if(!val.hasOwnProperty("_injected")){define(val,"_injected",{configurable:true,value:[]});injected=val._injected}else{for(var i=0,length=injected.length;i<length;i++){var target=injected[i];if(this===target||target.hasOwnProperty("_Constructor")&&target._Constructor&&this instanceof target._Constructor){return}}}injected.push(this);if(isFn){val(this,stamp)}else if(isObj(val)){if(this.isBase){this.set(val,stamp)}}else if(val.isBase){injectBase(this,val,stamp)}}},{"./base":93,"vigour-util/is/obj":291}],95:[function(require,module,exports){"use strict";exports.properties={instances:true};exports.instances=false;exports.define={addToInstances:function addToInstances(){var from=Object.getPrototypeOf(this);if(!from.instances){from.instances=[]}from.instances.push(this)},removeFromInstances:function removeFromInstances(){var from=Object.getPrototypeOf(this);var instances=from.instances;if(instances){var length=instances.length;for(var i=0;i<length;i++){if(instances[i]===this){instances.splice(i,1);break}}}instances=this.instances;if(instances){var _length=instances.length;for(var _i=0;_i<_length;_i++){instances[_i].remove(false);_i--;_length--}}}}},{}],96:[function(require,module,exports){"use strict";var addFilters=require("./filters").add;var sortAdd=require("./sort/add");var instances=require("./instances");module.exports=function(key,target){var sort,copy,sIndex;if("sort"in this){sort=this.sort}var keys=this._keys;if(!this._ownKeys){copy=true;if(keys){this._keys=keys.concat([key]);if(sort){this._keys._=keys._.concat()}keys=this._keys}else{keys=this._keys=[key]}this._filters=false;this._ownKeys=true}else{if(!keys){keys=this._keys=[key]}else{keys.push(key)}}if(sort){sIndex=sortAdd(this,target,keys,sort)}if(this._filters){addFilters(this,key,copy,sIndex)}instances(this,target,this.addKey,keys,key)}},{"./filters":97,"./instances":99,"./sort/add":103}],97:[function(require,module,exports){"use strict";var sortAdd=require("./sort/filters").add;exports.create=function(target){if(!target._filters){target._filters={}}};exports.types=function(target,key,type){target=target[key];return"keyType"in target&&target.keyType===type};exports.add=function addFilter(target,key,copy,sort,type){var filters=target._filters;var start=!type;if(copy){target._filters=filters=copyFilters(filters)}if(start){type=target[key].keyType}var filtered=type&&filters[type];if(filtered){if(sort!==void 0){sortAdd(target,key,filtered,sort,type)}else{filtered.push(key)}}if(start&&keysFilter(target,key)){addFilter(target,key,copy,sort,"keys")}};exports.remove=function removeFilter(target,key,copy,type){var filters=target._filters;if(copy){target._filters=filters=copyFilters(filters)}var start=!type;if(start){type=target[key].keyType}var filtered=type&&filters[type];if(filtered){if(filtered.length===1){filters[type]=[]}else{for(var i=0,len=filtered.length;i<len;i++){if(filtered[i]===key){filtered.splice(i,1);break}}}}if(start&&keysFilter(target,key)){removeFilter(target,key,copy,"keys")}};exports.copy=copyFilters;function keysFilter(target,key){return"filter"in target&&target.filter(key)}function copyFilters(filters){var newFilters={};for(var type in filters){newFilters[type]=filters[type].concat()}return newFilters}},{"./sort/filters":104}],98:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var filterTypes=require("./filters").types;var keys=require("./method");var _sort=require("./sort");var addKey=require("./add");var remove=require("./remove");var removeKey=remove.key;var removeAllKeys=remove.all;var resolveKeys=require("./resolve");exports.properties={keyType:true,sortMethod:true,sort:function sort(val,stamp){var needsUpdate;if(val&&(typeof val==="undefined"?"undefined":_typeof(val))==="object"){if(val.exec){needsUpdate=true;this.sortMethod=val.exec}val=val.val||this.sort}if(val!==this.sort||needsUpdate){this.sort=val;var _keys=this._keys;if(_keys){if(val===null){delete _keys._}else{this._keys._=[];_sort(this,_keys,val)}}return true}}};exports.sortMethod=function sort(a,b){return a<b?-1:a>b?1:0};exports.define={_keys:{val:false,writable:true},_ownKeys:{val:true,writable:true},filterTypes:filterTypes,keys:keys,addKey:addKey,removeKey:removeKey,removeAllKeys:removeAllKeys,resolveKeys:resolveKeys}},{"./add":96,"./filters":97,"./method":100,"./remove":101,"./resolve":102,"./sort":105}],99:[function(require,module,exports){"use strict";module.exports=function eachInstance(parent,target,method,keys,key){var instances=parent.instances;if(instances){for(var i=0,len=instances.length;i<len;i++){var instance=instances[i];if(instance._keys!==keys&&instance[key]===target){method.call(instance,key,target)}}}}},{}],100:[function(require,module,exports){"use strict";var createFilters=require("./filters").create;var empty=[];module.exports=function(type){var keys=this._keys;if(!keys){return empty}else{if(type){createFilters(this,type);var filters=this._filters;if(!(type in filters)){var filter=this.filterTypes;var filtered=filters[type]=[];for(var i=0,len=keys.length;i<len;i++){if(filter(this,keys[i],type)){filtered.push(keys[i])}}return filtered}else{return filters[type]}}else if(this.filter){createFilters(this,"keys");var _filters=this._filters;if("keys"in _filters){return _filters.keys||empty}else{var _filtered=_filters.keys=[];for(var _i=0,_len=keys.length;_i<_len;_i++){if(this.filter(keys[_i])){_filtered.push(keys[_i])}}return _filtered}}else{return keys}}}},{"./filters":97}],101:[function(require,module,exports){"use strict";var removeFilters=require("./filters").remove;var instances=require("./instances");exports.all=function(){if(!this._ownKeys){this._ownKeys=true}this._filters=false;this._keys=false};exports.key=function(key,target){var keys=this._keys;if(!this._ownKeys){if(!keys){keys=this._keys=false;this._filters=false}else{var len=this._keys.length;if(len>1){if("sort"in this&&this.sort){this._keys=keys.concat();this._keys._=keys._.concat();keys=this._keys}else{keys=this._keys=this._keys.concat()}for(var i=0;i<len;i++){if(keys[i]===key){keys.splice(i,1);if("_"in keys){keys._.splice(i,1)}break}}if(this._filters){removeFilters(this,key,true)}else{this._filters=false}}else{this._keys=false;this._filters=false}}this._ownKeys=true}else if(keys){var _len=keys.length;if(_len>1){for(var _i=0;_i<_len;_i++){if(keys[_i]===key){keys.splice(_i,1);if("_"in keys){keys._.splice(_i,1)}break}}if(this._filters){removeFilters(this,key)}}else{this._filters=false;this._keys=false}}instances(this,target,this.removeKey,keys,key)}},{"./filters":97,"./instances":99}],102:[function(require,module,exports){"use strict";var copyFilters=require("./filters").copy;module.exports=function(){if(!this._ownKeys){this._ownKeys=true;if(!this._keys){this._keys=false;this._filters=false}else{this._keys=this._keys.concat();if(this._filters){this._filters=copyFilters(this._filters)}else{this._filters=false}}}}},{"./filters":97}],103:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};module.exports=function(parent,target,keys,field){var len=keys.length;var order=field in target&&target[field];if(!order){var origin=target.origin();order=field in origin&&origin[field]}if(order){if((typeof order==="undefined"?"undefined":_typeof(order))==="object"&&"isBase"in order){order=order.compute()}}else{order=0}var orders=keys._||(keys._=[]);if(len>1){var sortMethod=parent.sortMethod;for(var i=len-2;i>-1;i--){if(sortMethod(order,orders[i])>-1){orders.push(order);return len-1}else if(sortMethod(order,orders[i])<0){if(i===0){keys.unshift(keys.pop());orders.unshift(order);return i}else if(sortMethod(order,orders[i-1])>-1){keys.splice(i,0,keys.pop());orders.splice(i,0,order);return i}}}}orders.push(order);return 0}},{}],104:[function(require,module,exports){"use strict";var quickSort=require("./quick");exports.add=add;exports.sort=function sort(target,keys){var filters=target._filters;for(var type in filters){var filtered=filters[type];quickSort(target,filtered,0,filtered.length-1,target.sort,[])}};exports.update=function sort(target,keys,oldIndex,newIndex,key){var filters=target._filters;for(var type in filters){var pass=type==="keys"?target.filter(key):target[key].keyType===type;if(pass){var filtered=filters[type];var i=oldIndex;var found=void 0;while(found===void 0&&i>-1){if(filtered[i]===key){found=i}else{i--}}filtered.splice(found,1);add(target,key,filtered,newIndex,type)}}};function add(target,key,filtered,index,type){var len=filtered.length;if(len>0){var keys=target._keys;if(index===0){filtered.unshift(key)}else if(len===keys.length-1){filtered.splice(index,0,key)}else{var left=-1;var i=index-1;if(type==="keys"){while(left===-1&&i>-1){if(target.filter(keys[i])){left=keys[i]}i--}}else{while(left===-1&&i>-1){if(target[keys[i]].keyType===type){left=keys[i]}i--}}if(left===-1){filtered.unshift(key)}else{i=index-1;var found=void 0;while(i>-1&&found===void 0){if(filtered[i]===left){found=i}else{i--}}filtered.splice(found+1,0,key)}}}else{filtered.push(key)}}},{"./quick":107}],105:[function(require,module,exports){"use strict";var quickSort=require("./quick");var order=require("./order").compute;var filters=require("./filters").sort;module.exports=exports=function sort(target,keys,field){var orders=keys._=[];var len=keys.length-1;if(len<1){if(len===0){orders[0]=order(target[keys[0]],field)}}else{quickSort(target,keys,0,len,field,orders)}if(keys===target._keys){filters(target,keys);var instances=target.instances;if(instances){for(var i=0,_len=instances.length;i<_len;i++){var instance=instances[i];if(instance._keys!==keys){sort(instance,instance._keys,field)}}}}}},{"./filters":104,"./order":106,"./quick":107}],106:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};exports.compute=function compute(target,field){var order=field in target&&target[field];if(!order){var origin=target.origin();order=field in origin&&origin[field]}if(order){if((typeof order==="undefined"?"undefined":_typeof(order))==="object"&&"isBase"in order){order=order.compute()}}else{order=0}return order};exports.apply=function apply(i,target,keys,field,orders){return orders[i]===void 0?orders[i]=exports.compute(target[keys[i]],field):orders[i]}},{}],107:[function(require,module,exports){"use strict";var order=require("./order").apply;module.exports=function quickSort(target,keys,left,right,field,orders){if(left<right){var pivot=right;var index=partition(target,keys,pivot,left,right,field,orders);quickSort(target,keys,left,index-1,field,orders);quickSort(target,keys,index+1,right,field,orders)}return keys};function partition(target,keys,pivot,left,right,field,orders){var val=order(pivot,target,keys,field,orders);var sortMethod=target.sortMethod;var index=left;for(var i=left;i<right;i++){if(sortMethod(order(i,target,keys,field,orders),val)<1){swap(keys,i,index);swap(orders,i,index);index++}}swap(keys,right,index);swap(orders,right,index);return index}function swap(keys,i,j){var temp=keys[i];keys[i]=keys[j];keys[j]=temp}},{"./order":106}],108:[function(require,module,exports){"use strict";exports.define={each:function each(fn,attach,type){var keys=this.keys(type);for(var i=0,len=keys.length;i<len;i++){var key=keys[i];var ret=fn(this[key],key,this,attach);if(ret){return ret}}}}},{}],109:[function(require,module,exports){"use strict";var helpers=require("./shared");var getPath=helpers.getPath;var returnPath=helpers.returnPath;exports.define={get:function get(path,set,stamp){path=returnPath(path);var result=getPath(this,path,path.length,void 0,set,stamp||false);if(result){return result}}}},{"./shared":114}],110:[function(require,module,exports){"use strict";var helpers=require("./shared");var getPath=helpers.getPath;var returnFilter=helpers.returnFilter;var returnPath=helpers.returnPath;exports.define={lookUp:function lookUp(path,options){var parent=this.parent;var filter;if(parent){filter=returnFilter(options);path=returnPath(path);return lookUpParent(parent,path,path.length,filter)}}};function lookUpParent(parent,path,length,filter){var oneKey=path.length===1;return oneKey&&parent.key===path[0]&&parent||getPath(parent,path,length,filter)||(parent=parent.parent)&&lookUpParent(parent,path,length,filter)}},{"./shared":114}],111:[function(require,module,exports){"use strict";exports.define={path:function path(){var path=[];var parent=this;while(parent&&(parent.key||parent.__c)&&!parent.rootoverride){path.unshift(parent.key);var level=parent._cLevel;if(level===1){parent=parent.__c}else{if(level&&parent._parent.__c!==parent.__c){parent._parent.__c=parent.__c;parent._parent._cLevel=level-1}parent=parent._parent}}return path},realPath:function realPath(limit,memoize){if(memoize&&this._memoizedPath){return this._memoizedPath}else{var path=[];var parent=this;while(parent&&parent.key!==void 0&&parent!==limit&&!parent.rootOverride){path.unshift(parent.key);parent=parent._parent}if(memoize){this._memoizedPath=path}return path}}}},{}],112:[function(require,module,exports){"use strict";exports.define={getRoot:function getRoot(noOverride){var parent=this;var next=parent.parent;while(next&&(!next.rootOverride||noOverride)){parent=next;next=parent.parent}return parent},root:{get:function get(){return this.getRoot()}}}},{}],113:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var ref="$root";exports.define={serialize:function serialize(compute,filter){var obj={};var val=this.val;this.each(function(property,key,base){if(!filter||filter(property,key)){obj[key]=property.serialize?property.serialize(compute,filter):property}});if(val!==void 0){if(compute){val=this.compute()}else if(val&&(typeof val==="undefined"?"undefined":_typeof(val))==="object"&&val.isBase){var path=val.realPath();path.unshift(ref);val=path.join(".")}if(this.keys().length===0){obj=val}else{obj.val=val}}return obj}}},{}],114:[function(require,module,exports){"use strict";var isObj=require("vigour-util/is/obj");exports.returnFilter=function(options){if(options!==void 0){if(typeof options==="function"){return options}if(options instanceof RegExp){return function(subject){return options.test(subject.compute())}}else if(isObj(options)){if(options.constructor===Array){var length=options.length;return function(subject){for(var i=length-1;i>=0;i--){var value=options[i];if(subject===value||subject.val===value){return true}}}}}else{return function(subject){return subject===options||subject.val===options}}}};exports.returnPath=function(path){if(typeof path==="string"){if(/[^\.]\[\-?\d*?\]/.test(path)){path=path.replace(/(\[\-?\d*?\])/g,".$1");if(path[0]==="."){path=path.slice(1)}}return path.split(".")}else{return path}};function getPath(obj,path,length,filter,set,stamp){var i=0;var result;var prev=obj;if(path[0]&&path[0][0]==="["){result=exports.getKey(obj,path[0].slice(1,-1))}else{result=path[0]in obj&&obj[path[0]]}while(result){if(typeof result==="function"&&path[i]!=="Constructor"){result=result.call(prev)}prev=result;if(++i===length){if(filter===void 0||filter(result,obj)){return result}}obj=result;if(path[i]&&path[i][0]==="["){result=exports.getKey(result,path[i].slice(1,-1))}else{result=result[path[i]]}}if(set!==void 0){return createPath(obj,path.splice(i),length-i,set,stamp)}}function createPath(obj,path,length,set,stamp){var setObj={};var nextObj=setObj;var i=0;var field;for(;i<length-1;i++){field=path[i];nextObj[field]={};nextObj=nextObj[field]}if(set!==void 0){if(path[i]&&path[i][0]==="["){keyError(obj,path[i].slice(1,-1))}nextObj[path[i]]=set}obj=obj.set(setObj,stamp)||obj;return getPath(obj,path,length)}exports.createPath=createPath;exports.getPath=getPath;exports.getKey=function(target,key){var keys=target.keys();var ret;key=Number(key);if(key>-1){if(keys[key]!==void 0){ret=target[keys[key]]}}else{var calc=keys.length+key;if(keys[calc]!==void 0){ret=target[keys[calc]]}}if(!ret){keyError(target,key)}else{return ret}};function keyError(target,key){console.log('key notation - cant find key "['+key+']" in "'+target.path().join(".")+'"')}},{"vigour-util/is/obj":291}],115:[function(require,module,exports){"use strict";exports.define={inspect:function inspect(){var type=this.type;if(typeof type!=="string"){type=this.key||"customBase"}type=type[0].toUpperCase()+type.slice(1);return type+" "+(this.key?this.key+" ":"")+JSON.stringify(this.serialize(),false,2)},toString:function toString(filter){return JSON.stringify(this.serialize(false,filter),false,2)}}},{}],116:[function(require,module,exports){"use strict";var returnPath=require("./method/shared").returnPath;module.exports=function reference(obs,val,stamp){var rootObj=obs.getRoot();var ownPath=obs.realPath(false,true);var target=rootObj;var useParent;if(val[1]==="."){val=returnPath(val);var path=obs.realPath();for(var i=1,len=val.length;i<len;i++){path.push(val[i])}val=path}else{val=returnPath(val);val.shift()}for(var _i in val){if(val[_i]==="parent"||val[_i]==="_parent"){val.splice(_i-1,2)}}for(var _i2=0,length=val.length;_i2<length;_i2++){var segment=val[_i2];if(!target.get(segment)||useParent){if(ownPath[_i2]===val[_i2]&&isParent(ownPath,val,_i2,target)){useParent=true}else{val=val.slice(_i2);if(useParent){var l=ownPath.length-1-_i2;var p=obs;while(l>-1){p=p._cLevel===1?p.__c:p._parent;l--}return p.get(val,{},stamp)}else{return target.get(val,{},stamp)}}}else{target=target.get(segment)}}return target};function isParent(arr,val,len,target){for(var i=0;i<len;i++){if(arr[i]!=val[i]){return}}return true}},{"./method/shared":114}],117:[function(require,module,exports){"use strict";var Base=require("./");var vstamp=require("vigour-stamp");exports.removeUpdateParent=function(parent,stamp,context){if(context){if(this.__c){this.resolveContext(null,stamp,context)}}else{parent.removeKey(this.key,this);parent[this.key]=null}};exports.removeProperty=function(property,key,stamp,noContext,noParent){if(property instanceof Base&&key!=="__c"&&this.hasOwnProperty(key)&&property._parent===this){property.clearContext();property.remove(stamp,noContext,noParent)}this[key]=null};exports.removeProperties=function(stamp,noContext){if(this._keys){for(var i=0,len=this._keys.length;i<len;i++){var key=this._keys[i];var _key="_"+key;if(!(_key in this)||this.hasOwnProperty(_key)){this.removeProperty(this[key],key,stamp,noContext,true)}}this.removeAllKeys()}};exports.removeInternal=function(stamp,noContext,noParent){var parent=this._parent;if(!noParent&&!noContext&&this.__c){return this.removeUpdateParent(this.parent,stamp,this.__c)}else{if(!noParent&&parent){this.removeUpdateParent(parent,stamp)}this.removeProperties(stamp,noContext,noParent);this._parent=null;this.val=null}this.clearContext()};exports.remove=function(stamp,noContext,noParent){var ret=this.removeInternal(stamp,noContext,noParent);this.removeFromInstances(stamp);return ret||this};exports.reset=function(stamp){this.val=void 0;var trigger;if(stamp===void 0){trigger=true;stamp=vstamp.create()}this.removeProperties(stamp);if(trigger){vstamp.close(stamp)}};exports.contextRemove=function(key,event){this.removeKey(key,this[key]);this[key]=null;return this}},{"./":92,"vigour-stamp":260}],118:[function(require,module,exports){"use strict";var isObj=require("vigour-util/is/obj");exports.set=function(val,stamp,nocontext){var base=this;var resolve=!nocontext&&base.__c;if(isObj(val)){if(resolve){base=base.resolveContext(val,stamp)}else{var changed=void 0;for(var key in val){if(base.setKey(key,val[key],stamp,resolve,nocontext)){changed=true}}if(!changed){return}}}else{base=base.setValue(val,stamp,resolve)}return base}},{"vigour-util/is/obj":291}],119:[function(require,module,exports){"use strict";exports.addNewProperty=function(key,val,stamp){if(val.val!==null){this[key]=val;this.addKey(key,val);if(this._Constructor){this.createContextGetter(key)}}}},{}],120:[function(require,module,exports){"use strict";module.exports=function baseProperty(base,key){var Constructor;base.noReference=true;function baseProperty(val,stamp,resolve,nocontext){var property=key in this&&this[key];if(!property){if(!Constructor){Constructor=base.Constructor}if(!(val&&val.noReference&&(!val._parent||val._parent===this))){val=new Constructor(val,stamp,this,key)}}return this.setKeyInternal(key,val,stamp,nocontext,property)}baseProperty.base=base;return baseProperty}},{}],121:[function(require,module,exports){"use strict";var removeFromKeyMap=require("./keymap").remove;module.exports=function clearProperty(target,key,props,stamp,realKey){var instance=target[key];removeFromKeyMap(props,realKey);if(instance){if(instance.remove){instance.remove(stamp)}}if(key==="val"){delete target[key]}else{target[key]=null}}},{"./keymap":126}],122:[function(require,module,exports){"use strict";exports.property=function(val,stamp,resolve,nocontext,key){if(this[key]!==val){this[key]=val;return this}};exports.map=function mapDefaultProperty(key,realKey){return!realKey&&realKey!==0?exports.property:function mapProperty(val,stamp,resolve,nocontext){if(this[key]!==val){this[key]=val;return this}}}},{}],123:[function(require,module,exports){"use strict";var property=require("./property");var keymap=require("./keymap");var move=require("./move");var removeFromKeyMap=keymap.remove;var addToKeyMap=keymap.add;var mapDefaultProperty=require("./default").map;var baseProperty=require("./base");module.exports=function define(target,val,props,stamp){for(var key in val){defineProperty(target,key,val[key],props,stamp)}};function defineProperty(target,key,val,props,stamp){var prop=key in props&&props[key];var mapKey=val.key;var keyIsNull=mapKey===null;var hasVal="val"in val;var reset="reset"in val?val.reset:void 0;var targetKey=mapKey&&mapKey!==0?mapKey:key;if(mapKey){move(target,key,props,stamp,prop,mapKey,reset);addToKeyMap(props,key,mapKey)}if(hasVal){props[key]=property(target,targetKey,val.val,props,stamp,prop,key,reset)||null}else if(prop){if(mapKey||keyIsNull){if(prop.base){prop=props[key]=baseProperty(prop.base,targetKey)}else{prop=props[key]=mapDefaultProperty(targetKey,targetKey!==key&&key)}}if(keyIsNull){move(target,key,props,stamp,prop,key,reset);removeFromKeyMap(props,key)}}}},{"./base":120,"./default":122,"./keymap":126,"./move":127,"./property":130}],124:[function(require,module,exports){"use strict";var property=require("./property");var define=require("./define");var properties=require("./properties");properties.properties=function(val,stamp){var props=this.properties;if(!this.hasOwnProperty("properties")){var Properties=function Properties(){};Properties.prototype=props;props=new Properties(this);this.define({properties:{val:props}})}for(var key in val){var definition=val[key];if(key==="define"){define(this,definition,props,stamp)}else{var prop=key in props&&props[key];props[key]=property(this,key,definition,props,stamp,prop)||null}}this._mapProperty=null;this._mapTarget=this};exports.properties={val:properties}},{"./define":123,"./properties":129,"./property":130}],125:[function(require,module,exports){"use strict";var cnt=0;function optimisePropertyMap(target,key){var checks="";for(var prop in target.properties){if(target.properties[prop]&&prop!=="keyMap"){checks+="\n  key === '"+prop+"' ||"}}checks=checks.slice(0,-2);var str="if("+checks+"\n) { return key }";return target._mapProperty=Function("key",str)}module.exports=function isProperty(key){var map="_mapProperty"in this&&this._mapProperty;if(!map){if(cnt>500){map=optimisePropertyMap(this._mapTarget);this._mapTarget._mapTarget=null;return map(key)}else{cnt++;if(key in this.properties&&this.properties[key]){return key}}}else{return map(key)}}},{}],126:[function(require,module,exports){"use strict";var isEmpty=require("vigour-util/is/empty");exports.remove=function(props,key){if(exports.isMapped(props,key)){inherit(props);delete props.keyMap[key];if(isEmpty(props.keyMap)){props.keyMap=null}}};exports.add=function(props,key,mapKey){if(!("keyMap"in props&&props.keyMap)){props.keyMap={}}else{inherit(props)}props.keyMap[key]=mapKey};exports.isMapped=function(props,key){return key&&"keyMap"in props&&props.keyMap&&key in props.keyMap};function inherit(props){if(!props.hasOwnProperty("keyMap")){var prev=props.keyMap;props.keyMap={};for(var key in prev){props.keyMap[key]=prev[key]}}}},{"vigour-util/is/empty":287}],127:[function(require,module,exports){"use strict";var isMapped=require("./keymap").isMapped;module.exports=function moveKey(target,key,props,stamp,prop,move,reset){if(prop&&reset!==false){var current=isMapped(props,key)?props.keyMap[key]:key;if(current!==move){if("base"in props[key]){props[key].base.key=move}target.move(current,move,stamp)}}}},{"./keymap":126}],128:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var isObj=require("vigour-util/is/obj");module.exports=function(val,stamp){if(isObj(val)){val=this.getType(val,stamp)}var type=typeof val==="undefined"?"undefined":_typeof(val);if(type==="string"){val=this[val]}else if(val&&type!=="function"&&val.Constructor){val=val.Constructor}else if(type==="object"){if(this.hasOwnProperty("child")){this.child.prototype.set(val,false);return}val=new this.child(val,stamp,this).Constructor}this.define({child:val})}},{"vigour-util/is/obj":291}],129:[function(require,module,exports){"use strict";var defaultProperty=require("../default").property;exports.child=require("./child");exports.rootOverride=defaultProperty;exports.noReference=defaultProperty;exports.noContext=defaultProperty;exports.Constructor=defaultProperty;exports.key=defaultProperty;exports.inject=function(val,stamp){if(val instanceof Array){if(stamp!==void 0){val=val.concat([stamp])}this.inject.apply(this,val)}else{this.inject(val,stamp)}};exports.origin=function(val,stamp){this.origin().set(val,stamp)};exports.reset=function(val,stamp){if(val===true){return this.reset(stamp)}};exports.define=function(val){if(val instanceof Array){this.define.apply(this,val)}else{this.define(val)}};exports.val=function(val,stamp,resolve,nocontext){return this.setValue(val,stamp,resolve)}},{"../default":122,"./child":128}],130:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var clear=require("./clear");var mapDefaultProperty=require("./default").map;var baseProperty=require("./base");var set=require("./set");function property(target,key,val,props,stamp,prop,realKey,reset){var isObj=val&&(typeof val==="undefined"?"undefined":_typeof(val))==="object";var isBase=isObj&&"isBase"in val;var isFn=!isObj&&typeof val==="function";var isSet=!reset&&!isBase&&!isFn&&val!==true&&val!==null;var hasType=isObj&&!isBase&&"type"in val;if(prop){if(reset!==false&&(!isSet||!("base"in prop)||hasType&&val.type!==prop.base.type)){clear(target,key,props,stamp,prop,realKey)}else if(isSet){return set(target,key,val,props,stamp,realKey,reset)}}if(val===true){return mapDefaultProperty(key,realKey)}else if(isFn||val===null){return val}if(isBase){if(val._Constructor){val=new val._Constructor(void 0,stamp,target,key)}}else{var type=hasType&&target.getType(val,stamp,key);var Constructor=type&&type.Constructor||target.child;val=new Constructor(val,stamp,target,key)}return baseProperty(val,key)}module.exports=property},{"./base":120,"./clear":121,"./default":122,"./set":131}],131:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var injectBase=require("../../../inject/base");var baseProperty=require("./base");var keymap=require("./keymap");var isMapped=keymap.isMapped;var removeFromKeyMap=keymap.remove;var move=require("./move");module.exports=function set(target,key,val,props,stamp,realKey,reset){var prop=props[realKey===0||realKey?realKey:key];if(prop.base._parent!==target&&reset!==false){var OldConstructor=prop.base._Constructor;var instance=key in target&&target[key];prop=baseProperty(new prop.base.Constructor(val,stamp,target,key),key);if(OldConstructor&&key in target&&instance instanceof OldConstructor){target.setKeyInternal(key,new prop.base.Constructor(val,stamp),false);
var excludes=(typeof val==="undefined"?"undefined":_typeof(val))==="object"?Object.keys(val):["val"];for(var i=0,len=excludes.length;i<len;i++){if(instance.hasOwnProperty(excludes[i])){excludes.splice(i,1);len--;i--}}injectBase(target[key],instance,false,excludes)}}else{prop.base.set(val,stamp)}if(key===realKey&&isMapped(props,key)){prop=props[key]=baseProperty(prop.base,key);if(reset!==false){move(target,key,props,stamp,prop,key)}removeFromKeyMap(props,key)}return prop}},{"../../../inject/base":93,"./base":120,"./keymap":126,"./move":127}],132:[function(require,module,exports){"use strict";exports.isProperty=require("./definition/is");exports.setKey=function(key,val,stamp,resolve,nocontext){var prop=this.isProperty(key,val,stamp);if(prop){return this.properties[prop].call(this,val,stamp,resolve,nocontext,prop)}else{return this.setKeyInternal(key,val,stamp,nocontext,this[key])}}},{"./definition/is":125}],133:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};exports.setKeyInternal=function(key,val,stamp,nocontext,property){if(val&&(typeof val==="undefined"?"undefined":_typeof(val))==="object"){if(!val.isBase){if(val.type){val=this.getType(val,stamp,key,void 0);if(property){property.remove(false)}this.addNewProperty(key,val,stamp);return this}}else if(val.noReference&&(!val._parent||val._parent===this)){this.addNewProperty(key,val,stamp);val._parent=this;val.key=key;return this}}if(property){if(property._parent!==this){if(val===null){return this.contextRemove(key,stamp)}else{var Constructor=property.getConstructor&&property.getConstructor();if(!Constructor){var path=this.path().join(".");path=path.length?' "'+path+'"':"";throw new Error('cannot set property "'+key+'", on "'+this.type+'" '+path)}else{this[key]=new Constructor(void 0,false,this,key);this[key].set(val,stamp,nocontext);return this[key]}}}else{property.set(val,stamp,nocontext);return}}else if(val===null){this[key]=null;this.resolveKeys();return}else{this.addNewProperty(key,new this.child(val,stamp,this,key),stamp);return this}}},{}],134:[function(require,module,exports){"use strict";function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}exports.move=function(current,move,stamp){var instance=this[current];if(instance!==null&&instance!==void 0){if(this[current].isBase){this.removeKey(current);this[current]=null;instance._parent=null;var reset=void 0;if(!instance.noReference){reset=instance.hasOwnProperty("noReference");instance.noReference=true}this.set(_defineProperty({},move,instance),stamp,true);if(reset!==void 0){if(reset){instance.noReference=null}else{delete instance.noReference}}}else{this[move]=instance;this.removeKey(current);this[current]=null}}}},{}],135:[function(require,module,exports){"use strict";var reference=require("../reference");var isRef=/^\$(\.|root)/;exports.setValueInternal=function(val,stamp){this.val=val;return this};exports.setValue=function(val,stamp,resolve){if(typeof val==="string"&&val[0]==="$"){if(isRef.test(val)){val=reference(this,val,stamp)}}if(val===this.val){return}else if(val===null){var r=this.remove(stamp);return r||this}else if(resolve){return this.resolveContext(val,stamp)}else{return this.setValueInternal(val,stamp)}}},{"../reference":116}],136:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var merge=require("lodash.merge");var isObj=require("vigour-util/is/obj");function lookUpType(target,type,val,Constructor){var result;while(target){if(target.types&&target.types[type]){result=target.types[type];if(result&&(typeof result==="undefined"?"undefined":_typeof(result))!=="object"){result=target.types[type]={val:result}}if(isObj(result)){var inherits=result.type&&result.type!==type&&lookUpType(target,result.type||type,val,Constructor);if(inherits){result=target.types[type]=new inherits.Constructor(result,false,target)}else{var cache=target.types[type]="_typeCache"in result&&result._typeCache||new Constructor(result,false,target);Object.defineProperty(result,"_typeCache",{value:cache});result=cache}}return result}target=target._parent}}exports.define={getType:function getType(val,stamp,key,nocontext){var type=val.type;if(!type){return val}var result=lookUpType(this,type,val,this.childType||this.child);if(result){var r=new result.Constructor(val,stamp,this,key);if(!r.noReference){r.noReference=true}return r}else{console.log("cannot find type:",type)}return val}};exports.properties={type:true,types:function types(val,stamp){if(!this.hasOwnProperty("types")){var old=this.types;var n={};for(var key in old){n[key]=old[key]}this.types=n}if(val instanceof Array){for(var i=0,len=val.length;i<len;i++){setType.call(this,val[i],stamp)}}else{setType.call(this,val,stamp)}}};exports.type="base";function setType(val,stamp){var types=this.types;var noObj;for(var key in val){if(val[key].type){types[key]=val[key]}else if(!(key in types)||!types[key]){types[key]=val[key]}else if(isObj(types[key])||(noObj=_typeof(types[key])!=="object")){if(noObj){types[key]={val:types[key]}}merge(types[key],val[key])}else if("isBase"in types[key]){types[key].inject(val[key],stamp)}}}},{"lodash.merge":78,"vigour-util/is/obj":291}],137:[function(require,module,exports){"use strict";var _uid=0;exports.define={uid:function uid(){if(!this.hasOwnProperty("_uid")){_uid++;this._uid=_uid}return this._uid}}},{}],138:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var getParent=require("brisky-core/lib/render/dom/parent");exports.properties={class:{type:"group",storeContextKey:true,properties:{useKey:true},render:{static:function _static(target,node,store){var val=target.compute();if(val===true||target.useKey){var key=target.cParent().key;val=typeof val==="string"?val+" "+key:key}else if((typeof val==="undefined"?"undefined":_typeof(val))==="object"){val=""}setClassName(parseStore(val,store),node)},state:function state(target,_state,type,stamp,subs,tree,id,pid,store){var val=_state&&target.$?target.compute(_state):target.compute();if(val===true||target.useKey){var key=parseKey(target,id);val=typeof val==="string"?val+" "+key:key}else if((typeof val==="undefined"?"undefined":_typeof(val))==="object"){val=""}var node=getParent(type,stamp,subs,tree,pid);setClassName(target.keys().length?parseStore(val,store):val,node)}}}};function parseStore(val,store){for(var key in store){var fieldval=store[key];if(fieldval===true){fieldval=key}if(fieldval!==false){if(val){val+=" "+fieldval}else{val=fieldval}}}return val}function setClassName(val,node){if(val){node.className=val}else if("className"in node){node.removeAttribute("class")}}function parseKey(target,pid){if(pid[0]==="c"){for(var i=pid.length-1;i>=0;i--){if(pid[i]==="-"){return pid.slice(1,i)}}}else{return target.cParent().key}}},{"brisky-core/lib/render/dom/parent":150}],139:[function(require,module,exports){"use strict";var Observable=require("vigour-observable");var emitNoContext=require("vigour-observable/lib/emitter/emit/emit");var element=new Observable({type:"element",types:{property:require("./property")},properties:{tag:true,namespace:true},tag:"div",on:{child:{define:{emit:emit}}},noReference:true,instances:false,define:{isElement:true},child:"Constructor"},false);var emitters=element.emitters.properties;emitters.remove.base.define({emit:emit});emitters.data.base.define({emit:emit});element.types.element=element;element.inject(require("./subscribe"),require("./render/dom/element"),require("./keys"),require("./property/group"),require("./property/text"),require("./property/html"),require("./widget"));module.exports=element.Constructor;function emit(bind,data,stamp){emitNoContext(this,bind,data,stamp)}},{"./keys":140,"./property":143,"./property/group":141,"./property/html":142,"./property/text":144,"./render/dom/element":149,"./subscribe":156,"./widget":171,"vigour-observable":242,"vigour-observable/lib/emitter/emit/emit":230}],140:[function(require,module,exports){"use strict";var Observable=require("vigour-observable");var f=Observable.prototype.filterTypes;exports.define={filterTypes:function filterTypes(target,key,type){if(type==="staticElements"){return isStaticElement(target[key])}else if(type==="staticProps"){return isStaticProperty(target[key])}return f.call(this,target,key,type)},findIndex:function findIndex(parent){if(parent){if(!parent.$any){var key=this.key;if(key!==void 0&&key!==null){var keys=parent.keys();var len=keys.length;if(len>1){for(var i=0;i<len;i++){if(keys[i]===key){if(parent.tag==="fragment"){return(parent.findIndex(parent.cParent())||1)+((i+1)/(len+1)).toFixed(len+"".length)}else{return i+1}}}}}}if(parent.tag==="fragment"){return parent.findIndex(parent.cParent())}}}};function isStaticElement(target){return target&&target.isStatic&&target.isElement}function isStaticProperty(target){return target&&!target.isElement&&target.isStatic}},{"vigour-observable":242}],141:[function(require,module,exports){"use strict";var props=require("../render/static").property;var getParent=require("../render/dom/parent");var vstamp=require("vigour-stamp");exports.types={group:{type:"property",isGroup:true,properties:{render:function render(_render){this.define({groupRender:{val:_render}})}},define:{render:{val:{static:function _static(target,pnode){var store={};var parsed="_"+target.key+"StaticParsed";if(pnode){props(target,pnode,store);pnode[parsed]=true}target.groupRender.static(target,pnode,store)},state:function state(target,_state,type,stamp,subs,tree,id,pid){var storeId=pid+target.key;var store=tree._[storeId]||(tree._[storeId]={});var pnode=getParent(type,stamp,subs,tree,pid);var parsed="_"+target.key+"StaticParsed";if(pnode){if(!pnode[parsed]){props(target,pnode,store);pnode[parsed]=true}if(!("stamp"in store)){store.stamp=stamp;vstamp.on(stamp,function(){delete store.stamp;target.groupRender.state(target,_state,type,stamp,subs,tree,id,pid,store)})}}}}}},child:{define:{getStore:function getStore(tree,id){if(this.$!==true){var length=this.$.length;if(this.$switch||this.$any||this.$test){length=length-1}while(length){if(!/^\$pass|\$current/.test(tree._key)){length--}tree=tree._p}}var _=tree._||(tree._={});var store=_[id]||(_[id]={});return store}},render:{static:function _static(target,node,store){store[target.key]=target.compute()},state:function state(target,_state2,type,stamp,subs,tree,id,pid){var store=target.getStore(tree,pid+target.cParent().key);if(_state2.val===null){if(target.key in store){delete store[target.key]}}else{store[target.key]=target.compute(_state2)}}}}}}},{"../render/dom/parent":150,"../render/static":155,"vigour-stamp":260}],142:[function(require,module,exports){"use strict";var getParent=require("../render/dom/parent");exports.properties={html:{type:"property",render:{static:function _static(target,node){node.innerHTML=target.compute()},state:function state(target,_state,type,stamp,subs,tree,id,pid){var node=getParent(type,stamp,subs,tree,pid);if(type==="remove"){var val=target.compute();node.innerHTML=val!==target?val:""}else{node.innerHTML=target.compute(_state)}}}}}},{"../render/dom/parent":150}],143:[function(require,module,exports){"use strict";var Observable=require("vigour-observable");module.exports=new Observable({type:"property",inject:[require("../keys"),require("../subscribe")],properties:{storeContextKey:true},noReference:true,child:"Constructor",subscriptionType:true},false)},{"../keys":140,"../subscribe":156,"vigour-observable":242}],144:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var getParent=require("../render/dom/parent");var append=require("../render/dom/create/append");var appendStatic=append.static;var appendState=append.state;exports.types={text:{class:null,subscriptionType:true,render:{static:function _static(target,pnode){appendStatic(target,pnode,document.createTextNode(target.compute()))},state:function state(target,_state,type,stamp,subs,tree,id,pid,order){var node=tree._[id];var val=target.compute(_state);var pnode;if(!node){if((typeof val==="undefined"?"undefined":_typeof(val))!=="object"&&val!==void 0){pnode=getParent(type,stamp,subs,tree,pid);node=tree._[id]=document.createTextNode(val);appendState(target,pnode,node,subs,tree,id,order)}}else{if(type&&type==="remove"||(typeof val==="undefined"?"undefined":_typeof(val))==="object"&&val!==void 0){pnode=getParent(type,stamp,subs,tree,pid)||node.parentNode;if(pnode){pnode.removeChild(node)}}else{var _val=target.compute(_state);if(_val&&(typeof _val==="undefined"?"undefined":_typeof(_val))!=="object"||_val===0){node.nodeValue=_val}}}}}}};exports.properties={text:{type:"text"}}},{"../render/dom/create/append":145,"../render/dom/parent":150}],145:[function(require,module,exports){"use strict";var fragment=require("../../fragment");var findParent=fragment.findParent;var isFragment=fragment.isFragment;exports.static=function staticAppendNode(target,pnode,domNode){if(isFragment(pnode)){pnode.push(domNode);pnode=findParent(pnode)}var index=target.findIndex(target.cParent());if(index!==void 0){pnode._last=index;domNode._order=index}pnode.appendChild(domNode)};exports.state=function stateAppendNode(target,pnode,node,subs,tree,uid,order){var fragment;if(isFragment(pnode)){fragment=pnode;pnode=findParent(pnode)}if(order!==void 0){var next=findNode(order,pnode);node._order=order;if(next){if(fragment){fragment.push(node)}pnode.insertBefore(node,next)}else{pnode._last=order;if(fragment){fragment.push(node)}pnode.appendChild(node)}}else{if(fragment){fragment.push(node)}pnode.appendChild(node)}};function findNode(order,pnode){var last=pnode._last;if(order<last){for(var c=pnode.childNodes,len=c.length,i=0;i<len;i++){if(c[i]&&c[i]._order>order){if(i<2||c[i-1]&&(c[i-1]._order<order||!c[i-1]._order)){return c[i]}}}}}},{"../../fragment":151}],146:[function(require,module,exports){"use strict";var render=require("./render");var renderStatic=render.static;var renderState=render.state;var getParent=require("../parent");var append=require("./append");var appendStatic=append.static;var appendState=append.state;var isFragment=require("../../fragment").isFragment;exports.static=function createElementStatic(target,pnode){var node=renderStatic(target);appendStatic(target,pnode,node);if(target.hasEvents){node._=target}return node};exports.state=function createElementState(target,state,type,stamp,subs,tree,id,pid,order){var pnode=getParent(type,stamp,subs,tree,pid);var node=renderState(target,type,stamp,subs,tree,id,pnode);if(pnode){if(target.tag!=="fragment"){appendState(target,pnode,node,subs,tree,id,order)}else{if(isFragment(pnode)){pnode.push(node)}}}return node}},{"../../fragment":151,"../parent":150,"./append":145,"./render":147}],147:[function(require,module,exports){"use strict";var parseStatic=require("../../../static");var props=parseStatic.property;var elems=parseStatic.element;var fragment=require("./fragment");exports.static=function renderElementStatic(target){var node;if(target.isStatic===true&&target._cachedNode&&target.hasOwnProperty("_cachedNode")){node=target._cachedNode.cloneNode(true);if(target._cachedNode._index){node._index=target._cachedNode._index}if(target._cachedNode._last){node._last=target._cachedNode._last}}else{if(target._cachedNode&&target.hasOwnProperty("_cachedNode")){node=target._cachedNode.cloneNode(false);if(target._cachedNode._propsStaticParsed){node._propsStaticParsed=true}}else{var nodeType=target.tag;if(nodeType==="fragment"){console.error("not handeling static fragments yet")}else{node=document.createElement(nodeType);props(target,node);target._cachedNode=node}}elems(target,node)}return node};exports.state=function renderElement(target,type,stamp,subs,tree,id,pnode){var node;if(target._cachedNode){node=target._cachedNode.cloneNode(false);tree._[id]=node;if(target._cachedNode._last){node._last=target._cachedNode._last}if(target._cachedNode._index){node._index=target._cachedNode._index}}else{var nodeType=target.tag;if(nodeType==="fragment"){return fragment(target,pnode,id,tree)}else{node=document.createElement(nodeType);var staticProps=target.keys("staticProps");if(staticProps){target._cachedNode=node;props(target,node);if(hasStateProperties(target)){node=target._cachedNode.cloneNode(false)}}}tree._[id]=node}elems(target,node);return node};function hasStateProperties(target){var keys=target.keys();var len=keys.length;for(var i=0;i<len;i++){var check=target[keys[i]];if(!check.isElement&&!check.isStatic){return true}}}},{"../../../static":155,"./fragment":148}],148:[function(require,module,exports){"use strict";var parseStatic=require("../../../static");var elems=parseStatic.element;module.exports=function(target,pnode,id,tree){var arr=[pnode];elems(target,arr);tree._[id]=arr;return arr}},{"../../../static":155}],149:[function(require,module,exports){"use strict";var create=require("./create");var createState=create.state;var getParent=require("./parent");var fragment=require("../fragment");var findParent=fragment.findParent;var isFragment=fragment.isFragment;exports.properties={staticIndex:true,_cachedtag:true};exports.render={static:create.static,state:function state(target,_state,type,stamp,subs,tree,id,pid,order){var node=tree._&&tree._[id];var pnode;if(type==="remove"){if(node){pnode=getParent(type,stamp,subs,tree,pid);if(pnode){if(target.tag==="fragment"){if(isFragment(pnode)){pnode=findParent(pnode)}removeFragmentChild(node,pnode)}else if(!target._emitters.removeEmitter){if(isFragment(pnode)){for(var i=0,len=pnode.length;i<len;i++){if(pnode[i]===node){pnode.splice(i,1);break}}pnode=pnode[0]}if(isFragment(pnode)){pnode=findParent(pnode)}pnode.removeChild(node)}}delete tree._[id]}}else if(!node){node=createState(target,_state,type,stamp,subs,tree,id,pid,order)}return node}};function removeFragmentChild(node,pnode){for(var i=1,len=node.length;i<len;i++){if(isFragment(node[i])){removeFragmentChild(node[i],pnode)}else{pnode.removeChild(node[i])}}}},{"../fragment":151,"./create":146,"./parent":150}],150:[function(require,module,exports){"use strict";module.exports=function getParent(type,stamp,subs,tree,pid){var _=subs._;if(!tree._&&/^\$switch/.test(tree._key)){tree=tree._p}if(_.t&&_.t[pid]){var node=tree._[pid];if(node){return node}else if(type==="new"||type==="update"){var err=new Error("No parent in tree"+('\n  type: "'+type+'" \n  pid: "'+pid+'"')+('\n  path: "'+(_.s&&_.s[pid]||_.t&&_.t[pid]).path().join("/")+'"'));Object.defineProperty(err,"name",{value:"ElementError"});throw err}}else if(_.p){if(tree._p._key==="$any"){tree=tree._p}return getParent(type,stamp,_.p,tree._p,pid)}}},{}],151:[function(require,module,exports){"use strict";exports.findParent=function(pnode){while(isFragment(pnode)){pnode=pnode[0]}return pnode};exports.isFragment=isFragment;function isFragment(node){return node instanceof Array}},{}],152:[function(require,module,exports){"use strict";var renderMultiple=require("./multiple");var State=require("vigour-state");var Element=require("../element");var get=require("lodash.get");var set=require("lodash.set");var vstamp=require("vigour-stamp");module.exports=function render(elem,state,callback,attach,id){if(!(elem instanceof Element)){elem=new Element(elem,false)}var subs=elem.$map();var tree={};if(state===void 0){renderMultiple(state,"new",0,subs,tree)}else{var renderStamp=vstamp.create("render",state._lstamp||0);if(!state||!state.isState){state=new State(state,false)}renderMultiple(state,"new",renderStamp,subs,tree);if(callback){callback(subs,tree,state,"new",renderStamp,subs,tree);state.subscribe(subs,function(state,type,stamp,nsubs,ntree,sType){renderMultiple(state,type,stamp,nsubs,ntree,sType);callback(subs,tree,state,type,stamp,nsubs,ntree,sType)},tree,renderStamp,attach,id)}else{state.subscribe(subs,renderMultiple,tree,renderStamp,attach,id)}vstamp.close(renderStamp)}var uid=elem.uid();if(elem.$){var target=void 0;var path=elem.$;if(elem.$any||elem.$switch){if(elem.$.length===1){path=[];target=tree}else{path=elem.$.slice(0,-1);target=get(tree,path)}}else{target=get(tree,elem.$)}if(!target){var obj={};set(obj,path,{});state.set(obj);target=get(tree,path)}return target._[uid]}else{return tree._[uid]}}},{"../element":139,"./multiple":153,"lodash.get":76,"lodash.set":79,"vigour-stamp":260,"vigour-state":261}],153:[function(require,module,exports){"use strict";var render=require("./state");module.exports=function renderMultiple(state,type,stamp,subs,tree,sType){var _=subs._;if(type!=="update"){var traveler=_.tList;if(traveler){for(var i=0,len=traveler.length;i<len;i+=4){render(traveler[i+3],state,type,stamp,subs,tree,traveler[i],traveler[i+1],traveler[i+2])}}}else if(_.sList){var specific=_.sList;for(var _i=0,_len=specific.length;_i<_len;_i+=4){render(specific[_i+3],state,type,stamp,subs,tree,specific[_i],specific[_i+1],specific[_i+2])}}}},{"./state":154}],154:[function(require,module,exports){"use strict";var widgets=require("../widget/widgets");module.exports=function renderState(target,state,type,stamp,subs,tree,id,pid,order){if(type==="remove"){for(var i=widgets.length-1;i>=0;i=i-3){var wtree=widgets[i];var ptree=wtree;while(ptree){if(tree===ptree){emitRemove(widgets[i-2],state,wtree,widgets[i-1],stamp);widgets.splice(i-2,3)}ptree=ptree._p}}if(!target.isWidget){emitRemove(target,state,tree,id,stamp)}}else if(!tree._){tree._={}}return target.render.state(target,state,type,stamp,subs,tree,id,pid,order)};function emitRemove(target,state,tree,id,stamp){var removeEmitter=target._emitters.removeEmitter;if(removeEmitter){var data={target:tree._&&tree._[id]};if(state){data.state=state}removeEmitter.emit(target,data,stamp)}}},{"../widget/widgets":172}],155:[function(require,module,exports){"use strict";exports.property=function(target,div,param){var props=target.keys("staticProps");for(var i=0,len=props.length;i<len;i++){var iteratee=target[props[i]];iteratee.render.static(iteratee,div,param)}return props};exports.element=function(target,div){var elements=target.keys("staticElements");for(var i=0,len=elements.length;i<len;i++){var iteratee=target[elements[i]];iteratee.render.static(iteratee,div)}return elements}},{}],156:[function(require,module,exports){"use strict";var isNumber=require("vigour-util/is/number");var globSwitch=require("vigour-state/lib/subscribe/switch/glob");var defaultTest=function defaultTest(state){return state&&state.compute()};exports.properties={$:function $(val){if(isNumber(val)){val=[val+""]}else if(typeof val==="string"){val=val.split(".")}if(val instanceof Array){var length=val.length;var last=val[length-1];if(last==="$any"){this.$any=true;length=length-1}else if(this.$any){this.$any=null}else if(last==="$switch"){if(!this.$switch){this.$switch=globSwitch}}else if(this.$switch){this.$switch=null}else if(last==="$test"){if(!this.$test){this.$test=defaultTest}}else if(this.$test){this.$test=null}this._$length=length}else{this._$length=null}this.$=val},_$path:true,isStatic:true,$switch:true,$any:true,$test:true,sync:true,isGroup:true,subscriptionType:true,render:function render(_render){this.define({render:{val:_render}})}};exports.subscriptionType=1;exports.inject=require("./map")},{"./map":157,"vigour-state/lib/subscribe/switch/glob":275,"vigour-util/is/number":289}],157:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var iterator=require("./iterator");var condition=require("./type/test");var switcher=require("./type/switcher");var any=require("./type/any");var normal=require("./type");var object=require("./type/object");var traveler=require("./type/traveler");exports.define={$map:function $map(map,prev){var returnValue;var $=this.$;if(!map){returnValue=map=this._$map={_:{p:prev||false}}}this.isStatic=null;if($){if((typeof $==="undefined"?"undefined":_typeof($))==="object"&&!($ instanceof Array)){if(!returnValue){returnValue=true}map=object(this,map)}else{if($[0]==="$root"&&(!map||!map._||!map._.p)){$.shift()}if(!returnValue){returnValue=true}if(this.$test){map=condition(this,map)}else if(this.$switch){map=switcher(this,map)}else if(this.$any){map=any(this,map)}else{map=normal(this,map)}}}else if(iterator(this,map)||returnValue){map=traveler(this,map);if(!returnValue){returnValue=true}}return returnValue}}},{"./iterator":158,"./type":165,"./type/any":164,"./type/object":166,"./type/switcher":167,"./type/test":168,"./type/traveler":169}],158:[function(require,module,exports){"use strict";module.exports=function iterator(target,map,prevMap){var changed;var keys=target.keys();for(var i=keys.length-1;i>=0;i--){var p=target[keys[i]];if(p&&p.val!==null){if(p.$map){if(exec(p,map,prevMap)){changed=true}}}}return changed};function exec(p,map,prevMap){var change=p.$map(map,prevMap);if(change){return true}else{p.isStatic=true}}},{}],159:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var mergeS=require("./subscriber/merge");var get=require("lodash.get");var set=require("./set");var val=require("./val");module.exports=exports=function exports(target,subs,val,map){var field=get(map,subs);if(field){if(subs.length>1){for(var i=0,len=subs.length-1,m=map,key;i<len;i++){key=subs[i];m=m[key];if(key!=="$root"&&key!=="$parent"){m.$remove=true}}}console.log("here?");merge(target,field,val);console.log(target.path(),"???");return field}else{console.error("lets set!",target.path(),val);return set(target,val,map,subs)}};function merge(target,a,b){if(b&&(typeof b==="undefined"?"undefined":_typeof(b))!=="object"){if(!a.val){a.val=b}}else{if((typeof b==="undefined"?"undefined":_typeof(b))==="object"){if(!b._){b._={}}b._.p=a._.p}for(var i in b){if(i!=="_"){if(_typeof(a[i])==="object"){merge(target,a[i],b[i])}else if(!a[i]){a[i]=b[i]}else if(i==="val"){if(a.val!==b.val&&b.val===true){val(target,a,true)}}else{var prev=a[i];a[i]={_:{p:a}};val(target,a[i],prev);merge(target,a[i],b[i])}}else{mergeS(a._,b._)}}}}},{"./set":160,"./subscriber/merge":163,"./val":170,"lodash.get":76}],160:[function(require,module,exports){"use strict";var valx=require("./val");module.exports=function set(target,val,map,path){var len=path.length-1;if(len===0){map[path[0]]=val;val._={p:map};if(val.val){var valxx=val.val;delete val.val;valx(target,val,valxx)}}else{var m=map;for(var i=0,key;i<len;i++){key=path[i];if(!m[key]){m[key]={_:{p:m}}}if(key!=="$root"&&key!=="$parent"){m[key].$remove=true}m=m[key]}m[path[len]]=val;val._={p:m};console.warn(val);if(val.val){var _valxx=val.val;delete val.val;console.log("go do it");valx(target,val,_valxx)}}return val}},{"./val":170}],161:[function(require,module,exports){"use strict";exports.id=function(obs){if(obs.storeContextKey){var key=obs.cParent().key;return key?"c"+key+"-"+genCid(obs):"c"+genCid(obs)}else{return"c"+genCid(obs)}};function genCid(obs){if(obs.__c){if(obs._cLevel===1){return obs.uid()+""+genCid(obs.__c)}else{return obs.uid()+""+genCid(obs._parent)}}else{return obs.uid()}}},{}],162:[function(require,module,exports){"use strict";var context=require("./context");var contextId=context.id;module.exports=function subscriber(target,obs,type){var _=target._;var store=_[type]||(_[type]={});var pid,id,parent,index;if(obs.__c){parent=getParent(obs.cParent());id=contextId(obs);pid=parent.__c?contextId(parent):parent.uid()}else{id=obs.uid();parent=getParent(obs._parent);pid=parent&&parent.uid()}index=obs.findIndex(parent);if(!store[id]){store[id]=obs;if(type==="s"){if(!_.sList){_.sList=[]}_.sList.unshift(id,pid,index,obs)}if(!_.tList){_.tList=[]}_.tList.unshift(id,pid,index,obs)}return target};function getParent(parent){while(parent){if(parent.isElement){return parent}parent=parent.cParent()}}},{"./context":161}],163:[function(require,module,exports){"use strict";module.exports=function mergeS(a,b){if(b.t){for(var uid in b.t){a.t[uid]=b.t[uid]}if(!b.s){a.tList=a.tList?a.tList.concat(b.tList):b.tList}}if(b.s){for(var _uid in b.s){a.s[_uid]=b.s[_uid]}a.sList=a.sList?a.sList.concat(b.sList):b.sList;a.tList=a.tList?a.tList.concat(b.tList):b.tList}}},{}],164:[function(require,module,exports){"use strict";var merge=require("../merge");var subscriber=require("../subscriber");var iterator=require("../iterator");module.exports=function collection(target,map){var child=target.child.prototype;var $=target.$;if(target.__c||!target.hasOwnProperty("child")){if(child===target.types.element){throw new Error("brisky-core: $any: child === Element. Define a child Element "+target.path())}else{child.__c=target;child._cLevel=1}}console.log("xpok???",$,map);if($.length!==1){var path=target.$.slice(0,-1);var val={val:1};var walk=map;var exists=void 0;val.$any=child.$map(void 0,exists?walk:val);if(!val.$any.val){if(!child.$test){val.$any.val=1}else{console.log("add val 1 in child.$test.$pass")}}val.$remove=true;map=merge(target,path,val,map)}else{map.$any=child.$map(void 0,map);if(!map.$any.val){if(!child.$test){map.$any.val=1}else{console.log("add val 1 in child.$test.$pass")}}}iterator(target,map);subscriber(map,target,"t");return map}},{"../iterator":158,"../merge":159,"../subscriber":162}],165:[function(require,module,exports){"use strict";var merge=require("../merge");var iterator=require("../iterator");var subscriber=require("../subscriber");var val=require("../val");module.exports=function normal(target,map){var def=target.subscriptionType;var path=target.$;var type;type=def===1?"t":"s";if(target.sync===false){console.error("???",target.path(),target.sync===false,map.val)}if(path!==true){console.info("\n -----",target.path());map=merge(target,path,{val:def},map)}else{val(target,map,def)}iterator(target,map);subscriber(map,target,type);return map}},{"../iterator":158,"../merge":159,"../subscriber":162,"../val":170}],166:[function(require,module,exports){"use strict";var merge=require("../merge");var iterator=require("../iterator");var subscriber=require("../subscriber");module.exports=function object(target,map){var subs=target.$;iterator(target,map);var arr=parseit(subs);for(var i=0,len=arr.length;i<len;i++){var path=arr[i];var type=path.pop();var prevmap=merge(target,path,{val:type},map);subscriber(prevmap,target,type===true?"s":"t")}return map};function parseit(subs,arr,path){if(!arr){arr=[]}if(!path){path=[]}for(var field in subs){if(field==="val"){path.push(subs[field]);arr.push(path)}else{parseit(subs[field],arr,path.concat(field))}}return arr}},{"../iterator":158,"../merge":159,"../subscriber":162}],167:[function(require,module,exports){"use strict";var merge=require("../merge");var subscriber=require("../subscriber");var iterator=require("../iterator");var hash=require("vigour-util/hash");module.exports=function switcher(target,map,prevMap){var $=target.$;var key="$switch"+hash(target.path().join("."));$[$.length-1]=key;if($.length!==1){var val={val:1};val[key]={};map=merge(target,target.$.slice(0,-1),val,map);mapSwitch(val[key],target,map)}else{map[key]=mapSwitch({},target,map)}iterator(target,map);subscriber(map,target,"t");return map};function mapSwitch(val,target,pmap){val.exec=target.$switch;val.$remove=true;
var elemprops=target.types.element.properties;var properties=target.properties;for(var key in properties){var keyO=key[0];if(keyO!=="$"&&keyO!=="_"){var prop=properties[key];var base=prop.base;if(base&&base.isElement&&elemprops[key]!==prop){if(target.__c||base._parent!==target){base.getConstructor();if(target.__c){base.__c=target.__c;base._cLevel=target._cLevel+1}else{base.__c=target;base._cLevel=1}}var map=base.$map(void 0,pmap);val[key]=map;if(!("val"in map)){map.val=1;map.$remove=true}}}}return val}},{"../iterator":158,"../merge":159,"../subscriber":162,"vigour-util/hash":285}],168:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var merge=require("../merge");var iterator=require("../iterator");var subscriber=require("../subscriber");var set=require("lodash.set");var hash=require("vigour-util/hash");module.exports=function test(target,map){var $test=target.$test;var type=target.subscriptionType;var test={$pass:{val:type}};var $pass;if(typeof $test==="function"){test.exec=$test}else{test.exec=$test.val;test.$=parse($test.$)}var key="$test"+hash(target.path().join("."));target.$[target.$.length-1]=key;if(target.$.length!==1){var path=target.$.slice(0,-1);var val=_defineProperty({},key,test);if(!val.val){val.val=1}val.$remove=true;map=merge(target,path,val,map);$pass=map[key].$pass}else{$pass=merge(target,target.$,test,map).$pass}$pass._={p:map};iterator(target,$pass);subscriber($pass,target,type===true?"s":"t");return $pass};function parse(obj){var type=typeof obj==="undefined"?"undefined":_typeof(obj);if(type==="object"){for(var i in obj){obj[i]=parse(obj[i])}}else if(type==="string"){var path=obj;set(obj={},path,{})}else{obj={}}return obj}},{"../iterator":158,"../merge":159,"../subscriber":162,"lodash.set":79,"vigour-util/hash":285}],169:[function(require,module,exports){"use strict";var subscriber=require("../subscriber");module.exports=function(target,map,prev){if(target.isGroup){subscriber(map,target,"s");map.val=true}else{subscriber(map,target,"t")}return map}},{"../subscriber":162}],170:[function(require,module,exports){"use strict";module.exports=function(target,map,val){console.warn("yo yo",target.path());if(target.sync===false){console.warn("noSync...",target.path());if(val===true&&map.val!==val||!map.val){console.error(val,map.val,map);if(!map._.sync){map._.sync={}}map._.sync.val=map.val;console.info(map._.sync)}}else if(target.sync===false){console.log("ok normal",target.path());if(map.val){console.log(map.val)}if(map._.sync){console.error("got sync",map,map.val,val,target.path())}}if(val&&map.val!==true){map.val=val}}},{}],171:[function(require,module,exports){"use strict";var widgets=require("./widgets");exports.properties={isWidget:{type:"property",subscriptionType:1,$:true,render:{state:function state(target,_state,type,stamp,subs,tree,id,pid){if(type==="new"){widgets.push(target.cParent(),pid,tree)}}}}}},{"./widgets":172}],172:[function(require,module,exports){"use strict";module.exports=[]},{}],173:[function(require,module,exports){"use strict";module.exports=require("./lib/render")},{"./lib/render":152}],174:[function(require,module,exports){"use strict";module.exports=exports=function attach(e,data){var touch=e.changedTouches;var ev=touch?touch[0]:e;if(data.x!==void 0){data.prevX=data.x}if(data.y!==void 0){data.prevY=data.y}if(ev.clientX!==void 0){data.x=ev.clientX}if(ev.clientY!==void 0){data.y=ev.clientY}data.event=e;return data};exports.start=function attachStartPos(data){data.startX=data.x;data.startY=data.y;return data}},{}],175:[function(require,module,exports){"use strict";exports.inject=require("./");exports.on={properties:{move:function move(val){this.set({mousemove:val,touchmove:val},false)},down:function down(val,stamp){this.set({mousedown:val,touchstart:val},false)},up:function up(val){this.set({mouseup:val,touchend:val},false)}}}},{"./":186}],176:[function(require,module,exports){"use strict";var attach=require("./attach");var vstamp=require("vigour-stamp");var restore=require("./restore");module.exports=function delegateEvent(key,e){var target=e.target;var stamp;do{var elem=target._;if(elem){var listener=elem._emitters[key];if(listener){if(!stamp){stamp=vstamp.create(key)}var data={target:target};restore(data);listener.emit(elem,attach(e,data),stamp);if(data.prevent){break}}}if(stamp){vstamp.close(stamp)}}while(target=target.parentNode)}},{"./attach":174,"./restore":191,"vigour-stamp":260}],177:[function(require,module,exports){"use strict";module.exports=function isDisplayed(target){return target.offsetParent!==null}},{}],178:[function(require,module,exports){"use strict";var addListeners=require("./listener");var displayed=require("./displayed");var attachEvent=require("./attach");var fire=require("./fire");var attachStartPos=attachEvent.start;exports.inject=require("./");exports.on={properties:{drag:function drag(val){var self=this;if(typeof val==="function"){val={drag:val}}this.set({mousedown:{mouseDragStart:function mouseDragStart(data){var dragged,removeListeners,target;if(data.event.which!==3){removeListeners=addListeners("mouseup",mouseDragUp,"mousemove",mouseDragMove);target=data.target;attachStartPos(data)}function mouseDragMove(e){if(displayed(target)){data.dragStart=!dragged;fire("drag",e,data,val,self);dragged=true}else{removeListeners()}}function mouseDragUp(e){if(dragged&&displayed(target)){data.dragEnd=true;fire("drag",e,data,val,self)}removeListeners()}}},touchstart:{touchDragStart:function touchDragStart(data){var dragged;var target=data.target;var removeListeners=addListeners("touchmove",touchDragMove,"touchend",touchDragUp);attachStartPos(data);function touchDragMove(e){if(displayed(target)){data.dragStart=!dragged;fire("drag",e,data,val,self);if(data.cancelDrag){removeListeners()}dragged=true}else{removeListeners()}}function touchDragUp(e){if(dragged&&displayed(target)){data.dragEnd=true;fire("drag",e,data,val,self)}removeListeners()}}}})}}}},{"./":186,"./attach":174,"./displayed":177,"./fire":179,"./listener":189}],179:[function(require,module,exports){"use strict";var attachEvent=require("./attach");var vstamp=require("vigour-stamp");var restore=require("./restore");module.exports=function fireEvent(type,e,data,listeners,bind,start,end){var stamp=vstamp.create(type);attachEvent(e,data);restore(data);for(var i in listeners){listeners[i].call(bind,data,stamp)}vstamp.close(stamp)}},{"./attach":174,"./restore":191,"vigour-stamp":260}],180:[function(require,module,exports){(function(global){"use strict";var cancel=global.cancelAnimationFrame;var raf=global.requestAnimationFrame;var addListener=require("../listener");var displayed=require("../displayed");var fire=require("../fire");exports.on={properties:{forcechanged:function forcechanged(val){var elem=this;if(typeof val==="function"){val={forcechanged:val}}this.set({webkitmouseforcechanged:val,touchstart:{forceChangedStart:function forceChangedStart(data){var e=data.event;var touch=e.touches[0];if(touch.force!==void 0){(function(){var target=data.target;var force=touch.force;var timer=raf(function checkForce(){if(displayed(target)){if(touch.force!==force){force=touch.force;fire("forcechanged",e,data,val,elem)}timer=raf(checkForce)}else{removeListener()}});var removeListener=addListener("touchend",function forceChangedEnd(){removeListener();cancel(timer)})})()}}}},false)}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../displayed":177,"../fire":179,"../listener":189}],181:[function(require,module,exports){(function(global){"use strict";var setUserSelect=require("../userselect");var addListener=require("../listener");var displayed=require("../displayed");var treshold=require("./treshold");var fire=require("../fire");var cancel=global.cancelAnimationFrame;var raf=global.requestAnimationFrame;exports.on={properties:{forcedown:function forcedown(val){var elem=this;if(typeof val==="function"){val={forcedown:val}}this.set({webkitmouseforcedown:val,touchstart:{forceDownStart:function forceDownStart(data){var e=data.event;var touch=e.touches[0];if(touch.force!==void 0){(function(){var target=data.target;var style=target.style;var forcedown=void 0;var timer=raf(function checkForce(){if(displayed(target)){if(!forcedown){if(touch.force>=treshold){fire("forcedown",e,data,val,elem);forcedown=true}}else if(touch.force<treshold){forcedown=false}timer=raf(checkForce)}else{setUserSelect(style,null);removeListener()}});var removeListener=addListener("touchend",function forceDownEnd(){setUserSelect(style,null);removeListener();cancel(timer)});setUserSelect(style,"none")})()}}}},false)}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../displayed":177,"../fire":179,"../listener":189,"../userselect":193,"./treshold":183}],182:[function(require,module,exports){"use strict";exports.inject=[require("../"),require("./changed"),require("./down"),require("./up")]},{"../":186,"./changed":180,"./down":181,"./up":184}],183:[function(require,module,exports){"use strict";module.exports=1},{}],184:[function(require,module,exports){(function(global){"use strict";var setUserSelect=require("../userselect");var addListener=require("../listener");var displayed=require("../displayed");var treshold=require("./treshold");var fire=require("../fire");var cancel=global.cancelAnimationFrame;var raf=global.requestAnimationFrame;exports.on={properties:{forceup:function forceup(val){var elem=this;if(typeof val==="function"){val={forceup:val}}this.set({webkitmouseforceup:val,touchstart:{forceUpStart:function forceUpStart(data){var e=data.event;var touch=e.touches[0];if(touch.force!==void 0){(function(){var target=data.target;var style=target.style;var forcedown=void 0;var timer=raf(function checkForce(){if(displayed(target)){if(forcedown){if(touch.force<treshold){fire("forceup",e,data,val,elem);forcedown=false}}else if(touch.force>=treshold){forcedown=true}timer=raf(checkForce)}else{setUserSelect(style,null);removeListener()}});var removeListener=addListener("touchend",function forceUpEnd(e){if(forcedown&&displayed(target)){fire("forceup",e,data,val,elem)}setUserSelect(style,null);removeListener();cancel(timer)});setUserSelect(style,"none")})()}}}},false)}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../displayed":177,"../fire":179,"../listener":189,"../userselect":193,"./treshold":183}],185:[function(require,module,exports){(function(global){"use strict";var addListener=require("./listener");var displayed=require("./displayed");var fire=require("./fire");var cancel=global.cancelAnimationFrame;var raf=global.requestAnimationFrame;exports.inject=require("./");exports.on={properties:{hover:function hover(val){var self=this;if(typeof val==="function"){val={hover:val}}this.set({mouseover:{hoverStart:function hoverStart(data){var e=data.event;var target=data.target;var removeListener=addListener("mouseout",function(data){return cancel(timer)});var timer=raf(function hover(){if(displayed(target)){fire("hover",e,data,val,self);timer=raf(hover)}else{removeListener()}});fire("hover",e,data,val,self)}},touchmove:val},false)}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./":186,"./displayed":177,"./fire":179,"./listener":189}],186:[function(require,module,exports){"use strict";var delegate=require("./delegate");var addListener=require("./listener");exports.inject=require("./property");exports.define={extend:{contextRemove:function contextRemove(_contextRemove,key,stamp){if(this&&this.val!==null){this.hasEvents.remove(false)}_contextRemove.call(this,key,stamp)}}};exports.on={define:{extend:{isProperty:function isProperty(_isProperty,key){if(!this.types.base.isProperty.call(this,key)){console.log("event",key);var cache=this.eventCache;if(!cache[key]){cache[key]=true;addListener(key,function(e){return delegate(key,e)})}this._parent.set({hasEvents:true},false)}return _isProperty.call(this,key)},contextRemove:function contextRemove(_contextRemove2,key,stamp){removeEvent(this,this[key],key);_contextRemove2.call(this,key,stamp)},addNewProperty:function addNewProperty(_addNewProperty,key,val,stamp){var ret=_addNewProperty.call(this,key,val,stamp);if(val.createEvent){this[key].createEvent()}return ret}},eventCache:{value:{}}},child:{properties:{createEvent:function createEvent(_createEvent){this.define({createEvent:_createEvent})},removeEvent:function removeEvent(_removeEvent){this.define({removeEvent:_removeEvent})}}}};function hasEvents(on,properties,key){var keys=on.keys();var child=on.child;for(var i in keys){if(keys[i]!==key&&on[keys[i]]instanceof child){return true}}}function removeEvent(target,property,key){if(key[0]!=="_"){var properties=target.properties;var parent=target._parent;if(parent.val!==null&&parent.hasEvents&&!hasEvents(target,properties,key)){parent.hasEvents.remove(false)}if(property.removeEvent){property.removeEvent()}}}},{"./delegate":176,"./listener":189,"./property":190}],187:[function(require,module,exports){"use strict";var map=require("./map");var properties={};exports.inject=require("../");exports.on={types:{keyemitter:{createEvent:function createEvent(){var parent=this._parent;var keydown=parent.keydown;var listener=keydown&&keydown.fn&&keydown.fn.emitKey;if(!listener){parent.setKey("keydown",{emitKey:emitKey},false)}}}},properties:properties};for(var i in map){var type=map[i];if(!properties[type]){properties[type]={type:"keyemitter"}}}function emitKey(data,stamp){var keyCode=data.event.keyCode;var type=map[keyCode];if(type){var listener=this._emitters[type];if(listener){listener.emit(this,data,stamp)}}}},{"../":186,"./map":188}],188:[function(require,module,exports){"use strict";module.exports={37:"arrowleft",4:"arrowleft",39:"arrowright",5:"right",38:"arrowup",29460:"arrowup",40:"arrowdown",29461:"arrowdown",8:"back",88:"back",1537:"back",10009:"back",27:"menu",75:"menu",13:"enter",29443:"enter",65376:"enter",227:"rewind",179:"playbtn",228:"forward",32:"space"}},{}],189:[function(require,module,exports){"use strict";var ua=require("vigour-ua/navigator");var touch=require("vigour-util/is/touch");var isChromeEmulator=touch&&navigator.vendor==="Google Inc."&&navigator.platform==="MacIntel";if(ua.platform==="ios"&&touch){document.documentElement.style.cursor="pointer";document.body.style.cursor="pointer"}module.exports=function addListeners(){var l=arguments.length;var a=[];for(var i=0;i<l;i++){var key=arguments[i];var listener=arguments[++i];addEventListener(key,listener,key==="focus"||key==="scroll"||key==="blur");a.push(key,listener)}return function removeListeners(){for(var _i=0;_i<l;_i++){document.removeEventListener(a[_i],a[++_i])}}};var addEventListener=!isChromeEmulator?function addEventListener(key,listener,capture){document.addEventListener(key,listener,capture)}:function addEventListener(key,listener,capture){var touchEvent=key.indexOf("mouse")===-1;if(touchEvent){document.addEventListener(key,listener,capture)}}},{"vigour-ua/navigator":282,"vigour-util/is/touch":293}],190:[function(require,module,exports){"use strict";var getParent=require("brisky-core/lib/render/dom/parent");exports.properties={hasEvents:{type:"property",sync:false,$:true,render:{state:function state(target,_state,type,stamp,subs,tree,id,pid){var node=getParent(type,stamp,subs,tree,pid);if(node){if(_state){node._sc=_state.storeContext();node._s=_state}if(!("_"in node)){node._=target.cParent()}}}}}}},{"brisky-core/lib/render/dom/parent":150}],191:[function(require,module,exports){"use strict";module.exports=function restoreContext(data){var target=data.target;var state=target._s;if(state){var resolved=state.applyContext(target._sc);if(resolved){target._s=state=resolved;target._sc=state.storeContext()}else if(resolved===null){target._s=null;delete target._sc;state=null}data.state=state}}},{}],192:[function(require,module,exports){(function(global){"use strict";var setUserSelect=require("./userselect");var addListeners=require("./listener");var displayed=require("./displayed");var timeout=global.setTimeout;var clear=global.clearTimeout;var fire=require("./fire");exports.inject=require("./");exports.on={properties:{rightclick:function rightclick(val){var self=this;var removeListeners,timer;if(typeof val==="function"){val={rightclick:val}}this.set({contextmenu:{mouseRightClick:function mouseRightClick(data){var e=data.event;fire("rightclick",e,data,val,self);e.preventDefault();clearListeners()}},touchstart:{touchRightClickStart:function touchRightClickStart(data){var target=data.target;var style=target.style;timer=timeout(function(){timer=null},700);removeListeners=addListeners("touchmove",clearRightClick,"touchend",rightClick);setUserSelect(style,"none");clearListeners();function clearRightClick(){setUserSelect(style,null);clearListeners()}function rightClick(e){if(timer&&displayed(target)){fire("rightclick",e,data,val,self)}clearRightClick()}}}},false);function clearListeners(){if(removeListeners){removeListeners()}if(timer){clear(timer)}}}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./":186,"./displayed":177,"./fire":179,"./listener":189,"./userselect":193}],193:[function(require,module,exports){"use strict";var prefix=require("vigour-ua/navigator").prefix;var userSelect=prefix+"UserSelect";module.exports=function setUserSelect(style,val){style.webkitTouchCallout=val;style[userSelect]=val}},{"vigour-ua/navigator":282}],194:[function(require,module,exports){"use strict";require("../style.css");module.exports={key:"app",child:{class:true,child:"Constructor"},text:{$:"movies.items",sync:false,$transform:function $transform(val){return val.keys().length}},filters:{class:"holder",search:{tag:"input",class:"title",props:{placeholder:"search movies...",type:"search",value:{$:"query",$transform:function $transform(val){return typeof val==="string"?val:""}}},on:{input:function input(e,stamp){e.state.getRoot().set({query:e.target.value},stamp)}}}},holder:{$:"movies.items.$any",child:{class:"complex-item poster-item",$:"$test",title:{text:{$:"title"}},$test:{val:function val(state){var $root=state.getRoot();var query=$root.query&&$root.query.compute();if(typeof query!=="string"){query=false}var rating=$root.rating?$root.rating.compute():0;if(state.rating&&state.rating.compute()<rating){return false}var year=$root.year&&$root.year.compute();if(year&&state.year&&state.year.compute()!==year){return false}if(!query){return true}else{var title=state.title&&state.title.compute();if(typeof title!=="string"){title=false}var titleResult=title&&title.toLowerCase().indexOf(query.toLowerCase())!==-1;return titleResult}},$:{title:{},year:{},$root:{query:{},rating:{},year:{}}}}}}}},{"../style.css":196}],195:[function(require,module,exports){(function(global){"use strict";var Hub=require("brisky-hub");var state=global.state=new Hub({url:"wss://example-hub-yuajirpsyu.now.sh",context:false});var render=require("brisky/render");document.body.appendChild(render(require("./app"),state,function(s){global.s=s}));console.info(global.s)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./app":194,"brisky-hub":206,"brisky/render":225}],196:[function(require,module,exports){},{}],197:[function(require,module,exports){(function(global){"use strict";var raf=global.requestAnimationFrame;var ua=require("vigour-ua");module.exports=ua.device!=="tablet"&&ua.device!=="phone"?function focusNode(node){node.focus();if(node.value&&node.tagName==="TEXTAREA"||node.tagName==="INPUT"&&(node.type==="text"||node.type==="search"||node.type==="password")){raf(function(){if(node.value){node.setSelectionRange(node.value.length,node.value.length)}})}if(document.activeElement!==node){raf(function(){return node.focus()})}}:function focusNode(){}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"vigour-ua":281}],198:[function(require,module,exports){"use strict";var getParent=require("brisky-core/lib/render/dom/parent");var focusNode=require("./focus");exports.inject=[require("brisky-props"),require("brisky-class"),require("brisky-events")];exports.class={properties:{focus:{properties:{autofocus:true},define:{extend:{render:{state:function state(render,target,_state,type,stamp,subs,tree,id,pid){var pnode=getParent(type,stamp,subs,tree,pid);var focus=_state.origin();var focused;if(focus){var mypath=pnode._s.origin().sid();focused=target.compute(focus.sid()===mypath);if(focused&&target.autofocus){var rootfocus=_state.getRoot().focus;if(rootfocus){var rootfocusOrigin=rootfocus.origin();var originSid=rootfocusOrigin.sid();if(originSid===mypath){var valSid=rootfocus.val.sid();if(valSid===originSid||valSid===_state.sid()){focusNode(pnode)}}}}}render(target,focused?"focus":"",type,stamp,subs,tree,id,pid)}}}}}}};exports.properties={focus:function focus(val){if(!val.$){throw new Error('no subscription passed to focus "'+this.path().join(".")+'"')}this.set({hasEvents:true,class:{focus:val},on:{focus:{focus:_focus}}},false);if(val.autofocus!==false){if(!this.props||!this.props.tabindex){this.setKey("props",{tabindex:0},false)}this.class.focus.autofocus=true}}};function _focus(data,stamp){var state=data.state;var focus=state.lookUp("focus")||"focus"in state&&state.focus;if(focus){var rootfocus=focus&&focus.getRoot().focus;if(rootfocus){if(focus!==rootfocus){rootfocus.set(focus,stamp);focus.set(state,stamp)}else{rootfocus.set(state,stamp)}}else{focus.set(state,stamp)}}}},{"./focus":197,"brisky-class":138,"brisky-core/lib/render/dom/parent":150,"brisky-events":186,"brisky-props":218}],199:[function(require,module,exports){"use strict";var Sync=require("../sync");module.exports=new Sync({type:"client",define:{isClient:{value:true}},properties:{socket:true},inject:[require("./send")]},false).Constructor},{"../sync":210,"./send":200}],200:[function(require,module,exports){(function(process){"use strict";var vstamp=require("vigour-stamp");var serialize=require("../serialize");var chunkSize=2e3;exports.define={sendMeta:function sendMeta(){var hub=this.root;var id=hub.id;var progress=_send(this,void 0,id);var client=progress.client||(progress.client={id:id});if(hub.subscriptions){client.subscriptions=hub.subscriptions}client.context=hub.context?hub.context.compute():false;_send(this,void 0,id)},send:function send(state,type,stamp,subs,tree,sType){if(this.root.val!==null){if(!subs||subs.val===true){if(state.stamp&&vstamp.type(state.stamp)!=="context"){var id=this.id.compute();serialize(_send(this,stamp,id),state,type,stamp,subs,tree,sType,id)}}}}};function _send(client,stamp,id){var hub=client.root;if(!hub.inprogress[hub.id]){hub.inprogress[hub.id]={}}var inprogress=hub.inprogress[hub.id];if(!inprogress[id]){inprogress[id]={};process.nextTick(function(){if(client.val===null){delete inprogress[id];return}var hub=client.root;if(client.val!==null){if(hub.id!=client.id.compute()||hub.connected&&hub.connected.compute()===true){socketSend(client,inprogress,id);delete inprogress[id]}else{hub.connected.is(true,function(){socketSend(client,inprogress,id);delete inprogress[id]})}}else{delete inprogress[id]}})}return inprogress[id]}function socketSend(client,inprogress,id){if(client.val!==null){var payload={state:inprogress[id]};if(client.socket.context&&client.socket.context.context){payload.context=client.socket.context.context.compute()}if(inprogress[id].client){payload.client=inprogress[id].client;delete inprogress[id].client}var string=JSON.stringify(payload);client.socket.send(string)}}}).call(this,require("_process"))},{"../serialize":209,_process:70,"vigour-stamp":260}],201:[function(require,module,exports){"use strict";exports.properties={clients:{noContext:true,child:{type:"client"}}}},{}],202:[function(require,module,exports){"use strict";var vstamp=require("vigour-stamp");exports.define={getContext:function getContext(context){var instances=this.instances;if(instances){for(var i=0,len=instances.length;i<len;i++){if(instances[i].context.compute()===context){return instances[i]}}}}};exports.properties={context:{val:false,sync:false,on:{data:{context:function context(val,stamp){var _this=this;if(this.val!==null){(function(){var hub=_this.root;if(hub.client&&hub.client.val){(function(){var contextStamp=vstamp.create("context");hub.clients.each(function(client,key){if(key!=hub.id){client.remove(contextStamp)}});vstamp.close(contextStamp);hub.client.origin().sendMeta()})()}})()}}}}}}},{"vigour-stamp":260}],203:[function(require,module,exports){"use strict";var create=require("./server/create");var close=require("./server/close");exports.properties={downstream:true,port:{type:"observable",noContext:true,on:{data:function data(){var hub=this.cParent();var val=this.compute();if(hub.downstream){close(hub);hub.downstream=null}if(val){create(hub,val)}}}}};exports.on={remove:{port:function port(){if(this.hasOwnProperty("port")){this.port.set(null)}}}}},{"./server/close":204,"./server/create":205}],204:[function(require,module,exports){"use strict";module.exports=function closeServer(hub){var server=hub.downstream;var instances=hub.instances;closeConnections(hub);for(var i=0,len=instances&&instances.length;i<len;i++){closeConnections(instances[i])}server.httpServer.close()};function closeConnections(hub){var clients=hub.clients;var id=hub.id;clients.each(function(client){if(client.upstream&&client.upstream.compute()===id){client.socket.close()}})}},{}],205:[function(require,module,exports){"use strict"},{}],206:[function(require,module,exports){"use strict";var Sync=require("./sync");var Client=require("./client");var uuid=require("vigour-util/uuid").val;var ts=require("monotonic-timestamp");var stamp=require("vigour-stamp");var create=stamp.create;stamp.offset=0;stamp.create=function(type,src,val){return create(type,src,val||ts()-stamp.offset)};module.exports=new Sync({type:"hub",define:{isHub:true,inprogress:{value:{}}},types:{sync:Sync.prototype,client:Client.prototype},inject:[require("./clients"),require("./upstream"),require("./downstream"),require("./context"),require("./receive")],properties:{incomingStamps:true,id:true,subscriptions:true},id:uuid,on:{error:function error(err){console.log(err)}}},false).Constructor},{"./client":199,"./clients":201,"./context":202,"./downstream":203,"./receive":208,"./sync":210,"./upstream":217,"monotonic-timestamp":80,"vigour-stamp":260,"vigour-util/uuid":296}],207:[function(require,module,exports){"use strict";var vstamp=require("vigour-stamp");exports.incoming=function offsetClient(hub,socket,data,clocksy){var tDelta=clocksy.processResponse(data.data);if(socket.offset===void 0){if(!vstamp.offsetConnection){vstamp.offsetConnection=socket}socket.offset=tDelta;var stamp=vstamp.create("connect");hub.set({connected:true},stamp);vstamp.close(stamp)}else{socket.offset=tDelta}if(vstamp.offsetConnection===socket){vstamp.offset=Math.abs(tDelta)>10?tDelta:0}}},{"vigour-stamp":260}],208:[function(require,module,exports){"use strict";var vstamp=require("vigour-stamp");exports.define={receive:function receive(data){var hub=this;var hubcontext=hub.context&&hub.context.compute();if(!(!data.context&&!hubcontext)&&data.context!=hubcontext){if(data.state&&data.state.clients){delete data.state.clients}}hub.set(data.state,false);hub.emit("subscription")}}},{"vigour-stamp":260}],209:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};function merge(a,b){for(var key in b){var ak=a[key];var bk=b[key];if(ak&&(typeof ak==="undefined"?"undefined":_typeof(ak))==="object"){merge(ak,bk)}else{a[key]=bk}}}module.exports=function serialize(data,state,type,stamp,subs){var obj={};var path=state.realPath(false,true);var len=path.length;var select=obj;for(var i=0;i<len;i++){select=select[path[i]]={}}if(state.val===null){select.val=null;select.stamp=state.stamp}else{if(state.val&&state.val.isBase){select.val="$root."+state.val.realPath(false,true).join(".");serialize(data,state.val,type,stamp,subs)}else if(state.val!==void 0){select.val=state.val}if(subs&&subs.val===true){state.each(function(field,key){select[key]=serialize(data,field,type,stamp,subs)})}select.stamp=state.stamp}merge(data,obj)}},{}],210:[function(require,module,exports){"use strict";var State=require("vigour-state");var vstamp=require("vigour-stamp");module.exports=new State({type:"sync",inject:[require("./subscription"),require("./set"),require("./sync")],on:{data:{stamp:function stamp(val,_stamp){var _this=this;var originalStamp=_stamp;if(this.syncUp||this.syncDown){var src=vstamp.src(_stamp);var hub=this.getRoot();if(src){if(src!==hub.id){var client=hub.get(["clients",src]);if(hub.client&&client&&client.upstream){if(client.upstream.compute()===hub.id){if(hub.client&&hub.client.val){hub.client.origin().send(this,void 0,_stamp)}}}}this.stamp=_stamp}else if(!src){_stamp=vstamp.setSrc(_stamp,hub.id);this.stamp=_stamp;if(this.syncUp&&hub.client){var _client=hub.client.origin();if(hub.client.val){_client.send(this,void 0,_stamp)}}}}else{this.stamp=_stamp}var parent=this.cParent();if(this._subscriptions){(function(){var l=_this;vstamp.on(originalStamp,function(){l.emit("subscription",val,typeof _stamp!=="string"?String(_stamp):_stamp)})})()}else{while(parent&&parent.stamp!==_stamp){lstampInner(parent,val,_stamp,originalStamp);parent=parent.cParent()}}}}},child:"Constructor"},false).Constructor;function lstampInner(parent,val,stamp,originalStamp){parent.stamp=stamp;if(parent._subscriptions){(function(){var l=parent;vstamp.on(originalStamp,function(){l.emit("subscription",val,typeof stamp!=="string"?String(stamp):stamp)})})()}else if("base"in parent._emitters._data){if(parent._emitters._data.base){parent._emitters._data.base.each(function(p){lstampInner(p,val,stamp,originalStamp)})}}}},{"./set":211,"./subscription":212,"./sync":215,"vigour-stamp":260,"vigour-state":261}],211:[function(require,module,exports){"use strict";"use stirct";var debug=require("vigour-stamp/debug");var vstamp=require("vigour-stamp");var isObj=require("vigour-util/is/obj");exports.define={extend:{set:function set(_set,val,stamp,nocontext,isNew){var obj=isObj(val);var t;if(obj){if(val.stamp){t=val.stamp}}if(t&&this.stamp){if(Number(vstamp.val(t))<Number(vstamp.val(this.stamp))){if(!obj){return}else if(val.val){delete val.val}}}if(t){this.stamp=t}var changed=_set.call(this,val,stamp,nocontext,isNew);return changed}},isSync:true}},{"vigour-stamp":260,"vigour-stamp/debug":258,"vigour-util/is/obj":291}],212:[function(require,module,exports){"use strict";var _subscribe=require("vigour-state/subscribe");var serialize=require("./serialize");var parse=require("./parse");var vstamp=require("vigour-stamp");var dummy=function dummy(){};var hash=require("quick-hash");exports.define={subscribe:function subscribe(subs,update,tree,stamp,client,id){console.log("yo subscribe",subs);if(!update){update=dummy}var hashed;var added;var clients;if(client&&client.isClient){var doit=function doit(client,state,type,stamp,subs,tree,sType){var src=vstamp.src(stamp);if(client.key!==src){client.send(state,type,stamp,subs,tree,sType)}};hashed=hash(JSON.stringify(subs));console.log(hashed);console.log(this.emitters.subscription&&this.emitters.subscription.attach&&this.emitters.subscription.attach.keys());subs=parse(subs,this);clients=[client];
update=function update(state,type,stamp,subs,tree,sType){if(state.syncDown){var _stamp=state.stamp;if(_stamp){var src=vstamp.src(_stamp);if(client.key!==src){client.send(state,type,_stamp,subs,tree,sType)}}}}}if(!added){tree=_subscribe(this,subs,update,tree,stamp,client,id)}if(!added&&hashed){this._emitters.subscription.attach[this._emitters.subscription._id].hashed=hashed;this._emitters.subscription.attach[this._emitters.subscription._id].clients=clients}if(!client||!client.isClient){var hub=this.root;var hubSubs=hub.subscriptions;if(!hubSubs){hubSubs=hub.subscriptions={}}var path=this.realPath(false,true);if(path.length>0){console.log("subs -- need to resolve path -- do a bit later")}else{if(!id){id=this._emitters.subscription._id}hubSubs[id]=serialize(this,subs)}hub.client.origin().sendMeta()}return tree}}},{"./parse":213,"./serialize":214,"quick-hash":81,"vigour-stamp":260,"vigour-state/subscribe":279}],213:[function(require,module,exports){"use strict";var isFn=/^\$fn-/;var dummy=function dummy(){return function(){return false}};module.exports=function(subs){subs=parse(subs);return subs};function parse(obj,state){var result={};for(var i in obj){if(isFn.test(i)){var val=obj[i];i=i.slice(4);try{obj[i]=new Function("return "+val)()}catch(e){obj[i]=dummy}}if(i==="val"||i==="exec"){result[i]=obj[i]}else{result[i]=parse(obj[i])}}return result}},{}],214:[function(require,module,exports){"use strict";module.exports=function serializeSubscription(state,subs){return parse(subs)};function parse(obj,last,top){var result={};for(var i in obj){if(i!=="_"){if(i==="exec"&&typeof obj[i]==="function"){var val=obj[i].toString();if(!/^(function|\()/.test(val)){val="function "+val}result["$fn-"+i]=val}else if(i==="val"){if(obj._&&obj._.sync){console.log("resolve it");if(obj._.sync.val){result[i]=obj._.sync.val}}else{result[i]=obj[i]}}else{result[i]=parse(obj[i])}}}return result}},{}],215:[function(require,module,exports){"use strict";exports.properties={syncUp:true,syncDown:true,sync:function sync(val){return this.set({syncUp:val,syncDown:val},false)}};exports.syncUp=true;exports.syncDown=true},{}],216:[function(require,module,exports){"use strict";function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var WsClient=require("websocket").w3cwebsocket;var vstamp=require("vigour-stamp");var _require=require("clocksy");var ClocksyClient=_require.ClocksyClient;var incomingOffset=require("../offset/client").incoming;module.exports=function connect(hub,url,reconnect){var socket=new WsClient(url);var id=hub.id;hub.set({clients:_defineProperty({},id,{id:id,socket:socket})},false);var client=hub.clients[id];hub.set({client:client},false);client.sendMeta();hub.reconnect=null;var clocksy=new ClocksyClient({sendRequest:function sendRequest(req){return socket.send(JSON.stringify({type:"clock",data:req}))}});socket.onerror=function(){return socket.close()};socket.onmessage=function(data){var str=data.data;data=JSON.parse(data.data);if(data){if(data.type==="clock"){incomingOffset(hub,socket,data,clocksy)}else{if(str.length>1e4){var d=Date.now();hub.receive(data);console.log(Date.now()-d,"ms")}else{hub.receive(data)}hub.receive(data)}}};socket.onopen=function(){delete socket.offset;clocksy.start()};socket.onclose=function(){clocksy.stop();if(vstamp.offsetConnection===socket){delete vstamp.offsetConnection}if(hub.connected){var stamp=vstamp.create("disconnect",hub.id);hub.set({connected:false},stamp);vstamp.close(stamp);if(!socket.blockReconnect){reconnect=Math.min(reconnect*1.5|0,2e3);hub.reconnect=setTimeout(connect,reconnect,hub,url,reconnect)}}};hub.upstream=socket}},{"../offset/client":207,clocksy:72,"vigour-stamp":260,websocket:82}],217:[function(require,module,exports){"use strict";var _connect=require("./connect");exports.properties={upstream:true,reconnect:true,queue:true,url:{sync:false,on:{data:{connect:function connect(data,stamp){var hub=this.cParent();var val=this.compute();if(hub.upstream){if(hub.reconnect){clearTimeout(hub.reconnect);hub.reconnect=null}hub.upstream.blockReconnect=true;hub.upstream.close()}hub.set({connected:false},stamp);if(val){_connect(hub,val,50)}}}}},connected:{sync:false,on:{data:{clients:function clients(val,stamp){var hub=this.cParent();if(this.compute()===false&&hub.upstream){var clients=hub.clients;if(clients&&clients.keys().length>1){clients.each(function(client){if(client.val!==null&&!client.socket&&client.key!=hub.id){client.remove(stamp)}})}}}}}}}},{"./connect":216}],218:[function(require,module,exports){"use strict";var getParent=require("brisky-core/lib/render/dom/parent");var props=require("brisky-core/lib/render/static").property;var Property=require("brisky-core/lib/property").Constructor;exports.properties={props:new Property({render:{static:props,state:function state(target,_state,type,stamp,subs,tree,id,pid){var pnode=getParent(type,stamp,subs,tree,pid);if(pnode&&!pnode._propsStaticParsed){props(target,pnode);pnode._propsStaticParsed=true}}},child:{properties:{name:true},render:{static:function _static(target,pnode){var val=target.compute();if(val===target){pnode.removeAttribute(target.name||target.key)}else{pnode.setAttribute(target.name||target.key,val)}},state:function state(target,_state2,type,stamp,subs,tree,id,pid){var pnode=getParent(type,stamp,subs,tree,pid);var key=target.name||target.key;if(type==="remove"){if(pnode){pnode.removeAttribute(key)}}else{var val=target.compute(_state2);if(typeof val==="boolean"){val=val+""}if(val===_state2||val===target){if(pnode.getAttribute(key)){pnode.removeAttribute(key)}}else{if(pnode.getAttribute(key)!=val){pnode.setAttribute(key,val)}}}}}},properties:{type:null,value:{render:{static:function _static(target,pnode){var val=target.compute();pnode.value=val},state:function state(target,_state3,type,stamp,subs,tree,id,pid){var pnode=getParent(type,stamp,subs,tree,pid);if(type==="remove"){if(pnode){pnode.value=""}}else{var val=target.compute(_state3);if(val!==pnode.value){pnode.value=val===target?"":val}}}}}}})}},{"brisky-core/lib/property":143,"brisky-core/lib/render/dom/parent":150,"brisky-core/lib/render/static":155}],219:[function(require,module,exports){"use strict";var getParent=require("brisky-core/lib/render/dom/parent");var props=require("brisky-core/lib/render/static").property;var ua=require("vigour-ua/navigator");exports.types={style:require("./type")};exports.properties={style:{type:"property",render:{static:function _static(target,pnode){props(target,pnode)},state:function state(target,_state,type,stamp,subs,tree,id,pid){if(type!=="remove"){var pnode=getParent(type,stamp,subs,tree,pid);if(!pnode._styleStaticParsed){props(target,pnode);pnode._styleStaticParsed=true}}}},inject:[require("./px"),require("./transform")],child:{type:"style"},properties:{order:{name:ua.browser==="ie"&&ua.version===10?"msFlexOrder":"order"}}}}},{"./px":220,"./transform":221,"./type":222,"brisky-core/lib/render/dom/parent":150,"brisky-core/lib/render/static":155,"vigour-ua/navigator":282}],220:[function(require,module,exports){"use strict";var getParent=require("brisky-core/lib/render/dom/parent");var unit=require("./util").appendUnit;var pxval={type:"px"};var properties={};var pxprops=["width","height","left","right","bottom","top","margin","padding"];for(var i=0;i<pxprops.length;i++){properties[pxprops[i]]=pxval}exports.types={px:{type:"style",render:{static:function _static(target,pnode){pnode.style[target.key]=unit(target.compute(),"px")},state:function state(target,_state,type,stamp,subs,tree,id,pid){if(type!=="remove"){var pnode=getParent(type,stamp,subs,tree,pid);pnode.style[target.key]=unit(_state?target.compute(_state):target.compute(),"px")}}}}};exports.properties=properties},{"./util":223,"brisky-core/lib/render/dom/parent":150}],221:[function(require,module,exports){"use strict";var getParent=require("brisky-core/lib/render/dom/parent");var prefix=require("vigour-ua/navigator").prefix;var transform=prefix?prefix+"Transform":"transform";var unit=require("./util").appendUnit;exports.properties={transform:{type:"group",render:{static:function _static(target,node,store){var val=target.compute();if(!val||typeof val!=="string"){val=""}setTransform(val,store,node)},state:function state(target,_state,type,stamp,subs,tree,id,pid,store){var val=_state&&target.$?target.compute(_state):target.compute();if(!val||typeof val!=="string"){val=""}var node=getParent(type,stamp,subs,tree,pid);setTransform(val,store,node)}}}};function setTransform(val,store,node){if("x"in store||"y"in store){var x=store.x||0;var y=store.y||0;if(x){x=unit(x,"px")}if(y){y=unit(y,"px")}var translate3d="translate3d("+x+", "+y+", 0px)";val=val?val+" "+translate3d:translate3d}if("scale"in store){var scale="scale("+store.scale+")";val=val?val+" "+scale:scale}if("rotate"in store){var rotate="rotate("+store.rotate+"deg)";val=val?val+" "+rotate:rotate}node.style[transform]=val}},{"./util":223,"brisky-core/lib/render/dom/parent":150,"vigour-ua/navigator":282}],222:[function(require,module,exports){"use strict";var getParent=require("brisky-core/lib/render/dom/parent");exports.properties={name:true};exports.type="property";exports.render={static:function _static(target,pnode){pnode.style[target.name||target.key]=target.compute()},state:function state(target,_state,type,stamp,subs,tree,id,pid){if(type!=="remove"){var pnode=getParent(type,stamp,subs,tree,pid);pnode.style[target.name||target.key]=_state?target.compute(_state):target.compute()}}}},{"brisky-core/lib/render/dom/parent":150}],223:[function(require,module,exports){"use strict";var isNumber=require("vigour-util/is/numberlike");exports.appendUnit=function(val,unit){return isNumber(val)?val+unit:val}},{"vigour-util/is/numberlike":290}],224:[function(require,module,exports){"use strict";module.exports=require("brisky-core");module.exports.prototype.inject(require("brisky-events/lib/rightclick"),require("brisky-events/lib/basic"),require("brisky-events/lib/force"),require("brisky-events/lib/hover"),require("brisky-events/lib/drag"),require("brisky-events/lib/key"),require("brisky-props"),require("brisky-class"),require("brisky-focus"),require("brisky-style"))},{"brisky-class":138,"brisky-core":139,"brisky-events/lib/basic":175,"brisky-events/lib/drag":178,"brisky-events/lib/force":182,"brisky-events/lib/hover":185,"brisky-events/lib/key":187,"brisky-events/lib/rightclick":192,"brisky-focus":198,"brisky-props":218,"brisky-style":219}],225:[function(require,module,exports){"use strict";require("./");var brender=require("brisky-core/render");var ua=require("vigour-ua/navigator");var parser=require("case-parser");var uacases=require("ua-cases");var cases=uacases(ua);module.exports=function render(elem,state,casesArg,cb,id,attach){if(typeof casesArg==="function"){cb=casesArg}if(casesArg){for(var i in casesArg){cases[i]=casesArg[i]}}elem=parser(elem,cases);addClasses(elem);return brender(elem,state,cb,id,attach)};function addClasses(elem){var elemClass=elem.class;var classes=elemClass?typeof elemClass==="string"?{val:elemClass}:elemClass:{};for(var i in cases){if(cases[i]){classes[i.slice(1)]=true}}if(ua.webview==="cordova"){classes.cordova=true}elem.class=classes}},{"./":224,"brisky-core/render":173,"case-parser":71,"ua-cases":280,"vigour-ua/navigator":282}],226:[function(require,module,exports){"use strict";var _bluebird=require("bluebird");var _bluebird2=_interopRequireDefault(_bluebird);var _typeof2=require("babel-runtime/helpers/typeof");var _typeof3=_interopRequireDefault(_typeof2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var vstamp=require("vigour-stamp");exports.define={is:function is(val,callback,id,stamp,attach){var type=typeof val==="undefined"?"undefined":(0,_typeof3.default)(val);var parsed=this.val;var _this=this;var compare,promise;if(type==="function"){compare=val}else{compare=function compare(_compare){return!val&&val===null?_compare===val:_compare==val}}if(!callback){promise=new _bluebird2.default(function(resolve,reject){callback=function callback(data,stamp){vstamp.done(stamp,function(){return _this.off("data",id===void 0?is:id)});resolve(_this,data,stamp)}})}if(compare.call(_this,parsed,void 0,stamp,_this)){if(callback){callback.call(_this,parsed,stamp,_this)}}else{if(attach){attach=[is,attach];_this=_this.on("data",attach,id)}else{_this=_this.on("data",is,id)}}function is(data,stamp){if(compare.call(_this,_this.val,data,stamp,_this)){if(attach){vstamp.done(stamp,function(){return _this.off("data",attach)})}else{vstamp.done(stamp,function(){return _this.off("data",id===void 0?is:id)})}callback.call(_this,data,stamp,_this)}}return promise||_this}}},{"babel-runtime/helpers/typeof":3,bluebird:69,"vigour-stamp":260}],227:[function(require,module,exports){"use strict";module.exports=function execAttach(listeners,emitter,bind,val,stamp){var keys=listeners._keys;for(var i=0,len=keys.length;i<len;i++){var property=listeners[keys[i]];property[0].call(bind,val,stamp,property[1])}}},{}],228:[function(require,module,exports){"use strict";module.exports=function execBase(listeners,emitter,bind,val,stamp){var type=emitter.key;if(type!=="data"){execBaseType(type,listeners,emitter,bind,val,stamp)}else{var keys=listeners._keys||listeners.keys();for(var i=0,len=keys.length;i<len;i++){var property=listeners[keys[i]];if(property._emitters.data){property._emitters.data.emit(property,val,stamp)}}}};function execBaseType(type,listeners,emitter,bind,val,stamp){var keys=listeners._keys||listeners.keys();for(var i=0,len=keys.length;i<len;i++){var property=listeners[keys[i]];if(property._emitters[type]){property._emitters[type].emit(property,val,stamp)}}}},{}],229:[function(require,module,exports){"use strict";var emit=require("./emit");function getContextLevel(target,parent,index){var i=0;while(target){if(target.instances&&target.instances[index]===parent){return i}i++;target=target._parent}}function setContext(target,instance,bind,val,stamp,emitter,cLevel){var restore=void 0;var restoreLevel=void 0;if(target.__c){restore=target.__c;restoreLevel=target._cLevel}target.__c=instance;target._cLevel=cLevel;emit(emitter,bind,val,stamp);emitContext(instance,bind,val,stamp,emitter,void 0,cLevel,instance);target.__c=restore||null;target._cLevel=restoreLevel||null}function emitContext(parent,bind,val,stamp,emitter,context,seed,p){var parentInstances;while(parent&&!parent.noContext){parentInstances=parent.instances;var cLevel=void 0;if(parentInstances){for(var i=0,len=parentInstances.length;i<len;i++){var instance=parentInstances[i];if(!context||instance===context){if(seed){if(!cLevel){cLevel=getContextLevel(p,instance,i)}if(cLevel){setContext(p,instance,bind,val,stamp,emitter,cLevel)}else{setContext(bind,instance,bind,val,stamp,emitter,seed)}}else{if(!cLevel){cLevel=getContextLevel(bind,instance,i)}if(cLevel){setContext(bind,instance,bind,val,stamp,emitter,cLevel)}}}}parent=null}else{parent=parent._parent}}}module.exports=emitContext},{"./emit":230}],230:[function(require,module,exports){"use strict";var execAttach=require("./attach");var execBase=require("./base");module.exports=function emit(emitter,bind,val,stamp){var fn=emitter.fn;var attach=emitter.attach;if(!bind.__c){var base=emitter.base;if(base){execBase(base,emitter,bind,val,stamp)}}if(fn){var keys=fn._keys;for(var i=0,len=keys.length;i<len;i++){var target=fn[keys[i]];if(target){target.call(bind,val,stamp)}}}if(attach){execAttach(attach,emitter,bind,val,stamp)}}},{"./attach":227,"./base":228}],231:[function(require,module,exports){"use strict";var emitContext=require("./context");var _emit=require("./emit");var Base=require("vigour-base");var emitInstances=require("./instances");exports.define={generateConstructor:function generateConstructor(){return function Emitter(val,stamp,parent,key){this._k="_"+key;return Base.apply(this,arguments)}},eInstances:emitInstances.universal,emit:function emit(bind,val,stamp){var parent=bind._parent;if(parent){var context=bind.__c;if(!bind.noContext){emitContext(parent,bind,val,stamp,this,context)}if(!context){var instances=bind.instances;if(instances){this.eInstances(instances,bind,val,stamp)}_emit(this,bind,val,stamp)}}else{var _instances=bind.instances;if(_instances){this.eInstances(_instances,bind,val,stamp)}_emit(this,bind,val,stamp)}}}},{"./context":229,"./emit":230,"./instances":232,"vigour-base":92}],232:[function(require,module,exports){"use strict";var emitContext=require("./context");var emit=require("./emit");function universal(instances,bind,val,stamp){var len=instances.length;var key=this._k;for(var i=0;i<len;i++){var instance=instances[i];var on=instance._emitters;var iEmitter=on&&on[key];if(iEmitter){emitInstance(this,iEmitter,instance,val,stamp)}}}function emitInstance(emitter,iEmitter,instance,val,stamp,emitInstances){var parent=instance._parent;var instances=instance.instances;if(iEmitter!==emitter){emit(iEmitter,instance,val,stamp);if(instances){iEmitter.eInstances(instances,instance,val,stamp)}if(parent){emitContext(parent,instance,val,stamp,iEmitter)}}else{if(instances){emitter.eInstances(instances,instance,val,stamp)}emit(emitter,instance,stamp,val);if(parent){emitContext(parent,instance,val,stamp,emitter)}}}exports.instance=emitInstance;exports.universal=universal},{"./context":229,"./emit":230}],233:[function(require,module,exports){"use strict";module.exports=function id(base,val){if(val&&val.isBase){return val.uid()}else{return base._id?++base._id:base._id=1}}},{}],234:[function(require,module,exports){"use strict";var Base=require("vigour-base");module.exports=new Base({inject:[require("./storage"),require("./off"),require("./set"),require("./on"),require("./once"),require("./emit")],define:{isEmitter:true},noReference:true}).Constructor},{"./emit":231,"./off":236,"./on":237,"./once":238,"./set":239,"./storage":240,"vigour-base":92}],235:[function(require,module,exports){"use strict";var Base=require("vigour-base");var ListensStore=module.exports=new Base({noContext:true,noReference:true}).Constructor;ListensStore.Attach=new ListensStore({define:{removeProperty:function removeProperty(property,key){var store=property.attach;var keys=store._keys;if(keys){for(var i=0,len=keys.length;i<len;i++){var storeKey=keys[i];if(store[storeKey]&&store[storeKey][1]===this._parent){store.removeProperty(store[storeKey],storeKey)}}}this[key]=null}}}).Constructor;ListensStore.Base=new ListensStore({define:{removeProperty:function removeProperty(property,key){var store=property.base;var keys=store._keys;if(keys){for(var i=0,len=keys.length;i<len;i++){var storeKey=keys[i];if(store[storeKey]&&store[storeKey]===this._parent){store.removeProperty(store[storeKey],storeKey)}}if(key!=="_parent"&&key!=="key"){this[key]=null}}}}}).Constructor},{"vigour-base":92}],236:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var isObj=require("vigour-util/is/obj");var findType=require("./type");exports.define={off:function off(val,nocontext){var emitter=this;var context=emitter.__c;var type=typeof val==="undefined"?"undefined":_typeof(val);var storageKey,storage;if(type==="string"||type==="number"){storageKey=findType(val,emitter);if(!nocontext){emitter=resolveContext(emitter,context,storageKey)}storage=emitter[storageKey];if(storage){storage.removeProperty(storage[val],val,false,true)}}else if(val instanceof Array){(function(){storage=emitter.attach;var len=val.length;storage.each(function(p,key){var wrong;for(var i=0;i<len;i++){if(p[i]!==val[i]){wrong=true;break}}if(!wrong){storage.removeProperty(key,val,false,true);return true}})})()}else{findAndRemove(emitter,val,nocontext)}}};function resolveContext(emitter,context,storageKey){if(context){var base=emitter.parent.parent;var type=emitter.key;var setObj={on:{}};setObj.on[type]={};emitter=(base.set(setObj)||base).emitters[type]}if(!emitter.hasOwnProperty(storageKey)){emitter.setKey(storageKey,{},false)}return emitter}function removeFromStorage(storage,val,emitter,field,nocontext){if(storage){var check=val.check;if(check){storage.each(function(compare,key){if(check(compare)){emitter.off(key,nocontext)}})}else if(field!==void 0){storage.each(function(compare,key){if(compare[field]===val){emitter.off(key,nocontext)}})}else{storage.each(function(compare,key){if(compare===val){emitter.off(key,nocontext)}})}}}function findAndRemove(emitter,val,nocontext){if(isObj(val)){if(val.fn){removeFromStorage(emitter.fn,val.fn,emitter,void 0,true)}if(val.attach){removeFromStorage(emitter.attach,val.attach,emitter,typeof val.attach==="function"?0:1,true)}if(val.base){removeFromStorage(emitter.base,val.base,emitter,void 0,true)}}else if(typeof val==="function"){removeFromStorage(emitter.fn,val,emitter,void 0,true);removeFromStorage(emitter.attach,val,emitter,0,true)}else if((typeof val==="undefined"?"undefined":_typeof(val))==="object"&&val.isBase){removeFromStorage(emitter.base,val,emitter,void 0,true);removeFromStorage(emitter.attach,val,emitter,1,true)}}},{"./type":241,"vigour-util/is/obj":291}],237:[function(require,module,exports){"use strict";var vstamp=require("vigour-stamp");var listens=require("./listens");var ListensOnattach=listens.Attach;var ListensOnBase=listens.Base;var id=require("./id");var Base=require("vigour-base");function hasKeyInOther(target,type,key){var keys=target.keys();if(keys.length>1||keys.length&&!target[type]){target.each(function(p,pkey){if(pkey!==type){if(p[key]){p.removeProperty(key);return true}}})}}exports.define={on:function on(val,key,unique,stamp){var hasKey;if(!key){key=id(this,val)}else{hasKey=true}if(!key){key=id(this,val)}if(typeof val==="function"){add(this,"fn",val,key,unique,stamp);if(hasKey){hasKeyInOther(this,"fn",key)}}else if(val instanceof Base){if(!add(this,"base",val,key,unique||true,stamp)){if(!val.listensOnBase){val.setKeyInternal("listensOnBase",new ListensOnBase(void 0,void 0,val),false)}else if(!val.hasOwnProperty("listensOnBase")){val.setKeyInternal("listensOnBase",new val.listensOnBase.Constructor(void 0,void 0,val),false)}var listensOnBase=val.listensOnBase;var _key=id(listensOnBase);listensOnBase[_key]=this;listensOnBase.addKey(_key,this);if(hasKey){hasKeyInOther(this,"base",_key)}}}else if(val instanceof Array){if(!add(this,"attach",val,key,unique,stamp)){if(val.length>2){val[2]=val.slice(1);val=val.slice(0,2)}var passedOnBased=val[1];if(passedOnBased instanceof Base){if(!passedOnBased.listensOnAttach){passedOnBased.setKeyInternal("listensOnAttach",new ListensOnattach(void 0,void 0,passedOnBased),false)}else if(!passedOnBased.hasOwnProperty("listensOnAttach")){passedOnBased.setKeyInternal("listensOnAttach",new passedOnBased.listensOnAttach.Constructor(void 0,void 0,passedOnBased),false)}var listensOnAttach=passedOnBased.listensOnAttach;var _key2=id(listensOnAttach);listensOnAttach[_key2]=this;listensOnAttach.addKey(_key2,this)}if(hasKey){hasKeyInOther(this,"attach",key)}}}}};function parseUnique(emitterType,val,emitter,key,type,unique){var isFn=typeof unique==="function";var stop;if(isFn){emitterType.each(function(listener){if(!unique.call(emitter,listener,val)){return stop=true}})}else{if(type==="attach"&&unique===true){emitterType.each(function(listener){if(listener[1]===val[1]){return stop=true}})}if(type==="base"&&typeof key!=="string"){stop=emitterType[key]}else{emitterType.each(function(listener){if(listener===val){return stop=true}})}}if(stop){return true}}function resolve(emitter,type,key){if(!emitter.hasOwnProperty(type)){emitter.setKey(type,{},false)}var listener=emitter[type][key];if(listener){emitter[type].removeProperty(listener,key,true)}}function addInternal(emitter,type,key,val){var storage=emitter[type];if(storage){storage[key]=val;storage.addKey(key,val)}}function add(emitter,type,val,key,unique,stamp){var emitterType=emitter[type];if(!emitterType){if(stamp){vstamp.on(stamp,function(){if(!emitter[type]){emitter.setKey(type,void 0,false)}else{resolve(emitter,type,key)}addInternal(emitter,type,key,val)});return}else{emitter.setKey(type,void 0,false);addInternal(emitter,type,key,val);return}}else if(unique){if(parseUnique(emitterType,val,emitter,key,type,unique)){return true}}if(stamp){resolve(emitter,type,key);vstamp.on(stamp,function(){return addInternal(emitter,type,key,val)})}else{resolve(emitter,type,key);addInternal(emitter,type,key,val)}}},{"./id":233,"./listens":235,"vigour-base":92,"vigour-stamp":260}],238:[function(require,module,exports){"use strict";var vstamp=require("vigour-stamp");exports.define={once:function once(listener,key,unique,stamp){var _this=this;var _once2,done;var emitter=this;if(typeof listener==="function"){_once2=function once(val,stamp){if(!done){emitter.clearContext();vstamp.done(stamp,function(){return emitter.off(_once2)});done=true;listener.call(_this,val,stamp)}}}else if(listener.isBase){(function(){var type=_this.key;_once2=function _once(val,stamp){if(!done){vstamp.done(stamp,function(){return emitter.off(_once2)});done=true;listener.emit(type,val,stamp)}}})()}else if(listener instanceof Array){(function(){_once2=listener;var internal=listener[0];listener[0]=function(val,stamp){if(!done){vstamp.done(stamp,function(){return emitter.off(_once2)});done=true;internal.call(this,val,stamp,listener[1])}}})()}return this.on(_once2,key,unique,stamp)}}},{"vigour-stamp":260}],239:[function(require,module,exports){"use strict";var isObj=require("vigour-util/is/plainobj");var isNumberLike=require("vigour-util/is/numberlike");exports.define={set:function set(val,stamp,nocontext){if(isObj(val)&&!(val instanceof Array)){_set(this,val,stamp,nocontext)}else{this.on(val,"val",void 0,stamp,void 0,nocontext)}return this}};function _set(emitter,val,stamp,nocontext){var props=emitter.properties;for(var key in val){if(props[key]){props[key].call(emitter,val[key],stamp,nocontext,key)}else{if(!emitter._id&&isNumberLike(key)){emitter._id=Number(key)}if(val[key]===null){emitter.off(key)}else{emitter.on(val[key],key,void 0,stamp,void 0,nocontext)}}}}},{"vigour-util/is/numberlike":290,"vigour-util/is/plainobj":292}],240:[function(require,module,exports){"use strict";var Base=require("vigour-base");var Storage=new Base({noContext:true,properties:{val:null},define:{removeProperty:_removeProperty}}).Constructor;var attach=new Storage({define:{removeProperty:function removeProperty(property,key,blockRemove){_removeProperty.call(this,property,key,blockRemove)}}});var base=new Storage({define:{removeProperty:function removeProperty(property,key,blockRemove){cleanListens(property,"listensOnBase",this,true);return _removeProperty.call(this,property,key,blockRemove)}}});exports.child=Storage;exports.properties={attach:attach,base:base};function cleanListens(property,field,storage,base){if(property instanceof Base){var emitter=storage._parent;removeFromListens(property[field],emitter,base)}}function removeFromListens(listens,emitter,base){if(listens){var keys=listens._keys;for(var i=0;i<keys.length;i++){var key=keys[i];if(listens[key]===emitter){listens.removeKey(key,listens[key]);delete listens[key];if(base&&emitter._parent&&listens._parent.val===emitter._parent._parent){listens._parent.val=void 0}}}}}function _removeProperty(property,key,blockRemove){var target=this[key];if(target!==null){this.removeKey(key,target);this[key]=null}}},{"vigour-base":92}],241:[function(require,module,exports){"use strict";module.exports=function findType(key,emitter){var storageKey;if(emitter.fn&&emitter.fn[key]){storageKey="fn"}else if(emitter.base&&emitter.base[key]){storageKey="base"}else if(emitter.attach&&emitter.attach[key]){storageKey="attach"}return storageKey}},{}],242:[function(require,module,exports){"use strict";var Observable=require("./observable");Observable.prototype.inject(require("./operator"),false);module.exports=Observable},{"./observable":245,"./operator":254}],243:[function(require,module,exports){"use strict";var vstamp=require("vigour-stamp");var emitinstances=require("./emitinstances").universal;exports.define={emit:function emit(key,val,stamp){var created;if(stamp===void 0){stamp=vstamp.create();created=true}if(stamp){var _key="_"+key;var on=this._emitters;if(on){var emitter=on[_key]||on[key];if(emitter){emitter.emit(this,val,stamp)}else if(this.instances){emitinstances(this.instances,_key,key,stamp,val)}}if(created){vstamp.close(stamp)}}}}},{"./emitinstances":244,"vigour-stamp":260}],244:[function(require,module,exports){"use strict";exports.universal=function emitInstances(instances,_key,key,stamp,val){for(var i=0,len=instances.length;i<len;i++){var on=instances[i]._emitters;var emitter=on[_key]||on[key];if(emitter){emitter.emit(instances[i],val,stamp)}}};exports.data=function emitDataInstances(instances,stamp,val){for(var i=0,len=instances.length;i<len;i++){var on=instances[i]._emitters;var emitter=on._data||on.data;if(emitter){emitter.emit(instances[i],val,stamp)}}}},{}],245:[function(require,module,exports){"use strict";var Base=require("vigour-base");var Observable=module.exports=new Base({type:"observable",inject:[require("./on"),require("./emit"),require("./off"),require("./remove"),require("./set")],define:{isObservable:true,filter:function filter(key){if(key!=="emitters"&&key!=="listensOnAttach"&&key!=="listensOnBase"&&key[0]!=="$"){return true}}},instances:false,child:"Constructor"},false).Constructor;Observable.prototype.set({types:{observable:Observable.prototype,emitter:require("../emitter").prototype}},false)},{"../emitter":234,"./emit":243,"./off":246,"./on":247,"./remove":249,"./set":250,"vigour-base":92}],246:[function(require,module,exports){"use strict";exports.define={off:function off(type,val,event,nocontext){if(typeof type==="string"){if(!val){val="val"}var emitter=this.emitters&&this.emitters[type];if(emitter){emitter.off(val,void 0,nocontext)}}else{findAndRemove(this,type,val,nocontext)}}};function findAndRemove(target,val,key,nocontext){var emitters=target.emitters;if(emitters){if(key){var keys=emitters.keys();for(var i=0,len=keys.length;i<len;i++){emitters[keys[i]].off(key,nocontext)}}else{if(!val){emitters.remove()}else{var _keys=emitters.keys();for(var _i=0,_len=_keys.length;_i<_len;_i++){emitters[_keys[_i]].off(val,void 0,nocontext)}}}}}},{}],247:[function(require,module,exports){"use strict";function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var on=require("./on");exports.properties={define:{on:{val:on,key:"emitters"}},listensOnBase:true,listensOnAttach:true};exports.on={};exports.define={on:function on(type,val,key,unique,event,nocontext){if(this.val===null){return this}else if(typeof type!=="string"){return this.on("data",type,val,key,unique,event)}else{var observable=emitter(this,type);var emitters=observable._emitters;if(type!=="data"){type=emitters.properties.keyMap[type]||type}emitters[type].on(val,key,unique,event,nocontext);return observable}},once:function once(type,val,key,unique,event){if(this.val===null){return this}else if(typeof type!=="string"){return this.once("data",type,val,key,unique)}else{var observable=emitter(this,type);var emitters=observable._emitters;if(type!=="data"){type=emitters.properties.keyMap[type]||type}emitters[type].once(val,key,unique,event);return observable}}};function emitter(target,type){return target.set({emitters:_defineProperty({},type,{})},false)||target}},{"./on":248}],248:[function(require,module,exports){"use strict";var Base=require("vigour-base");var Emitter=require("../../emitter");var emitInstance=require("../../emitter/emit/instances").instance;module.exports=new Base({child:Emitter,properties:{data:new Emitter({define:{eInstances:function eInstances(instances,bind,stamp,val){var len=instances.length;for(var i=0;i<len;i++){var instance=instances[i];var on=instance._emitters;
var iEmitter=on&&on._data;if(iEmitter){emitInstance(this,iEmitter,instance,val,stamp)}}}}}),define:{remove:{val:new Emitter({define:{eInstances:function eInstances(instances,bind,stamp,val){var len=instances.length;for(var i=0;i<len;i++){var instance=instances[i];var on=instance._emitters;var iEmitter=on&&on._removeEmitter;if(iEmitter){emitInstance(this,iEmitter,instance,val,stamp)}}}}}),key:"removeEmitter"}}}})},{"../../emitter":234,"../../emitter/emit/instances":232,"vigour-base":92}],249:[function(require,module,exports){"use strict";var vstamp=require("vigour-stamp");exports.define={contextRemove:function contextRemove(key,stamp){var _this=this;var target=this[key];if(stamp){if(target.emitRemove){target.emitRemove(stamp)}vstamp.on(stamp,function(){_this.removeKey(key,target);_this[key]=null})}else{this.removeKey(key,target);this[key]=null}return this},emitRemove:function emitRemove(stamp,created,fromRemove){if(this.val===null){return}if(!this.__c){this.val=null}if(stamp){if(!created){var on=this._emitters;var emitter=on._data||on.data;var remitter=on._removeEmitter||on.removeEmitter;if(emitter){emitter.emit(this,null,stamp)}if(remitter){remitter.emit(this,null,stamp)}}}if(this._parent&&this._parent.isObservable){var parent=this.parent;if(!fromRemove){var _on=parent._emitters;if(_on){var _emitter=_on._data||_on.data;if(_emitter){_emitter.emit(parent,void 0,stamp)}}}}this.each(function(target,key){if(target.emitRemove){target.emitRemove(stamp,void 0,true)}})},extend:{remove:function remove(_remove,stamp,nocontext,noparent){var created;var target=this;if(target.__c){target=target.resolveContext({},stamp,this.__c)}if(stamp===void 0){stamp=vstamp.create();created=true}if(stamp){if(created){var on=this._emitters;var emitter=on._data||on.data;var remitter=on._removeEmitter||on.removeEmitter;target.emitRemove(stamp,created,void 0);if(emitter){emitter.emit(this,null,stamp)}if(remitter){remitter.emit(this,null,stamp)}vstamp.on(stamp,function(){_remove.call(target,false,nocontext,noparent)});vstamp.close(stamp)}else{target.emitRemove(stamp,created,void 0);vstamp.on(stamp,function(){_remove.call(target,false,nocontext,noparent)})}return target}else{return _remove.call(target,false,nocontext,noparent)}}}}},{"vigour-stamp":260}],250:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var vstamp=require("vigour-stamp");var emitinstances=require("./emitinstances").data;exports.define={handleReference:function handleReference(val,stamp,oldVal){var valIsObservable=(typeof val==="undefined"?"undefined":_typeof(val))==="object"&&"isObservable"in val;if(valIsObservable){this.val=val.on("data",this,void 0,void 0,stamp)}if(oldVal&&(typeof oldVal==="undefined"?"undefined":_typeof(oldVal))==="object"&&"isObservable"in oldVal){oldVal.off("data",{base:this})}},setValueInternal:function setValueInternal(val,stamp){var oldVal=this.val;this.val=val;this.handleReference(val,stamp,oldVal);return this},extend:{set:function set(_set,val,stamp,nocontext,isNew){var created;if(stamp===void 0){created=true;stamp=vstamp.create()}var base=_set.call(this,val,stamp,nocontext)||isNew&&this;if(stamp){if(base){var on=base._emitters;if(on){var emitter=on._data||on.data;if(emitter){emitter.emit(base,val,stamp)}else if(base.instances){emitinstances(base.instances,val,stamp)}}}if(created){vstamp.close(stamp)}}return base}}}},{"./emitinstances":244,"vigour-stamp":260}],251:[function(require,module,exports){"use strict";exports.type="$add";exports.operator=function(val,start,stamp,operator){return val+operator.compute.call(this,operator.val,val,start,stamp,operator)};exports.child="Constructor"},{}],252:[function(require,module,exports){"use strict";exports.define={extend:{compute:function compute(_compute,val,previous,start,stamp,attach){var original=val;var target=attach||this;val=_compute.call(this,val,previous,start,stamp,attach);var operators=target._keys.length>1&&target.keys("operator");if(operators&&operators.length>0){if(!start&&original){start=original}val=computeOperators(operators,this,val,start,stamp,attach)}if(val===void 0&&!("isOperator"in target)){val=target}return val}}};function setContext(operator,parent){if(operator._parent!==parent){operator.__c=parent;operator._cLevel=1}else if(parent.__c){operator.__c=parent.__c;operator._cLevel=parent._cLevel+1}}function computeOperators(operators,observable,val,start,stamp,attach){var target=attach||observable;if(!target._operatorResult){for(var i=0,len=operators.length;i<len;i++){var operator=target[operators[i]];var origc=operator.__c;var l=void 0;if(origc){l=operator._cLevel}setContext(operator,observable);var calc=operator.operator.call(observable,val,start,stamp,operator);if(origc){operator.__c=origc;operator._cLevel=l}if(calc===null){val=void 0}else if(calc!==void 0){val=calc}}}return val}},{}],253:[function(require,module,exports){"use strict";var Observable=require("../observable");module.exports=new Observable({type:"operator",keyType:"operator",properties:{operator:true},define:{isOperator:true},instances:false,on:{data:{updateParent:function updateParent(val,stamp){var parent=this.parent;if(parent&&parent.emit&&parent.val!==null){var on=parent._emitters;var emitter=on.data||on._data;if(emitter){emitter.emit(parent,val,stamp)}}}}}},false).Constructor},{"../observable":245}],254:[function(require,module,exports){"use strict";var Operator=require("./constructor");var transform=new Operator(require("./transform"),false);var add=new Operator(require("./add"),false);var prepend=new Operator(require("./prepend"),false);var type=new Operator(require("./type"),false);exports.inject=require("./compute");exports.properties={$transform:transform,$type:type,$add:add,$prepend:prepend};exports.types={operator:Operator.prototype,$transform:transform,$type:type,$add:add,$prepend:prepend}},{"./add":251,"./compute":252,"./constructor":253,"./prepend":255,"./transform":256,"./type":257}],255:[function(require,module,exports){"use strict";exports.type="$prepend";exports.operator=function(val,start,stamp,operator){return operator.compute.call(this,operator.val,val,start,stamp,operator)+val};exports.child="Constructor"},{}],256:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};exports.type="$transform";exports.operator=function(val,start,stamp,operator){var result=operator.compute.call(this,operator.val,val,start,stamp,operator);if(result&&(typeof result==="undefined"?"undefined":_typeof(result))==="object"){if(result.isBase){return result}else{var r=new this.Constructor(void 0,false);r._operatorResult=true;r.reset(false);r.set(result,false);return r}}return result};exports.child="Constructor"},{}],257:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var isNumberLike=require("vigour-util/is/numberlike");var isNumber=require("vigour-util/is/number");var isUrl=require("vigour-util/is/url");var isEmail=require("vigour-util/is/email");var number=/(.*?)(-?\d+(\.\d+)?)/;exports.type="$type";exports.properties={range:true};exports.operator=function(val,start,stamp,operator){var result;var type=operator.compute.call(this,operator.val,val,start,stamp,operator);if(operator.range){var ranges=operator.range;var min=void 0,max=void 0;min=ranges[0];max=ranges[1];var numberVal=getNumber(val);if(numberVal>=min&&numberVal<=max){result=numberVal}else{result=Math.abs(numberVal-max)<Math.abs(numberVal-min)?max:min}}else if(type==="boolean"){var valType=typeof val==="undefined"?"undefined":_typeof(val);if(val&&(val===true||valType==="string"||isNumberLike(val))){result=true}else{result=false}}else if(type==="url"){result=isUrl(val)?val:false}else if(type==="email"){result=isEmail(val)?val:false}else if(type==="string"){var _valType=typeof val==="undefined"?"undefined":_typeof(val);if(type===_valType){result=val}else if(_valType==="object"||val===false||val===void 0){result=""}else{result=val+""}}else if(type==="number"){result=getNumber(val)}return result};function toFloat(val){var match=val.match(number);return match&&match[2]||0}function getNumber(val){if(isNumber(val)){return val}else if(isNumberLike(val)){return Number(val)}else if(typeof val==="string"){return Number(toFloat(val)||0)}return 0}},{"vigour-util/is/email":286,"vigour-util/is/number":289,"vigour-util/is/numberlike":290,"vigour-util/is/url":294}],258:[function(require,module,exports){"use strict";module.exports=require("./lib/debug")},{"./lib/debug":259}],259:[function(require,module,exports){"use strict";module.exports=function(vstamp){var inProgress={};var create=vstamp.create;var close=vstamp.close;vstamp.create=function(type,src,override){var stamp=create(type,src,override);if(Object.keys(inProgress).length>0){throw new Error(stamp+" other stamps are still in progress: "+Object.keys(inProgress))}inProgress[stamp]=true;return stamp};vstamp.close=function(stamp){delete inProgress[stamp];return close(stamp)}}},{}],260:[function(require,module,exports){(function(global){"use strict";var previous=global.__vigourStamp__;global.__vigourStamp__=exports;var on=exports._on={};var done=exports._done={};exports.cnt=0;exports.version="1.5.1";exports.create=function(type,src,override){var stamp=override||++exports.cnt;if(type){stamp=type+"-"+stamp}if(src){stamp=src+"|"+stamp}return stamp};exports.on=function(stamp,fn){if(!on[stamp]){on[stamp]=[]}on[stamp].push(fn)};exports.done=function(stamp,fn){if(!done[stamp]){done[stamp]=[]}done[stamp].push(fn)};exports.close=function(stamp){var listeners=on[stamp];var doneListeners=done[stamp];if(listeners){for(var i=0;i<listeners.length;i++){listeners[i]()}delete on[stamp]}if(doneListeners){for(var _i=0;_i<doneListeners.length;_i++){doneListeners[_i]()}delete done[stamp]}};exports.remove=function(stamp){if(on[stamp]){delete on[stamp]}};exports.parse=function(stamp){var parsed={};var src=exports.src(stamp);var type=exports.type(stamp);if(src||type){if(src){parsed.src=src;if(type){parsed.type=type;parsed.val=stamp.slice(stamp.indexOf(type)+type.length+1)}else{parsed.val=stamp.slice(stamp.indexOf("|")+1)}}else{parsed.type=type;parsed.val=stamp.slice(stamp.indexOf(type)+type.length+1)}}else{parsed.val=stamp}return parsed};exports.src=function(stamp){if(typeof stamp==="string"){for(var i=1,len=stamp.length-2;i<len;i++){if(stamp.charAt(i)==="|"){return stamp.slice(0,i)}}}};exports.val=function(stamp){if(typeof stamp==="string"){for(var i=stamp.length-1;i>0;i--){if(stamp.charAt(i)==="-"){return stamp.slice(i+1)}}for(var _i2=1,len=stamp.length-2;_i2<len;_i2++){if(stamp.charAt(_i2)==="|"){return stamp.slice(_i2+1)}}return stamp}else{return stamp}};exports.hasSrc=function(stamp){if(typeof stamp==="string"){for(var i=1,len=stamp.length-2;i<len;i++){if(stamp.charAt(i)==="|"){return i}}}};exports.setSrc=function(stamp,val){return val+"|"+stamp};exports.type=function(stamp,src){if(typeof stamp==="string"){var index=void 0;if(!src){src=-1;for(var j=1;j<stamp.length-2;j++){if(stamp.charAt(j)==="|"){src=j;break}}}for(var i=stamp.length-2;i>src+1;i--){var char=stamp.charAt(i);if(char==="-"){index=i;break}}if(index){return stamp.slice(src+1,index)}}};exports.resolve=function(previous,current){console.log("stamp mismatch choosing highest compatible version",previous.version,"vs",current.version);if(previous.version&&current.version){var pv=previous.version.split(".");var cv=current.version.split(".");if(pv[0]!==cv[0]){throw new Error("incompatible major stamp versions "+previous.version+" vs "+current.version)}else{if(previous.version===current.version){return apply(previous,current)}else{if(cv[1]>pv[1]){return apply(previous,current)}else if(cv[1]<pv[1]){return apply(current,previous)}else if(cv[2]>pv[2]){return apply(previous,current)}else{return apply(current,previous)}}}}else{if(previous.version&&!current.version){return apply(current,previous)}else{return apply(previous,current)}}function apply(target,current){for(var i in current){target[i]=current[i]}return current}};if(previous){exports.resolve(previous,exports)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],261:[function(require,module,exports){"use strict";var Observable=require("vigour-observable");module.exports=new Observable({type:"state",inject:require("./inject"),child:"Constructor"},false).Constructor},{"./inject":262,"vigour-observable":242}],262:[function(require,module,exports){"use strict";var vstamp=require("vigour-stamp");var _subscribe=require("./subscribe");var keyHash=require("vigour-util/keyHash");module.exports={inject:[require("vigour-is"),require("./resubscribe")],properties:{stamp:true,_sid:true},stamp:0,define:{isState:{value:true},filter:function filter(key){return"isState"in this[key]},subscribe:function subscribe(subs,update,tree,stamp,attach,id){return _subscribe(this,subs,update,tree,stamp,attach,id)},sid:function sid(){if(!("_sid"in this)){if(!this.key||!this._parent){this._sid=1}else{this._sid=this.cParent().sid()+keyHash(this.key)}}return this._sid}},on:{data:{stamp:function stamp(val,_stamp){var _this=this;var parent=this.cParent();this.stamp=_stamp;if(this._subscriptions){(function(){var l=_this;vstamp.on(_stamp,function(){l.emit("subscription",val,_stamp)})})()}else{looper(parent,val,_stamp)}}}}};function looper(parent,val,stamp){while(parent&&parent.stamp!==stamp){lstampInner(parent,val,stamp);parent=parent.cParent()}}function lstampInner(parent,val,stamp){parent.stamp=stamp;if(parent._subscriptions){(function(){var l=parent;vstamp.on(stamp,function(){l.emit("subscription",val,stamp)})})()}else if(parent._emitters&&"base"in parent._emitters._data){if(parent._emitters._data.base){parent._emitters._data.base.each(function(p){looper(p,val,stamp)})}}}},{"./resubscribe":263,"./subscribe":267,"vigour-is":226,"vigour-stamp":260,"vigour-util/keyHash":295}],263:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};exports.define={resubscribe:function resubscribe(stamp){var _this=this;var emitters=this.emitters;if(this.hasOwnProperty("_emitters")&&(emitters.hasOwnProperty("subscription")||emitters.hasOwnProperty("_subscription"))){(function(){var subs=emitters.subscription;var fn=subs.hasOwnProperty("fn")&&subs.fn;var attach=subs.hasOwnProperty("attach")&&subs.attach;if(fn){fn.each(function(prop,key){if(fn.hasOwnProperty(key)){walkTree(prop.tree)}})}if(attach){attach.each(function(prop,key){if(attach.hasOwnProperty(key)){prop=prop[0];walkTree(prop.tree)}})}_this.emit("subscription",void 0,stamp)})()}}};function walkTree(tree){for(var key in tree){if(key==="$"){if(_typeof(tree[key])!=="object"&&tree._key!=="$any"){delete tree[key]}}else if(_typeof(tree[key])==="object"){if(key[0]!=="_"){if(!tree[key].isBase){walkTree(tree[key])}}}}}},{}],264:[function(require,module,exports){"use strict";var item=require("./item");var remove=require("./remove");module.exports=function any(target,subs,update,tree,stamp){var changed;if(target&&target.val!==null){var $=target.sid();if(!("$any"in tree)){tree.$any={_p:tree,_key:"$any",$:$}}else{if($!==tree.$any.$){var _keys=Object.keys(tree.$any);for(var i=0,len=_keys.length;i<len;i++){if(_keys[i]!=="_"&&_keys[i]!=="_p"&&_keys[i]!=="_key"&&_keys[i][0]!=="$"){remove(_keys[i],void 0,void 0,subs,update,tree.$any,tree.$any[_keys[i]],stamp);changed=true}}tree.$any={_p:tree,_key:"$any",$:$}}tree.$any.$=$}var keys=target._keys&&target.keys();if(keys&&keys.length){for(var _i=0,_len=keys.length;_i<_len;_i++){if(item(keys[_i],target,subs,update,tree.$any,stamp)){changed=true}}}else if(tree&&"$any"in tree){changed=removeExisting(changed,target,subs,update,tree,stamp)}}else if("$remove"in subs&&tree&&"$any"in tree){changed=removeExisting(changed,target,subs,update,tree,stamp)}return changed};function removeExisting(changed,target,subs,update,tree,stamp){var keys=Object.keys(tree.$any);for(var i=0,len=keys.length;i<len;i++){if(keys[i]!=="_"&&keys[i]!=="_p"&&keys[i]!=="_key"&&keys[i][0]!=="$"){remove(keys[i],target[keys[i]],target,subs,update,tree.$any,tree.$any[keys[i]],stamp);changed=true}}delete tree.$any;return changed}},{"./item":268,"./remove":272}],265:[function(require,module,exports){"use strict";var item=require("./item");module.exports=function(target,subs,update,tree,stamp,any){var changed;var c=tree.$c;for(var key in c){var s=subs;if(key in tree){if(/^\$pass/.test(key)){s=s["$test"+key.slice(5)];if("$pass"in s&&item(key,target,s.$pass,update,tree,stamp)){changed=true}}else{if((any||key in s)&&item(key,target,any?s:s[key],update,tree,stamp)){changed=true}}}}return changed}},{"./item":268}],266:[function(require,module,exports){"use strict";var item;module.exports=function diff(target,subs,update,tree,stamp,self){var changed;for(var key in subs){if(key!=="val"&&key!=="$"&&key!=="_"&&key!=="$remove"){if(item(key,target,subs[key],update,tree,stamp,self)){changed=true}}}return changed};item=require("./item")},{"./item":268}],267:[function(require,module,exports){"use strict";var diff=require("./diff");var val=require("./val");var valUpdate=val.update;var valCreate=val.create;module.exports=function(target,subs,update,tree,stamp,attach,id){var listener;if(!tree){tree={}}target._subscriptions=true;if(stamp===void 0){stamp=target._lstamp||0}if("val"in subs){listener=function listener(data,stamp){valUpdate(target,target,subs,update,tree,stamp)};valCreate(target,target,subs,update,tree,stamp)}else{listener=function listener(data,stamp){diff(target,subs,update,tree,stamp)};diff(target,subs,update,tree,stamp)}listener.tree=tree;if(attach){listener=[listener,attach]}target.on("subscription",listener,id);return tree}},{"./diff":266,"./val":278}],268:[function(require,module,exports){"use strict";var isTest=/^\$test/;var isSwitch=/^\$switch/;var any,struct,root,switcher,parent,$parent,test,diff;module.exports=function item(key,target,subs,update,tree,stamp,self){if(key[0]==="$"){if(key==="$root"){return root(target,subs,update,tree,stamp)}else if(key==="$any"){return any(target,subs,update,tree,stamp)}else if(key==="$self"){return diff(target,subs,update,tree,stamp,true)}else if(key==="$parent"){return $parent(target,subs,update,tree,stamp)}else if(isTest.test(key)){return test(key,target,subs,update,tree,stamp)}else if(isSwitch.test(key)){return switcher(key,target,subs,update,tree,stamp)}else if(key!=="$"&&key!=="$c"){return struct(key,target,subs,update,tree,key in tree&&tree[key],stamp,self)}}else if(key==="parent"){return parent(target,subs,update,tree,stamp)}else{return struct(key,target&&key in target&&target[key],subs,update,tree,key in tree&&tree[key],stamp,self)}};any=require("./any");struct=require("./struct");$parent=require("./parent/subscription");parent=require("./parent/origin");root=require("./root");switcher=require("./switch");test=require("./test");diff=require("./diff")},{"./any":264,"./diff":266,"./parent/origin":269,"./parent/subscription":270,"./root":273,"./struct":274,"./switch":276,"./test":277}],269:[function(require,module,exports){"use strict";var diff=require("../diff");var remove=require("../remove");module.exports=function parent(target,subs,update,tree,stamp){var parentTree=tree.parent;if(target&&target.val!==null){if(!parentTree){parentTree=tree.parent={_p:tree,_key:"parent"};composite(tree,"parent")}return diff(target.cParent(),subs,update,parentTree,stamp)}else if(parentTree&&"$remove"in subs){remove("parent",target,target,subs,update,tree,parentTree,stamp);return true}};function composite(tree,type){var key=type;while(tree._p){if(tree._key!==type){if(!tree.$c){tree.$c={}}tree.$c[key]=type;key=tree._key;tree=tree._p}else{tree=tree._p}}}},{"../diff":266,"../remove":272}],270:[function(require,module,exports){"use strict";var diff=require("../diff");var remove=require("../remove");module.exports=function parent(target,subs,update,tree,stamp){var parentTree=tree.$parent;if(target&&target.val!==null){if(!parentTree){parentTree=tree.$parent={_p:tree,_key:"$parent"};composite(tree,"$parent")}return diff(get(target,tree),subs,update,parentTree,stamp)}else if(parentTree&&"$remove"in subs){remove("$parent",target,target,subs,update,tree,parentTree,stamp);return true}};function get(target,tree){var path=[];var key="$parent";var parentcounter=1;while(tree._p){if(tree._key!=="$parent"){key=tree._key;tree=tree._p;if(key==="$root"){path.unshift("getRoot")}else if(key[0]!=="$"){parentcounter--;if(parentcounter<0){path.unshift(key,"origin")}}}else{parentcounter++;tree=tree._p}}return!path.length?target.getRoot():target.getRoot().get(path)}function composite(tree,type){var key=type;var parentcounter=1;while(tree._p&&parentcounter){if(tree._key!==type){if(!tree.$c){tree.$c={}}tree.$c[key]=type;key=tree._key;tree=tree._p;if(key[0]!=="$"){parentcounter--}}else{parentcounter++;tree=tree._p}}}},{"../diff":266,"../remove":272}],271:[function(require,module,exports){"use strict";var isEmpty=require("vigour-util/is/empty");module.exports=function removeComposite(tree,key){while(tree&&tree._p&&"$c"in tree&&tree.$c[key]){delete tree.$c[key];if(isEmpty(tree.$c)){delete tree.$c;key=tree._key;tree=tree._p}else{tree=false}}}},{"vigour-util/is/empty":287}],272:[function(require,module,exports){"use strict";var diff=require("../diff");var removeComposite=require("./composite");var isTest=/^\$test/;var test;var REMOVE="remove";module.exports=function remove(key,target,travelTarget,subs,update,tree,treeKey,stamp){if("$remove"in subs){diff(travelTarget,subs,update,treeKey,stamp)}else{for(var sub in subs){if(sub[0]==="$"){if(isTest.test(sub)){test(sub,target,subs[sub],update,treeKey,stamp)}}}}if("val"in subs){update(target,REMOVE,stamp,subs,treeKey)}if("$c"in tree){removeComposite(tree,key)}delete tree[key]};test=require("../test")},{"../diff":266,"../test":277,"./composite":271}],273:[function(require,module,exports){"use strict";var diff=require("./diff");var removeComposite=require("./remove/composite");module.exports=function root(target,subs,update,tree,stamp){var rootTree="$root"in tree&&tree.$root;if(target&&(!("val"in target)||target.val!==null)){if(!rootTree){rootTree=tree.$root={_key:"$root",_p:tree};addC(tree)}return diff(target.getRoot(),subs,update,rootTree,stamp)}else if("$remove"in subs){diff(target,subs,update,rootTree,stamp);removeComposite(tree,"$root");delete tree.$root;return true}};function addC(tree){var key="$root";while("_p"in tree&&(!("$c"in tree)||!(key in tree.$c)||tree.$c[key]!=="root")){if(!("$c"in tree)){tree.$c={}}tree.$c[key]="root";key=tree._key;tree=tree._p}}},{"./diff":266,"./remove/composite":271}],274:[function(require,module,exports){"use strict";var val=require("./val");var valUpdate=val.update;var valCreate=val.create;var simpleUpdate=val.simpleUpdate;var remove=require("./remove");var composite=require("./composite");module.exports=function struct(key,target,subs,update,tree,treeKey,stamp,self){var changed;if(target&&(!("val"in target)||target.val!==null)){var leafStamp=target.stamp+(target._sid||target.sid());var traveltarget=void 0;if(target.val&&!self&&target.val.isBase){traveltarget=target.origin()}else{traveltarget=target}if(!treeKey){treeKey=tree[key]={_p:tree,_key:key};treeKey.$=leafStamp;valCreate(target,traveltarget,subs,update,treeKey,stamp);changed=true}else{if(treeKey.$!==leafStamp){treeKey.$=leafStamp;valUpdate(target,traveltarget,subs,update,treeKey,stamp);changed=true}else if("$c"in treeKey){changed=composite(traveltarget,subs,update,treeKey,stamp);if(changed){simpleUpdate(target,subs,update,treeKey,stamp)}}}}else if(treeKey){remove(key,target,target,subs,update,tree,treeKey,stamp);changed=true}return changed}},{"./composite":265,"./remove":272,"./val":278}],275:[function(require,module,exports){"use strict";module.exports=function(target,subs,tree,key){if(target.compute()){var path=target.path();var eligable,level,length;for(var field in subs){if(field[0]!=="$"){if(!length){length=path.length}var glob=field.split(".");var l=glob.length;if(length>=l){if(!level||l>=level){var delta=length-l;var score=0;for(var i=l-1,weight=2;i>=0;i--){var _key=glob[i];weight++;if(_key===path[i+delta]){score+=weight}else if(_key==="*"){score+=1}else{break}}if(score){if(!eligable){eligable=[]}if(!(l in eligable)){eligable[l]=[]}eligable[l][score]=field;level=l}}}}}if(eligable){var candidates=eligable[level];return candidates[candidates.length-1]}}}},{}],276:[function(require,module,exports){"use strict";var remove=require("../remove");var removeComposite=require("../remove/composite");var val=require("../val");var switchCreate=val.switchCreate;var switchUpdate=val.switchUpdate;var struct=require("../struct");var globExec=require("./glob");module.exports=function switchStruct(key,target,subs,update,tree,stamp){var exec=subs.exec||globExec;var switchTree=tree[key];var changed;var switchKey=exec(target,subs,tree,key);var switcher=subs[switchKey];if(!switchTree){if(switcher){switchTree=tree[key]={_p:tree,_key:key};switchTree.$=switcher;switchTree.$target=target;switchCreate(target,subs,update,switchTree,stamp);struct("$current",target,switcher,update,switchTree,void 0,stamp);changed=true}}else{var init=void 0;if(switchTree.$!==switcher||switchTree.$target!==target){init=true;if("$"in switchTree){if("$remove"in switchTree.$){struct("$current",void 0,switchTree.$,update,switchTree,switchTree.$current,stamp)}else if("$c"in switchTree){removeComposite(tree,key)}if("$remove"in subs&&"$"in switchTree&&"$current"in switchTree){remove(key,switchTree.$target,void 0,switchTree.$,update,tree,switchTree.$current,stamp)}}switchTree=tree[key]={_p:tree,_key:key};switchTree.$target=target;if(switcher){switchTree.$=switcher}switchUpdate(target,subs,update,switchTree,stamp);changed=true}if(switcher){if(init){struct("$current",target,switcher,update,switchTree,void 0,stamp)}else{changed=struct("$current",target,switcher,update,switchTree,switchTree.$current,stamp)}}}return changed}},{"../remove":272,"../remove/composite":271,"../struct":274,"../val":278,"./glob":275}],277:[function(require,module,exports){"use strict";var struct=require("./struct");var remove=require("./remove");module.exports=function test(key,target,subs,update,tree,stamp){var conditionTree=tree[key];var passKey;if(key!=="$test"){passKey="$pass"+key.slice(5)}else{passKey="$pass"}var passTree=tree[passKey];var testSubs="$"in subs&&subs.$;var pass=subs.$pass;var exec=subs.exec;var change=testSubs?struct(key,target,testSubs,update,tree,conditionTree,stamp):true;if(change){if(exec(target,tree,key)){return struct(passKey,target,pass,update,tree,passTree,stamp)}else if(passTree){remove(passKey,target,void 0,pass,update,tree,passTree,stamp);return true}}else if(passTree){return struct(passKey,target,pass,update,tree,passTree,stamp)}}},{"./remove":272,"./struct":274}],278:[function(require,module,exports){"use strict";var diff=require("./diff");var INIT="new";var UPDATE="update";var REMOVE="remove";var SWITCH="switch";exports.update=function updateState(target,travelTarget,subs,update,tree,stamp){if("val"in subs&&subs.val===true){update(target,UPDATE,stamp,subs,tree)}diff(travelTarget,subs,update,tree,stamp)};exports.create=function create(target,travelTarget,subs,update,tree,stamp){if("val"in subs){update(target,INIT,stamp,subs,tree)}diff(travelTarget,subs,update,tree,stamp)};exports.simpleUpdate=function simpleUpdate(target,subs,update,tree,stamp){if("val"in subs&&subs.val===true){update(target,UPDATE,stamp,subs,tree)}};exports.switchCreate=function switchCreate(target,subs,update,tree,stamp){if("val"in subs){update(target,INIT,stamp,subs,tree,SWITCH)}};exports.switchUpdate=function switchUpdate(target,subs,update,tree,stamp){if("val"in subs&&subs.val===true){update(target,!target||target.val===null?REMOVE:UPDATE,stamp,subs,tree,SWITCH)}}},{"./diff":266}],279:[function(require,module,exports){"use strict";module.exports=require("./lib/subscribe")},{"./lib/subscribe":267}],280:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var ua=require("vigour-ua");var fields=["native","android","ios","windows","phone","tablet","touch","desktop","chromecast","tv","ie","ie10","edge","chrome","safari"];module.exports=function uacases(useragent,cases,transform){if((typeof cases==="undefined"?"undefined":_typeof(cases))!=="object"){cases={}}if(typeof useragent==="string"){useragent=ua(useragent)}for(var i=fields.length-1;i>=0;i--){var str=fields[i];cases["$"+str]=useragent.device===str||useragent.platform===str||useragent.browser===str||useragent.browser+useragent.version===str}if(useragent.webview){cases.$native=true}if(transform){cases=transform(cases,useragent)}return cases}},{"vigour-ua":281}],281:[function(require,module,exports){module.exports=exports=function(_ua,obj){if(typeof _ua==="string"){_ua=_ua.toLowerCase()}else{_ua=""}if(obj===true){obj=exports}else if(!obj){obj={}}var _ff="firefox";var _android="android";var _mobile=".+mobile";var _webkit="webkit";var _ps="playstation";var _xbox="xbox";var _linux="linux";var _castDetect="crkey";var _chromecast="cast";var _tablet="tablet";var _windows="windows";var _phone="phone";var _firetv="firetv";var _sticktv="sticktv";var _rikstv="rikstv";var _facebook="facebook";test.call(obj,_ua,function(query,arr){obj.browser=arr[2]||query;var _v=_ua.match(new RegExp("((([\\/ ]version|"+arr[0]+"(?!.+version))[/ ])| rv:)([0-9]{1,4}\\.[0-9]{0,2})"));obj.version=_v?Number(_v[4]):0;obj.prefix=arr[1]},[true,_webkit],["\\(windows","ms","ie"],["safari",_webkit],[_ff,"Moz"],["opera","O"],["msie","ms","ie"],[_facebook,_facebook],["chrome|crios/",_webkit,"chrome"],["edge",_webkit,"edge"]);test.call(obj,_ua,"platform",[true,_windows],[_linux,_linux],["lg.{0,3}netcast","lg"],[_ff+_mobile,_ff],["mac os x","mac"],["iphone|ipod|ipad","ios"],[_xbox,_xbox],[_ps,_ps],[_android,_android],[_windows,_windows],[_castDetect,_chromecast],["smart-tv;|;samsung;smarttv","samsung"],[_rikstv,_rikstv]);test.call(obj,_ua,"device",[true,"desktop"],[_windows+".+touch|ipad|"+_android,_tablet],["phone|iphone|("+_android+_mobile+")|("+_ff+_mobile+")|"+_windows+" phone|iemobile",_phone],[_xbox+"|"+_ps,"console"],["tv|smarttv|googletv|appletv|hbbtv|pov_tv|netcast.tv|webos.+large","tv"],[_castDetect,_chromecast],["tablet|amazon-fireos|nexus (?=[^1-6])\\d{1,2}",_tablet],["aftb|afts",_firetv],["aftm",_sticktv],[_rikstv,_rikstv]);test.call(obj,_ua,"webview",[true,false],["crosswalk","crosswalk"],["vigour-wrapper","wrapper"],["cordova","cordova"],["ploy-native","ploy-native"]);return obj;function test(_ua,fn){for(var tests=arguments,i=tests.length-1,query=tests[i][0];query!==true&&!new RegExp(query).test(_ua)&&i>0;query=tests[--i][0]);if(fn.slice||fn.call(this,query,tests[i])){this[fn]=tests[i][1]}}}},{}],282:[function(require,module,exports){"use strict";var ua=require("./");if(typeof window==="undefined"){ua.platform="node"}else{ua(window.navigator.userAgent,exports)}},{"./":281}],283:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{
value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}module.exports=define;function define(){var val;for(var i=0,length=arguments.length;i<length;i++){val=arguments[i];for(var key in val){var definition=val[key];var type=typeof definition==="undefined"?"undefined":_typeof(definition);if(key==="extend"&&type==="object"){extend(this,definition)}else{if(type==="function"||type!=="object"||"isBase"in definition){definition={value:definition}}else{if("val"in definition){definition.value=definition.val;delete definition.val}}if(definition.writable&&"value"in definition){this[key]=definition.value}else{definition.configurable=true;Object.defineProperty(this,key,definition)}}}}}function extend(target,val){var many;if("args"in val){many=true;delete val.args}for(var key in val){var type=_typeof(val[key]);if(type==="object"){var value={};var obj=val[key];for(var i in obj){value[i]=extension(obj[i],target[key][i],many)}val[key]=(target.define||define).call(target,_defineProperty({},key,{value:value}))}else if(type!=="function"){throw new Error('Expect function for extension "'+key+'"')}else{val[key]=(target.define||define).call(target,_defineProperty({},key,extension(val[key],target[key],many)))}}}function generateOptimized(val,target,len){var types=[function(){return val.call(this,target)},function(a){return val.call(this,target,a)},function(a,b){return val.call(this,target,a,b)},function(a,b,c){return val.call(this,target,a,b,c)},function(a,b,c,d){return val.call(this,target,a,b,c,d)},function(a,b,c,d,e){return val.call(this,target,a,b,c,d,e)},function(a,b,c,d,e,f){return val.call(this,target,a,b,c,d,e,f)},function(a,b,c,d,e,f,g){return val.call(this,target,a,b,c,d,e,f,g)},function(a,b,c,d,e,f,g,h){return val.call(this,target,a,b,c,d,e,f,g,h)}];return types[len]}function extension(val,target,many){if(!many){var len=Math.max(target.length,val.length-1);if(len>8){many=true}else{return generateOptimized(val,target,len)}}return function(){var len=arguments.length;var args=new Array(len+1);args[0]=target;for(var i=0;i<len;i++){args[i+1]=arguments[i]}return val.apply(this,args)}}},{}],284:[function(require,module,exports){"use strict";module.exports=function getAllPropertyDescriptors(props){var definitions={};var arr;var proto=props;while(proto){arr=Object.getOwnPropertyNames(proto);for(var i in arr){if(!definitions[arr[i]]){definitions[arr[i]]=Object.getOwnPropertyDescriptor(proto,arr[i])}}proto=Object.getPrototypeOf(proto)}return definitions}},{}],285:[function(require,module,exports){"use strict";module.exports=function(key,seed){var remainder,bytes,h1,h1b,c1,c2,k1,i;seed=1;remainder=key.length&3;bytes=key.length-remainder;h1=seed;c1=3432918353;c2=461845907;i=0;while(i<bytes){k1=key.charCodeAt(i)&255|(key.charCodeAt(++i)&255)<<8|(key.charCodeAt(++i)&255)<<16|(key.charCodeAt(++i)&255)<<24;++i;k1=(k1&65535)*c1+(((k1>>>16)*c1&65535)<<16)&4294967295;k1=k1<<15|k1>>>17;k1=(k1&65535)*c2+(((k1>>>16)*c2&65535)<<16)&4294967295;h1^=k1;h1=h1<<13|h1>>>19;h1b=(h1&65535)*5+(((h1>>>16)*5&65535)<<16)&4294967295;h1=(h1b&65535)+27492+(((h1b>>>16)+58964&65535)<<16)}k1=0;switch(remainder){case 3:k1^=(key.charCodeAt(i+2)&255)<<16;case 2:k1^=(key.charCodeAt(i+1)&255)<<8;case 1:k1^=key.charCodeAt(i)&255;k1=(k1&65535)*c1+(((k1>>>16)*c1&65535)<<16)&4294967295;k1=k1<<15|k1>>>17;k1=(k1&65535)*c2+(((k1>>>16)*c2&65535)<<16)&4294967295;h1^=k1}h1^=key.length;h1^=h1>>>16;h1=(h1&65535)*2246822507+(((h1>>>16)*2246822507&65535)<<16)&4294967295;h1^=h1>>>13;h1=(h1&65535)*3266489909+(((h1>>>16)*3266489909&65535)<<16)&4294967295;h1^=h1>>>16;return(h1>>>0).toString(36)}},{}],286:[function(require,module,exports){"use strict";var email=/^([^.](?![a-zA-Z0-9!#$%&'*+\-\/=?^_`{|}~]+\.\.)([a-zA-Z0-9!#$%&'*+\-\/=?^_`{|}~.]+[^.])|([a-zA-Z0-9]{1,2}))@([A-Za-z0-9-]{1,64}\.){1,10}[a-zA-Z]{2,64}$/;module.exports=function(val){return typeof val==="string"&&email.test(val)&&val.indexOf("@")<65&&val.length<255}},{}],287:[function(require,module,exports){"use strict";module.exports=function isEmpty(obj){var ret=true;if(obj.each){obj.each(function(property,key){if(property.val!==null){return ret=false}})}else{for(var key in obj){return false}}return ret}},{}],288:[function(require,module,exports){"use strict";module.exports=typeof window==="undefined"},{}],289:[function(require,module,exports){"use strict";var isNumber=require("lodash.isfinite");module.exports=isNumber},{"lodash.isfinite":77}],290:[function(require,module,exports){"use strict";var isNumber=require("./number");module.exports=function isNumberLike(val){if(val===null||val===void 0||val===false){return false}var length=val.length;if(!length){return isNumber(val)}var i=0;if(val.charAt(0)==="-"){if(length===1){return false}i=1}var foundE=false;var foundPeriod=false;for(;i<length;i++){var c=val.charAt(i);if(c<="/"||c>=":"){if(c==="e"){if(foundE){return false}foundE=true}else if(c==="."){if(foundPeriod){return false}foundPeriod=true}else{return false}}}return true}},{"./number":289}],291:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};module.exports=function isObj(obj){return obj&&(typeof obj==="undefined"?"undefined":_typeof(obj))==="object"&&!obj.isBase}},{}],292:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var isBuffer=require("is-buffer");var isStream=require("is-stream");module.exports=function isPlainObj(obj){return obj&&(typeof obj==="undefined"?"undefined":_typeof(obj))==="object"&&!obj.isBase&&!isBuffer(obj)&&!isStream(obj)}},{"is-buffer":74,"is-stream":75}],293:[function(require,module,exports){(function(global){"use strict";var isNode=require("./node");module.exports=isNode?false:"ontouchstart"in global||global.DocumentTouch&&document instanceof global.DocumentTouch||navigator.msMaxTouchPoints||false}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./node":288}],294:[function(require,module,exports){"use strict";var protocol="(((ws(s)?)|(http(s)?))\\:\\/\\/)";var domain="[a-zA-Z0-9_-]+";var other='([a-zA-Z/0-9$-/:-?{#-~!"^_`\\[\\]]+)?';var ext="(\\."+other+")";var port="(\\:[0-9]+)?";var ip="([a-zA-Z0-9]{4}:)+[a-zA-Z0-9]";module.exports=function(val,options){if(!options){options={}}var re=new RegExp("^"+protocol+(!options.requireProtocol?"?":"")+"("+domain+ext+"|localhost|"+ip+")"+port+other+"$");return typeof val==="string"&&re.test(val)}},{}],295:[function(require,module,exports){"use strict";module.exports=function keyHash(key){var hash=0;for(var i=0,len=key.length;i<len;i++){hash=(hash<<5)+hash+key.charCodeAt(i);hash|=0}return hash}},{}],296:[function(require,module,exports){(function(process){"use strict";var hash=require("../hash");exports.generate=function(){var rand=Math.random()*1e4|0;var stamp=Date.now();return hash("n-"+process.pid+"-"+stamp+"-"+rand)};exports.val=exports.generate()}).call(this,require("_process"))},{"../hash":285,_process:70}]},{},[195]);
